"use strict";exports.id=5222,exports.ids=[5222],exports.modules={42795:(a,b,c)=>{c.d(b,{TemplateForm:()=>E});var d=c(21124),e=c(38301),f=c(42378),g=c(31980),h=c(50937),i=c(90095),j=c(47434),k=c(91850);function l({open:a,onClose:b,templateExerciseId:c,currentName:f}){let[g,h]=(0,e.useState)(f),[i,k]=(0,e.useState)(0),[l,m]=(0,e.useState)([]),[n,o]=(0,e.useState)(null),[p,q]=(0,e.useState)(!1),r=(0,e.useRef)(null),s=j.F.exercises.linkToMaster.useMutation({onSuccess:()=>{b()}}),t=j.F.exercises.createOrGetMaster.useMutation({onSuccess:a=>{let b=Number(a.id),d=Number(c);s.mutate({templateExerciseId:d,masterExerciseId:b})}}),u=Number.isFinite(i)?i:0,v=j.F.exercises.searchMaster.useQuery({q:g,limit:20,cursor:u??0},{enabled:a&&g.trim().length>0,staleTime:1e4}),w=(0,e.useMemo)(()=>"number"==typeof v.data?.nextCursor,[v.data?.nextCursor]);function x(a){s.mutate({templateExerciseId:c,masterExerciseId:a})}return a?(0,d.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4",onKeyDown:function(a){"Escape"===a.key&&b()},children:(0,d.jsxs)("div",{className:"border-border bg-background w-full max-w-lg rounded-lg border shadow-xl",children:[(0,d.jsxs)("div",{className:"border-border flex items-center justify-between border-b p-3",children:[(0,d.jsx)("div",{className:"text-foreground text-sm font-medium",children:"Link exercise"}),(0,d.jsx)("button",{onClick:b,className:"text-secondary hover:bg-muted rounded px-2 py-1 text-sm",children:"Close"})]}),(0,d.jsxs)("div",{className:"p-3",children:[(0,d.jsx)("input",{ref:r,value:g,onChange:a=>h(a.target.value),placeholder:"Search master exercises",className:"border-border bg-background placeholder:text-muted-foreground w-full rounded-md border px-3 py-2 text-sm outline-none focus:border-[color:var(--color-primary)]"}),n&&(0,d.jsxs)("div",{className:"mt-2 rounded border border-[var(--color-success)] bg-[var(--color-success-muted)] p-2 text-xs text-[var(--color-success)]",children:["Exact match found: “",n.name,"”",(0,d.jsx)("button",{onClick:()=>x(n.id),className:"ml-2 rounded bg-[var(--color-success)] px-2 py-1 text-xs text-white hover:bg-[var(--color-success)]/80",children:"Link to exact"})]}),(0,d.jsx)("div",{className:"border-border mt-3 max-h-72 overflow-y-auto rounded border",children:p&&0===l.length?(0,d.jsx)("div",{className:"p-3 text-sm text-gray-400",children:"Searching…"}):0===l.length?(0,d.jsx)("div",{className:"p-3 text-sm text-gray-400",children:"No results"}):(0,d.jsx)("ul",{children:l.map(a=>(0,d.jsxs)("li",{className:"border-border flex items-center justify-between border-b p-3 last:border-b-0",children:[(0,d.jsx)("span",{className:"text-foreground text-sm",children:a.name}),(0,d.jsx)("button",{onClick:()=>x(a.id),className:"text-background rounded bg-blue-600 px-2 py-1 text-xs hover:bg-blue-700 disabled:opacity-50",disabled:s.isPending,children:s.isPending?"Linking…":"Link"})]},a.id))})}),w&&(0,d.jsx)("div",{className:"mt-2",children:(0,d.jsx)("button",{onClick:function(){if(!w)return;let a=v.data?.nextCursor??0,b=Number.isFinite(a)?a:0;k(b),0!==b&&v.refetch()},className:"border-border text-foreground hover:bg-muted w-full rounded border px-3 py-2 text-sm",children:"Load more"})}),(0,d.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,d.jsx)("div",{className:"text-muted-foreground text-xs",children:"Can't find it? Create a new master exercise and link."}),(0,d.jsx)("button",{onClick:function(){t.mutate({name:g.trim()})},className:"btn-secondary px-3 py-1 text-xs disabled:opacity-50",disabled:t.isPending||0===g.trim().length,children:t.isPending?"Creating…":`Create “${g.trim()}”`})]})]})]})}):null}function m({value:a,onChange:b,placeholder:c,className:f,style:g,templateExerciseId:h}){let[i,k]=(0,e.useState)(!1),[m,o]=(0,e.useState)(!1),{data:p}=j.F.exercises.isLinkingRejected.useQuery({templateExerciseId:h},{enabled:!!h}),q=j.F.exercises.rejectLinking.useMutation({onSuccess:()=>{o(!0)}});return(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("input",{type:"text",value:a,onChange:a=>b(a.target.value),placeholder:c,className:f,style:g}),!m&&(0,d.jsx)("button",{type:"button",onClick:()=>k(!0),className:"shrink-0 rounded px-2 py-1 text-xs transition-colors",style:{backgroundColor:"var(--color-primary)",border:"1px solid var(--color-primary)",color:"var(--btn-primary-fg)"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--color-primary-hover)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="var(--color-primary)"},title:"Link to existing exercise",children:"Link"})]}),m&&(0,d.jsxs)("div",{className:"mt-1 flex items-center gap-2 text-xs",style:{color:"var(--color-warning)"},children:[(0,d.jsx)("span",{children:"\uD83D\uDD17"}),(0,d.jsx)("span",{children:"Not linked - will create as new exercise"})]}),!m&&(0,d.jsx)("div",{className:"mt-1",children:(0,d.jsx)("button",{type:"button",onClick:()=>{h?q.mutate({templateExerciseId:h}):o(!0)},disabled:q.isPending,className:"text-xs transition-colors",style:{color:"var(--color-text-muted)"},onMouseEnter:a=>{a.currentTarget.style.color="var(--color-text-secondary)"},onMouseLeave:a=>{a.currentTarget.style.color="var(--color-text-muted)"},children:q.isPending?"Saving...":"Don’t link this exercise"})}),i&&(null!=h?(0,d.jsx)(l,{open:i,onClose:()=>k(!1),templateExerciseId:h,currentName:a}):(0,d.jsx)(n,{open:i,onClose:()=>k(!1),currentName:a,onChooseName:a=>{b(a),k(!1)}}))]})}function n({open:a,onClose:b,currentName:c,onChooseName:f}){let[g,h]=(0,e.useState)(c),[i,k]=(0,e.useState)(0),l=j.F.exercises.searchMaster.useQuery({q:g,limit:20,cursor:i??0},{enabled:a&&g.trim().length>0,staleTime:1e4}),m=l.data?.items??[],n=l.data?.nextCursor!=null;return a?(0,d.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center p-4",style:{backgroundColor:"hsl(var(--foreground) / 0.5)"},children:(0,d.jsxs)("div",{className:"w-full max-w-lg rounded-lg shadow-xl",style:{backgroundColor:"var(--color-bg-surface)",border:"1px solid var(--color-border)"},children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-3",style:{borderBottom:"1px solid var(--color-border)"},children:[(0,d.jsx)("div",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Search exercises"}),(0,d.jsx)("button",{onClick:b,className:"rounded px-2 py-1 text-sm transition-colors",style:{color:"var(--color-text-secondary)"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--color-bg-surface)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="transparent"},children:"Close"})]}),(0,d.jsxs)("div",{className:"p-3",children:[(0,d.jsx)("input",{value:g,onChange:a=>h(a.target.value),placeholder:"Search master exercises",className:"w-full rounded-md px-3 py-2 text-sm outline-none",style:{backgroundColor:"var(--color-bg-surface)",border:"1px solid var(--color-border)",color:"var(--color-text)"},onFocus:a=>{a.currentTarget.style.borderColor="var(--color-text-muted)"},onBlur:a=>{a.currentTarget.style.borderColor="var(--color-border)"}}),(0,d.jsx)("div",{className:"mt-3 max-h-72 overflow-y-auto rounded",style:{border:"1px solid var(--color-border)"},children:0===m.length?(0,d.jsx)("div",{className:"p-3 text-sm",style:{color:"var(--color-text-muted)"},children:"No results"}):(0,d.jsx)("ul",{children:m.map(a=>(0,d.jsxs)("li",{className:"flex items-center justify-between p-3 last:border-b-0",style:{borderBottom:"1px solid var(--color-border)"},children:[(0,d.jsx)("span",{className:"text-sm",style:{color:"var(--color-text)"},children:a.name}),(0,d.jsx)("button",{onClick:()=>f(a.name),className:"rounded px-2 py-1 text-xs transition-colors",style:{backgroundColor:"var(--color-primary)",color:"var(--btn-primary-fg)"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--color-primary-hover)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="var(--color-primary)"},children:"Use name"})]},a.id))})}),n&&(0,d.jsx)("div",{className:"mt-2",children:(0,d.jsx)("button",{onClick:()=>{let a=l.data?.nextCursor??null;k(a),null!=a&&l.refetch()},className:"w-full rounded px-3 py-2 text-sm transition-colors",style:{border:"1px solid var(--color-border)",color:"var(--color-text)"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--color-bg-surface)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="transparent"},children:"Load more"})})]})]})}):null}var o=c(35284),p=c(93758),q=c(62186),r=c(96425),s=c(44943),t=c(68120);let u=g.Op,v=e.createContext({}),w=({...a})=>(0,d.jsx)(v.Provider,{value:{name:a.name},children:(0,d.jsx)(g.xI,{...a})}),x=()=>{let a=e.useContext(v),b=e.useContext(y),{getFieldState:c}=(0,g.xW)(),d=(0,g.lN)({name:a.name}),f=c(a.name,d);if(!a)throw Error("useFormField should be used within <FormField>");let{id:h}=b;return{id:h,name:a.name,formItemId:`${h}-form-item`,formDescriptionId:`${h}-form-item-description`,formMessageId:`${h}-form-item-message`,...f}},y=e.createContext({});function z({className:a,...b}){let c=e.useId();return(0,d.jsx)(y.Provider,{value:{id:c},children:(0,d.jsx)("div",{"data-slot":"form-item",className:(0,s.cn)("grid gap-2",a),...b})})}function A({className:a,...b}){let{error:c,formItemId:e}=x();return(0,d.jsx)(t.J,{"data-slot":"form-label","data-error":!!c,className:(0,s.cn)("data-[error=true]:text-destructive",a),htmlFor:e,...b})}function B({...a}){let{error:b,formItemId:c,formDescriptionId:e,formMessageId:f}=x();return(0,d.jsx)(r.DX,{"data-slot":"form-control",id:c,"aria-describedby":b?`${e} ${f}`:`${e}`,"aria-invalid":!!b,...a})}function C({className:a,...b}){let{error:c,formMessageId:e}=x(),f=c?String(c?.message??""):b.children;return f?(0,d.jsx)("p",{"data-slot":"form-message",id:e,className:(0,s.cn)("text-destructive text-sm",a),...b,children:f}):null}let D=i.Ik({name:i.Yj().min(1,"Template name is required").max(256,"Template name is too long"),exercises:i.YO(i.Ik({exerciseName:i.Yj().min(1,"Exercise name is required").max(256,"Exercise name is too long")})).min(1,"At least one exercise is required")});function E({template:a}){let b=(0,f.useRouter)(),c=(0,e.useRef)(!1),i=(0,e.useRef)(null),l=(0,g.mN)({resolver:(0,h.u)(D),defaultValues:{name:a?.name??"",exercises:a?.exercises.length?a.exercises.map(a=>({exerciseName:a.exerciseName})):[{exerciseName:""}]}}),{fields:n,append:r,remove:s}=(0,g.jz)({control:l.control,name:"exercises"}),t=j.F.useUtils(),v=j.F.templates.create.useMutation({onMutate:async a=>(await t.templates.getAll.cancel(),{previousTemplates:t.templates.getAll.getData()}),onError:(a,b,d)=>{d?.previousTemplates&&t.templates.getAll.setData(void 0,d.previousTemplates),c.current=!1},onSuccess:async a=>{console.log("Template created successfully:",{id:a.id,name:a.name,user_id:a.user_id,createdAt:a.createdAt}),k.z.templateCreated(a.id.toString(),l.getValues("exercises").filter(a=>a.exerciseName.trim()).length),c.current=!1,t.templates.getAll.setData(void 0,b=>b?[a,...b]:[a]),b.push("/templates")},onSettled:()=>{t.templates.getAll.invalidate()}}),x=j.F.templates.update.useMutation({onMutate:async a=>{await t.templates.getAll.cancel();let b=t.templates.getAll.getData();return t.templates.getAll.setData(void 0,b=>b?.map(b=>b.id===a.id?{...b,name:a.name,updatedAt:new Date,exercises:a.exercises.map((a,c)=>({id:b.exercises?.[c]?.id??-c-1,user_id:b.exercises?.[c]?.user_id??"temp-user",templateId:b.id,exerciseName:a,orderIndex:c,linkingRejected:b.exercises?.[c]?.linkingRejected??!1,createdAt:b.exercises?.[c]?.createdAt??new Date}))}:b)??[]),{previousTemplates:b}},onError:(a,b,c)=>{c?.previousTemplates&&t.templates.getAll.setData(void 0,c.previousTemplates)},onSuccess:()=>{k.z.templateEdited(a.id.toString(),l.getValues("exercises").filter(a=>a.exerciseName.trim()).length),c.current=!1,b.push("/templates")},onSettled:()=>{t.templates.getAll.invalidate()}}),y=()=>{r({exerciseName:""})},E=async b=>{if(console.log("handleSubmit called"),F||c.current)return void console.log("Form already submitting, preventing double submission");let d=b.exercises.map(a=>a.exerciseName.trim()).filter(a=>""!==a),e=b.name.trim(),f=Date.now(),g=i.current;if(!a&&g){let a=f-g.timestamp;if(g.name===e&&JSON.stringify(g.exercises)===JSON.stringify(d)&&a<5e3)return void console.log("Preventing duplicate submission - same data within 5 seconds",{timeDiff:a})}c.current=!0,i.current={name:e,exercises:d,timestamp:f};try{a?await x.mutateAsync({id:a.id,name:e,exercises:d}):(console.log("Creating template with data:",{name:e,exercises:d}),await v.mutateAsync({name:e,exercises:d}))}catch(b){console.error("Error saving template:",b),k.z.error(b,{context:a?"template_edit":"template_create",templateId:a?.id.toString()}),alert("Error saving template. Please try again."),c.current=!1}},F=v.isPending||x.isPending;return(0,d.jsxs)(q.Zp,{padding:"lg",children:[(0,d.jsx)(q.aR,{children:(0,d.jsx)(q.ZB,{children:a?"Edit Template":"Create Template"})}),(0,d.jsx)(q.Wu,{children:(0,d.jsx)(u,{...l,children:(0,d.jsxs)("form",{onSubmit:l.handleSubmit(E),className:"space-y-6",children:[(0,d.jsx)(w,{control:l.control,name:"name",render:({field:a})=>(0,d.jsxs)(z,{children:[(0,d.jsx)(A,{children:"Template Name"}),(0,d.jsx)(B,{children:(0,d.jsx)(p.p,{placeholder:"e.g., Push Day, Pull Day, Legs",...a})}),(0,d.jsx)(C,{})]})}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,d.jsx)(A,{children:"Exercises"}),(0,d.jsx)(o.Button,{type:"button",variant:"outline",size:"sm",onClick:y,children:"+ Add Exercise"})]}),(0,d.jsx)("div",{className:"space-y-3",children:n.map((a,b)=>(0,d.jsx)(w,{control:l.control,name:`exercises.${b}.exerciseName`,render:({field:a})=>(0,d.jsxs)(z,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsx)(B,{children:(0,d.jsx)(m,{value:a.value,onChange:a.onChange,placeholder:`Exercise ${b+1}`,className:"w-full"})})}),n.length>1&&(0,d.jsx)(o.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{s(b)},className:"text-destructive hover:text-destructive hover:bg-destructive/10",children:"Remove"})]}),(0,d.jsx)(C,{})]})},a.id))}),0===n.length&&(0,d.jsx)(o.Button,{type:"button",variant:"outline",onClick:y,className:"h-20 w-full border-dashed",children:"+ Add your first exercise"})]}),(0,d.jsxs)("div",{className:"flex items-center gap-4 pt-4",children:[(0,d.jsx)(o.Button,{type:"submit",disabled:F||c.current,children:F||c.current?"Saving...":a?"Update Template":"Create Template"}),(0,d.jsx)(o.Button,{type:"button",variant:"ghost",onClick:()=>b.back(),children:"Cancel"})]})]})})})]})}},52446:(a,b,c)=>{c.d(b,{Button:()=>e});var d=c(97954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call Button() from the server but Button is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/steven/swole-tracker/src/components/ui/button.tsx","Button");(0,d.registerClientReference)(function(){throw Error("Attempted to call buttonVariants() from the server but buttonVariants is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/steven/swole-tracker/src/components/ui/button.tsx","buttonVariants")},68120:(a,b,c)=>{c.d(b,{J:()=>g});var d=c(21124);c(38301);var e=c(46029),f=c(44943);function g({className:a,...b}){return(0,d.jsx)(e.b,{"data-slot":"label",className:(0,f.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...b})}},91850:(a,b,c)=>{c.d(b,{z:()=>f});var d=c(77196);let e=(a,b)=>{try{if("undefined"==typeof navigator||!0!==navigator.onLine)return;d.Ay.capture(a,b??{})}catch{}},f={pageView:(a,b)=>{try{e("$pageview",{$current_url:void 0,page:a,...b})}catch{}},workoutStarted:(a,b)=>{e("workout_started",{templateId:a,templateName:b,timestamp:new Date().toISOString()})},workoutCompleted:(a,b,c)=>{e("workout_completed",{sessionId:a,duration:b,exerciseCount:c,timestamp:new Date().toISOString()})},exerciseLogged:(a,b,c,d)=>{e("exercise_logged",{exerciseId:a,exerciseName:b,sets:c,weight:d,timestamp:new Date().toISOString()})},templateCreated:(a,b)=>{e("template_created",{templateId:a,exerciseCount:b,timestamp:new Date().toISOString()})},templateDeleted:a=>{e("template_deleted",{templateId:a,timestamp:new Date().toISOString()})},templateEdited:(a,b)=>{e("template_edited",{templateId:a,exerciseCount:b,timestamp:new Date().toISOString()})},templateDuplicated:a=>{e("template_duplicated",{templateId:a,timestamp:new Date().toISOString()})},weightUnitChanged:a=>{e("weight_unit_changed",{unit:a,timestamp:new Date().toISOString()})},error:(a,b)=>{e("error",{error:a.message,stack:a.stack,context:b,timestamp:new Date().toISOString()})},featureUsed:(a,b)=>{e("feature_used",{feature:a,...b,timestamp:new Date().toISOString()})},aiDebriefViewed:(a,b,c)=>{e("ai_debrief.viewed",{sessionId:a,version:b,streakLength:c,timestamp:new Date().toISOString()})},aiDebriefRegenerated:(a,b,c)=>{e("ai_debrief.regenerated",{sessionId:a,version:b,reason:c,timestamp:new Date().toISOString()})},aiDebriefDismissed:(a,b,c)=>{e("ai_debrief.dismissed",{sessionId:a,version:b,pinned:c,timestamp:new Date().toISOString()})}}},92411:(a,b,c)=>{c.d(b,{TemplateForm:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call TemplateForm() from the server but TemplateForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/steven/swole-tracker/src/app/_components/template-form.tsx","TemplateForm")},93758:(a,b,c)=>{c.d(b,{p:()=>g});var d=c(21124),e=c(38301),f=c(44943);let g=e.forwardRef(({label:a,invalid:b,hint:c,className:g,rightAdornment:h,leftAdornment:i,block:j=!0,type:k="text",...l},m)=>{let n=e.useId(),o=c?`${n}-hint`:void 0;return(0,d.jsxs)("div",{className:(0,f.cn)(j?"w-full":"","space-y-1"),children:[a?(0,d.jsx)("label",{htmlFor:n,className:"text-content-secondary block text-xs",children:a}):null,(0,d.jsxs)("div",{className:(0,f.cn)("flex items-center gap-1","input-primary","transition-all",b&&"border-destructive focus-within:border-destructive"),style:{borderRadius:"var(--component-input-borderRadius)",padding:"var(--component-input-padding-y) var(--component-input-padding-x)",fontSize:"var(--component-input-fontSize)",transitionDuration:"var(--motion-duration-base)"},children:[i?(0,d.jsx)("div",{className:"shrink-0",children:i}):null,(0,d.jsx)("input",{ref:m,id:n,type:k,"aria-invalid":b?"true":"false","aria-describedby":o,"data-invalid":b?"true":void 0,className:(0,f.cn)("border-0 bg-transparent px-0 py-0 focus:ring-0 focus:outline-none","flex-1 placeholder:text-muted-foreground","disabled:cursor-not-allowed disabled:opacity-50",g),...l}),h?(0,d.jsx)("div",{className:"shrink-0",children:h}):null]}),c?(0,d.jsx)("div",{id:o,className:(0,f.cn)("text-xs",b?"text-status-danger":"text-muted-foreground text-content-secondary"),children:c}):null]})});g.displayName="Input"}};