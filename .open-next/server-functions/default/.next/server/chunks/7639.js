"use strict";exports.id=7639,exports.ids=[7639],exports.modules={837:(a,b,c)=>{c.d(b,{f:()=>as});var d=c(46493);class e{static [d.i]="ConsoleLogWriter";write(a){console.log(a)}}class f{static [d.i]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new e}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class g{static [d.i]="NoopLogger";logQuery(){}}var h=c(30248),i=c(80228),j=c(85766),k=c(7284),l=c(19593);class m{constructor(a){this.table=a}static [d.i]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class n{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [d.i]="TableAliasProxyHandler";get(a,b){if(b===k.XI.Symbol.IsAlias)return!0;if(b===k.XI.Symbol.Name||this.replaceOriginalName&&b===k.XI.Symbol.OriginalName)return this.alias;if(b===l.n)return{...a[l.n],name:this.alias,isAlias:!0};if(b===k.XI.Symbol.Columns){let b=a[k.XI.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new m(new Proxy(a,this)))}),c}let c=a[b];return(0,d.is)(c,i.V)?new Proxy(c,new m(new Proxy(a,this))):c}}class o{constructor(a){this.alias=a}static [d.i]=null;get(a,b){return"sourceTable"===b?p(a.sourceTable,this.alias):a[b]}}function p(a,b){return new Proxy(a,new n(b,!1))}function q(a,b){return new Proxy(a,new m(new Proxy(a.table,new n(b,!1))))}function r(a,b){return new j.Xs.Aliased(s(a.sql,b),a.fieldAlias)}function s(a,b){return j.ll.join(a.queryChunks.map(a=>(0,d.is)(a,i.V)?q(a,b):(0,d.is)(a,j.Xs)?s(a,b):(0,d.is)(a,j.Xs.Aliased)?r(a,b):a))}var t=c(96176);class u{static [d.i]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===l.n)return{...a[l.n],selectedFields:new Proxy(a[l.n].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=((0,d.is)(a,t.n)?a._.selectedFields:(0,d.is)(a,j.Ss)?a[l.n].selectedFields:a)[b];if((0,d.is)(c,j.Xs.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if((0,d.is)(c,j.Xs)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,d.is)(c,i.V)?this.config.alias?new Proxy(c,new m(new Proxy(c.table,new n(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new u(this.config))}}function v(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function w(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function x(a){return a}class y{static [d.i]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?v:"camelCase"===a?w:x}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[k.XI.Symbol.Schema]??"public",c=a.table[k.XI.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[k.XI.Symbol.Schema]??"public",c=a[k.XI.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[k.XI.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class z extends Error{static [d.i]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class A extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,A),c&&(this.cause=c)}}class B extends z{static [d.i]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}var C=c(48689),D=c(31496),E=c(82543),F=c(41313);class G extends j.Ss{static [d.i]="SQLiteViewBase"}class H{static [d.i]="SQLiteDialect";casing;constructor(a){this.casing=new y(a?.casing)}escapeName(a){return`"${a}"`}escapeParam(a){return"?"}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[(0,j.ll)`with `];for(let[c,d]of a.entries())b.push((0,j.ll)`${j.ll.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push((0,j.ll)`, `);return b.push((0,j.ll)` `),j.ll.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d,limit:e,orderBy:f}){let g=this.buildWithCTE(d),h=c?(0,j.ll)` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,i=b?(0,j.ll)` where ${b}`:void 0,k=this.buildOrderBy(f),l=this.buildLimit(e);return(0,j.ll)`${g}delete from ${a}${i}${h}${k}${l}`}buildUpdateSet(a,b){let c=a[k.XI.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),e=d.length;return j.ll.join(d.flatMap((a,d)=>{let f=c[a],g=b[a]??j.ll.param(f.onUpdateFn(),f),h=(0,j.ll)`${j.ll.identifier(this.casing.getColumnCasing(f))} = ${g}`;return d<e-1?[h,j.ll.raw(", ")]:[h]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,joins:f,from:g,limit:h,orderBy:i}){let k=this.buildWithCTE(e),l=this.buildUpdateSet(a,b),m=g&&j.ll.join([j.ll.raw(" from "),this.buildFromTable(g)]),n=this.buildJoins(f),o=d?(0,j.ll)` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,p=c?(0,j.ll)` where ${c}`:void 0,q=this.buildOrderBy(i),r=this.buildLimit(h);return(0,j.ll)`${k}update ${a} set ${l}${m}${n}${p}${o}${q}${r}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,e=a.flatMap(({field:a},e)=>{let f=[];if((0,d.is)(a,j.Xs.Aliased)&&a.isSelectionField)f.push(j.ll.identifier(a.fieldAlias));else if((0,d.is)(a,j.Xs.Aliased)||(0,d.is)(a,j.Xs)){let c=(0,d.is)(a,j.Xs.Aliased)?a.sql:a;b?f.push(new j.Xs(c.queryChunks.map(a=>(0,d.is)(a,i.V)?j.ll.identifier(this.casing.getColumnCasing(a)):a))):f.push(c),(0,d.is)(a,j.Xs.Aliased)&&f.push((0,j.ll)` as ${j.ll.identifier(a.fieldAlias)}`)}else if((0,d.is)(a,i.V)){let c=a.table[k.XI.Symbol.Name];"SQLiteNumericBigInt"===a.columnType?b?f.push((0,j.ll)`cast(${j.ll.identifier(this.casing.getColumnCasing(a))} as text)`):f.push((0,j.ll)`cast(${j.ll.identifier(c)}.${j.ll.identifier(this.casing.getColumnCasing(a))} as text)`):b?f.push(j.ll.identifier(this.casing.getColumnCasing(a))):f.push((0,j.ll)`${j.ll.identifier(c)}.${j.ll.identifier(this.casing.getColumnCasing(a))}`)}return e<c-1&&f.push((0,j.ll)`, `),f});return j.ll.join(e)}buildJoins(a){if(!a||0===a.length)return;let b=[];if(a)for(let[c,e]of a.entries()){0===c&&b.push((0,j.ll)` `);let f=e.table,g=e.on?(0,j.ll)` on ${e.on}`:void 0;if((0,d.is)(f,E.jo)){let a=f[E.jo.Symbol.Name],c=f[E.jo.Symbol.Schema],d=f[E.jo.Symbol.OriginalName],h=a===d?void 0:e.alias;b.push((0,j.ll)`${j.ll.raw(e.joinType)} join ${c?(0,j.ll)`${j.ll.identifier(c)}.`:void 0}${j.ll.identifier(d)}${h&&(0,j.ll)` ${j.ll.identifier(h)}`}${g}`)}else b.push((0,j.ll)`${j.ll.raw(e.joinType)} join ${f}${g}`);c<a.length-1&&b.push((0,j.ll)` `)}return j.ll.join(b)}buildLimit(a){return"object"==typeof a||"number"==typeof a&&a>=0?(0,j.ll)` limit ${a}`:void 0}buildOrderBy(a){let b=[];if(a)for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push((0,j.ll)`, `);return b.length>0?(0,j.ll)` order by ${j.ll.join(b)}`:void 0}buildFromTable(a){return(0,d.is)(a,k.XI)&&a[k.XI.Symbol.IsAlias]?(0,j.ll)`${(0,j.ll)`${j.ll.identifier(a[k.XI.Symbol.Schema]??"")}.`.if(a[k.XI.Symbol.Schema])}${j.ll.identifier(a[k.XI.Symbol.OriginalName])} ${j.ll.identifier(a[k.XI.Symbol.Name])}`:a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:e,having:f,table:g,joins:h,orderBy:m,groupBy:n,limit:o,offset:p,distinct:q,setOperators:r}){let s=c??(0,F.He)(b);for(let a of s){let b;if((0,d.is)(a.field,i.V)&&(0,k.Io)(a.field.table)!==((0,d.is)(g,t.n)?g._.alias:(0,d.is)(g,G)?g[l.n].name:(0,d.is)(g,j.Xs)?void 0:(0,k.Io)(g))&&(b=a.field.table,!h?.some(({alias:a})=>a===(b[k.XI.Symbol.IsAlias]?(0,k.Io)(b):b[k.XI.Symbol.BaseName])))){let b=(0,k.Io)(a.field.table);throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let u=!h||0===h.length,v=this.buildWithCTE(a),w=q?(0,j.ll)` distinct`:void 0,x=this.buildSelection(s,{isSingleTable:u}),y=this.buildFromTable(g),z=this.buildJoins(h),A=e?(0,j.ll)` where ${e}`:void 0,B=f?(0,j.ll)` having ${f}`:void 0,C=[];if(n)for(let[a,b]of n.entries())C.push(b),a<n.length-1&&C.push((0,j.ll)`, `);let D=C.length>0?(0,j.ll)` group by ${j.ll.join(C)}`:void 0,E=this.buildOrderBy(m),H=this.buildLimit(o),I=p?(0,j.ll)` offset ${p}`:void 0,J=(0,j.ll)`${v}select${w} ${x} from ${y}${z}${A}${D}${B}${E}${H}${I}`;return r.length>0?this.buildSetOperations(J,r):J}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:e,limit:f,orderBy:g,offset:h}}){let i,k=(0,j.ll)`${a.getSQL()} `,l=(0,j.ll)`${e.getSQL()}`;if(g&&g.length>0){let a=[];for(let b of g)if((0,d.is)(b,D.v))a.push(j.ll.identifier(b.name));else if((0,d.is)(b,j.Xs)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];(0,d.is)(c,D.v)&&(b.queryChunks[a]=j.ll.identifier(this.casing.getColumnCasing(c)))}a.push((0,j.ll)`${b}`)}else a.push((0,j.ll)`${b}`);i=(0,j.ll)` order by ${j.ll.join(a,(0,j.ll)`, `)}`}let m="object"==typeof f||"number"==typeof f&&f>=0?(0,j.ll)` limit ${f}`:void 0,n=j.ll.raw(`${b} ${c?"all ":""}`),o=h?(0,j.ll)` offset ${h}`:void 0;return(0,j.ll)`${k}${n}${l}${i}${m}${o}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:e,withList:f,select:g}){let h=[],i=Object.entries(a[k.XI.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),l=i.map(([,a])=>j.ll.identifier(this.casing.getColumnCasing(a)));if(g)(0,d.is)(b,j.Xs)?h.push(b):h.push(b.getSQL());else for(let[a,c]of(h.push(j.ll.raw("values ")),b.entries())){let e=[];for(let[a,b]of i){let f=c[a];if(void 0===f||(0,d.is)(f,j.Iw)&&void 0===f.value){let a;if(null!==b.default&&void 0!==b.default)a=(0,d.is)(b.default,j.Xs)?b.default:j.ll.param(b.default,b);else if(void 0!==b.defaultFn){let c=b.defaultFn();a=(0,d.is)(c,j.Xs)?c:j.ll.param(c,b)}else if(b.default||void 0===b.onUpdateFn)a=(0,j.ll)`null`;else{let c=b.onUpdateFn();a=(0,d.is)(c,j.Xs)?c:j.ll.param(c,b)}e.push(a)}else e.push(f)}h.push(e),a<b.length-1&&h.push((0,j.ll)`, `)}let m=this.buildWithCTE(f),n=j.ll.join(h),o=e?(0,j.ll)` returning ${this.buildSelection(e,{isSingleTable:!0})}`:void 0,p=c?.length?j.ll.join(c):void 0;return(0,j.ll)`${m}insert into ${a} ${l} ${n}${p}${o}`}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:b})}buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:e,tableConfig:f,queryConfig:g,tableAlias:l,nestedQueryRelation:m,joinOn:n}){let o,u=[],v,w,x=[],y,A=[];if(!0===g)u=Object.entries(f.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:q(b,l),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let e=Object.fromEntries(Object.entries(f.columns).map(([a,b])=>[a,q(b,l)]));if(g.where){let a="function"==typeof g.where?g.where(e,(0,h.mm)()):g.where;y=a&&s(a,l)}let m=[],n=[];if(g.columns){let a=!1;for(let[b,c]of Object.entries(g.columns))void 0!==c&&b in f.columns&&(a||!0!==c||(a=!0),n.push(b));n.length>0&&(n=a?n.filter(a=>g.columns?.[a]===!0):Object.keys(f.columns).filter(a=>!n.includes(a)))}else n=Object.keys(f.columns);for(let a of n){let b=f.columns[a];m.push({tsKey:a,value:b})}let o=[];if(g.with&&(o=Object.entries(g.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:f.relations[a]}))),g.extras)for(let[a,b]of Object.entries("function"==typeof g.extras?g.extras(e,{sql:j.ll}):g.extras))m.push({tsKey:a,value:r(b,l)});for(let{tsKey:a,value:b}of m)u.push({dbKey:(0,d.is)(b,j.Xs.Aliased)?b.fieldAlias:f.columns[a].name,tsKey:a,field:(0,d.is)(b,i.V)?q(b,l):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let p="function"==typeof g.orderBy?g.orderBy(e,(0,h.rl)()):g.orderBy??[];for(let{tsKey:e,queryConfig:f,relation:m}of(Array.isArray(p)||(p=[p]),x=p.map(a=>(0,d.is)(a,i.V)?q(a,l):s(a,l)),v=g.limit,w=g.offset,o)){let g=(0,h.W0)(b,c,m),i=c[(0,k.Lf)(m.referencedTable)],n=`${l}_${e}`,o=(0,C.Uo)(...g.fields.map((a,b)=>(0,C.eq)(q(g.references[b],n),q(a,l)))),p=this.buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:a[i],tableConfig:b[i],queryConfig:(0,d.is)(m,h.pD)?!0===f?{limit:1}:{...f,limit:1}:f,tableAlias:n,joinOn:o,nestedQueryRelation:m}),r=(0,j.ll)`(${p.sql})`.as(e);u.push({dbKey:e,tsKey:e,field:r,relationTableTsKey:i,isJson:!0,selection:p.selection})}}if(0===u.length)throw new z({message:`No fields selected for table "${f.tsName}" ("${l}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if(y=(0,C.Uo)(n,y),m){let a=(0,j.ll)`json_array(${j.ll.join(u.map(({field:a})=>(0,d.is)(a,D.v)?j.ll.identifier(this.casing.getColumnCasing(a)):(0,d.is)(a,j.Xs.Aliased)?a.sql:a),(0,j.ll)`, `)})`;(0,d.is)(m,h.iv)&&(a=(0,j.ll)`coalesce(json_group_array(${a}), json_array())`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:f.tsName,selection:u}];void 0!==v||void 0!==w||x.length>0?(o=this.buildSelectQuery({table:p(e,l),fields:{},fieldsFlat:[{path:[],field:j.ll.raw("*")}],where:y,limit:v,offset:w,orderBy:x,setOperators:[]}),y=void 0,v=void 0,w=void 0,x=void 0):o=p(e,l),o=this.buildSelectQuery({table:(0,d.is)(o,E.jo)?o:new t.n(o,{},l),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:(0,d.is)(a,i.V)?q(a,l):a})),joins:A,where:y,limit:v,offset:w,orderBy:x,setOperators:[]})}else o=this.buildSelectQuery({table:p(e,l),fields:{},fieldsFlat:u.map(({field:a})=>({path:[],field:(0,d.is)(a,i.V)?q(a,l):a})),joins:A,where:y,limit:v,offset:w,orderBy:x,setOperators:[]});return{tableTsKey:f.tsName,sql:o,selection:u}}}class I extends H{static [d.i]="SQLiteSyncDialect";migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=(0,j.ll)`
			CREATE TABLE IF NOT EXISTS ${j.ll.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;b.run(e);let f=b.values((0,j.ll)`SELECT id, hash, created_at FROM ${j.ll.identifier(d)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;b.run((0,j.ll)`BEGIN`);try{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)b.run(j.ll.raw(a));b.run((0,j.ll)`INSERT INTO ${j.ll.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}b.run((0,j.ll)`COMMIT`)}catch(a){throw b.run((0,j.ll)`ROLLBACK`),a}}}class J extends H{static [d.i]="SQLiteAsyncDialect";async migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=(0,j.ll)`
			CREATE TABLE IF NOT EXISTS ${j.ll.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await b.run(e);let f=(await b.values((0,j.ll)`SELECT id, hash, created_at FROM ${j.ll.identifier(d)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await b.transaction(async b=>{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)await b.run(j.ll.raw(a));await b.run((0,j.ll)`INSERT INTO ${j.ll.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}})}}class K{static [d.i]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class L{static [d.i]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}function M(a){return(0,d.is)(a,E.jo)?[`${a[k.XI.Symbol.BaseName]}`]:(0,d.is)(a,t.n)?a._.usedTables??[]:(0,d.is)(a,j.Xs)?a.usedTables??[]:[]}class N{static [d.i]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,this.withList=a.withList,this.distinct=a.distinct}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:(0,d.is)(a,t.n)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):(0,d.is)(a,G)?a[l.n].selectedFields:(0,d.is)(a,j.Xs)?{}:(0,F.YD)(a),new P({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class O extends K{static [d.i]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(let h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=(0,F.zN)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},M(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a){return(b,c)=>{let e=this.tableName,f=(0,F.zN)(b);for(let a of M(b))this.usedTables.add(a);if("string"==typeof f&&this.config.joins?.some(a=>a.alias===f))throw Error(`Alias "${f}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof e&&(this.config.fields={[e]:this.config.fields}),"string"==typeof f&&!(0,d.is)(b,j.Xs))){let a=(0,d.is)(b,t.n)?b._.selectedFields:(0,d.is)(b,j.Ss)?b[l.n].selectedFields:b[k.XI.Symbol.Columns];this.config.fields[f]=a}if("function"==typeof c&&(c=c(new Proxy(this.config.fields,new u({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:c,table:b,joinType:a,alias:f}),"string"==typeof f)switch(a){case"left":this.joinsNotNullableMap[f]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[f]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(a,b){return c=>{let d="function"==typeof c?c(R()):c;if(!(0,F.DV)(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new u({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new u({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new u({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new u({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...M(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...M(a.table));return new Proxy(new t.n(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new u({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new u({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class P extends O{static [d.i]="SQLiteSelect";_prepare(a=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let b=(0,F.He)(this.config.fields),c=this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),b,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return c.joinsNotNullableMap=this.joinsNotNullableMap,c}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.all()}}function Q(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!(0,F.DV)(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}(0,F.XJ)(P,[L]);let R=()=>({union:S,unionAll:T,intersect:U,except:V}),S=Q("union",!1),T=Q("union",!0),U=Q("intersect",!1),V=Q("except",!1);class W{static [d.i]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=(0,d.is)(a,H)?a:void 0,this.dialectConfig=(0,d.is)(a,H)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new t.J(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new u({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new N({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(c){return new N({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a,distinct:!0})}}}select(a){return new N({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new N({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new I(this.dialectConfig)),this.dialect}}class X{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [d.i]="SQLiteUpdateBuilder";set(a){return new Y(this.table,(0,F.q)(this.table,a),this.session,this.dialect,this.withList)}}class Y extends L{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]}}static [d.i]="SQLiteUpdate";config;from(a){return this.config.from=a,this}createJoin(a){return(b,c)=>{let e=(0,F.zN)(b);if("string"==typeof e&&this.config.joins.some(a=>a.alias===e))throw Error(`Alias "${e}" is already used in this query`);if("function"==typeof c){let a=this.config.from?(0,d.is)(b,E.jo)?b[k.XI.Symbol.Columns]:(0,d.is)(b,t.n)?b._.selectedFields:(0,d.is)(b,G)?b[l.n].selectedFields:void 0:void 0;c=c(new Proxy(this.config.table[k.XI.Symbol.Columns],new u({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new u({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:c,table:b,joinType:a,alias:e}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[k.XI.Symbol.Columns],new u({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.config.table[E.jo.Symbol.Columns]){return this.config.returning=(0,F.He)(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:M(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class Z{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [d.i]="SQLiteInsertBuilder";values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[k.XI.Symbol.Columns];for(let e of Object.keys(a)){let f=a[e];b[e]=(0,d.is)(f,j.Xs)?f:new j.Iw(f,c[e])}return b});return new $(this.table,b,this.session,this.dialect,this.withList)}select(a){let b="function"==typeof a?a(new W):a;if(!(0,d.is)(b,j.Xs)&&!(0,F.DV)(this.table[k.e],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new $(this.table,b,this.session,this.dialect,this.withList,!0)}}class $ extends L{constructor(a,b,c,d,e,f){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f}}static [d.i]="SQLiteInsert";config;returning(a=this.config.table[E.jo.Symbol.Columns]){return this.config.returning=(0,F.He)(a),this}onConflictDoNothing(a={}){if(this.config.onConflict||(this.config.onConflict=[]),void 0===a.target)this.config.onConflict.push((0,j.ll)` on conflict do nothing`);else{let b=Array.isArray(a.target)?(0,j.ll)`${a.target}`:(0,j.ll)`${[a.target]}`,c=a.where?(0,j.ll)` where ${a.where}`:(0,j.ll)``;this.config.onConflict.push((0,j.ll)` on conflict ${b} do nothing${c}`)}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let b=a.where?(0,j.ll)` where ${a.where}`:void 0,c=a.targetWhere?(0,j.ll)` where ${a.targetWhere}`:void 0,d=a.setWhere?(0,j.ll)` where ${a.setWhere}`:void 0,e=Array.isArray(a.target)?(0,j.ll)`${a.target}`:(0,j.ll)`${[a.target]}`,f=this.dialect.buildUpdateSet(this.config.table,(0,F.q)(this.config.table,a.set));return this.config.onConflict.push((0,j.ll)` on conflict ${e}${c} do update set ${f}${b}${d}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:M(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class _ extends L{constructor(a,b,c,d){super(),this.table=a,this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [d.i]="SQLiteDelete";config;where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[k.XI.Symbol.Columns],new u({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.table[E.jo.Symbol.Columns]){return this.config.returning=(0,F.He)(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:M(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(a){return this._prepare().execute(a)}$dynamic(){return this}}class aa extends j.Xs{constructor(a){super(aa.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.session=a.session,this.sql=aa.buildCount(a.source,a.filters)}sql;static [d.i]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(a,b){return(0,j.ll)`(select count(*) from ${a}${j.ll.raw(" where ").if(b)}${b})`}static buildCount(a,b){return(0,j.ll)`select count(*) from ${a}${j.ll.raw(" where ").if(b)}${b}`}then(a,b){return Promise.resolve(this.session.count(this.sql)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class ab{constructor(a,b,c,d,e,f,g,h){this.mode=a,this.fullSchema=b,this.schema=c,this.tableNamesMap=d,this.table=e,this.tableConfig=f,this.dialect=g,this.session=h}static [d.i]="SQLiteAsyncRelationalQueryBuilder";findMany(a){return"sync"===this.mode?new ad(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many"):new ac(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return"sync"===this.mode?new ad(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first"):new ac(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class ac extends L{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [d.i]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(a=!1){let{query:b,builtQuery:c}=this._toSQL();return this.session[a?"prepareOneTimeQuery":"prepareQuery"](c,void 0,"first"===this.mode?"get":"all",!0,(a,c)=>{let d=a.map(a=>(0,h.I$)(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})}prepare(){return this._prepare(!1)}_toSQL(){let a=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return"first"===this.mode?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}class ad extends ac{static [d.i]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class ae extends L{constructor(a,b,c,d,e){super(),this.execute=a,this.getSQL=b,this.dialect=d,this.mapBatchResult=e,this.config={action:c}}static [d.i]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class af{constructor(a,b,c,d){this.resultKind=a,this.dialect=b,this.session=c,this._=d?{schema:d.schema,fullSchema:d.fullSchema,tableNamesMap:d.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let e=this.query;if(this._.schema)for(let[f,g]of Object.entries(this._.schema))e[f]=new ab(a,d.fullSchema,this._.schema,this._.tableNamesMap,d.fullSchema[f],g,b,c);this.$cache={invalidate:async a=>{}}}static [d.i]="BaseSQLiteDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new W(c.dialect))),new Proxy(new t.J(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new u({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new aa({source:a,filters:b,session:this.session})}with(...a){let b=this;return{select:function(c){return new N({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new N({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},update:function(c){return new X(c,b.session,b.dialect,a)},insert:function(c){return new Z(c,b.session,b.dialect,a)},delete:function(c){return new _(c,b.session,b.dialect,a)}}}select(a){return new N({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new N({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(a){return new X(a,this.session,this.dialect)}$cache;insert(a){return new Z(a,this.session,this.dialect)}delete(a){return new _(a,this.session,this.dialect)}run(a){let b="string"==typeof a?j.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ae(async()=>this.session.run(b),()=>b,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(b)}all(a){let b="string"==typeof a?j.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ae(async()=>this.session.all(b),()=>b,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(b)}get(a){let b="string"==typeof a?j.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ae(async()=>this.session.get(b),()=>b,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(b)}values(a){let b="string"==typeof a?j.ll.raw(a):a.getSQL();return"async"===this.resultKind?new ae(async()=>this.session.values(b),()=>b,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(b)}transaction(a,b){return this.session.transaction(a,b)}}class ag{static [d.i]="Cache"}class ah extends ag{strategy(){return"all"}static [d.i]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function ai(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class aj extends L{constructor(a){super(),this.resultCb=a}static [d.i]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class ak{constructor(a,b,c,d,e,f){this.mode=a,this.executeMethod=b,this.query=c,this.cache=d,this.queryMetadata=e,this.cacheConfig=f,d&&"all"===d.strategy()&&void 0===f&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}static [d.i]="PreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||(0,d.is)(this.cache,ah)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new A(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new A(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new A(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await ai(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new A(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await ai(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new A(a,b,c)}}getQuery(){return this.query}mapRunResult(a,b){return a}mapAllResult(a,b){throw Error("Not implemented")}mapGetResult(a,b){throw Error("Not implemented")}execute(a){return"async"===this.mode?this[this.executeMethod](a):new aj(()=>this[this.executeMethod](a))}mapResult(a,b){switch(this.executeMethod){case"run":return this.mapRunResult(a,b);case"all":return this.mapAllResult(a,b);case"get":return this.mapGetResult(a,b)}}}class al{constructor(a){this.dialect=a}static [d.i]="SQLiteSession";prepareOneTimeQuery(a,b,c,d,e,f,g){return this.prepareQuery(a,b,c,d,e,f,g)}run(a){let b=this.dialect.sqlToQuery(a);try{return this.prepareOneTimeQuery(b,void 0,"run",!1).run()}catch(a){throw new z({cause:a,message:`Failed to run the query '${b.sql}'`})}}extractRawRunValueFromBatchResult(a){return a}all(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(a){throw Error("Not implemented")}get(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(a){throw Error("Not implemented")}values(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).values()}async count(a){return(await this.values(a))[0][0]}extractRawValuesValueFromBatchResult(a){throw Error("Not implemented")}}class am extends af{constructor(a,b,c,d,e=0){super(a,b,c,d),this.schema=d,this.nestedIndex=e}static [d.i]="SQLiteTransaction";rollback(){throw new B}}class an extends al{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new g,this.cache=d.cache??new ah}static [d.i]="SQLiteD1Session";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new aq(this.client.prepare(a.sql),a,this.logger,this.cache,f,g,b,c,d,e)}async batch(a){let b=[],c=[];for(let d of a){let a=d._prepare(),e=a.getQuery();if(b.push(a),e.params.length>0)c.push(a.stmt.bind(...e.params));else{let b=a.getQuery();c.push(this.client.prepare(b.sql).bind(...b.params))}}return(await this.client.batch(c)).map((a,c)=>b[c].mapResult(a,!0))}extractRawAllValueFromBatchResult(a){return a.results}extractRawGetValueFromBatchResult(a){return a.results[0]}extractRawValuesValueFromBatchResult(a){return ap(a.results)}async transaction(a,b){let c=new ao("async",this.dialect,this,this.schema);await this.run(j.ll.raw(`begin${b?.behavior?" "+b.behavior:""}`));try{let b=await a(c);return await this.run((0,j.ll)`commit`),b}catch(a){throw await this.run((0,j.ll)`rollback`),a}}}class ao extends am{static [d.i]="D1Transaction";async transaction(a){let b=`sp${this.nestedIndex}`,c=new ao("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(j.ll.raw(`savepoint ${b}`));try{let d=await a(c);return await this.session.run(j.ll.raw(`release savepoint ${b}`)),d}catch(a){throw await this.session.run(j.ll.raw(`rollback to savepoint ${b}`)),a}}}function ap(a){let b=[];for(let c of a){let a=Object.keys(c).map(a=>c[a]);b.push(a)}return b}class aq extends ak{constructor(a,b,c,d,e,f,g,h,i,j){super("async",h,b,d,e,f),this.logger=c,this._isResponseInArrayMode=i,this.customResultMapper=j,this.fields=g,this.stmt=a}static [d.i]="D1PreparedQuery";customResultMapper;fields;stmt;async run(a){let b=(0,j.Ct)(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).run())}async all(a){let{fields:b,query:c,logger:d,stmt:e,customResultMapper:f}=this;if(!b&&!f){let b=(0,j.Ct)(c.params,a??{});return d.logQuery(c.sql,b),await this.queryWithCache(c.sql,b,async()=>e.bind(...b).all().then(({results:a})=>this.mapAllResult(a)))}let g=await this.values(a);return this.mapAllResult(g)}mapAllResult(a,b){return(b&&(a=ap(a.results)),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper(a):a.map(a=>(0,F.a6)(this.fields,a,this.joinsNotNullableMap)):a}async get(a){let{fields:b,joinsNotNullableMap:c,query:d,logger:e,stmt:f,customResultMapper:g}=this;if(!b&&!g){let b=(0,j.Ct)(d.params,a??{});return e.logQuery(d.sql,b),await this.queryWithCache(d.sql,b,async()=>f.bind(...b).all().then(({results:a})=>a[0]))}let h=await this.values(a);if(h[0])return g?g(h):(0,F.a6)(b,h[0],c)}mapGetResult(a,b){return(b&&(a=ap(a.results)[0]),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper([a]):(0,F.a6)(this.fields,a,this.joinsNotNullableMap):a}async values(a){let b=(0,j.Ct)(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).raw())}isResponseInArrayMode(){return this._isResponseInArrayMode}}class ar extends af{static [d.i]="D1Database";async batch(a){return this.session.batch(a)}}function as(a,b={}){let c,d,e=new J({casing:b.casing});if(!0===b.logger?c=new f:!1!==b.logger&&(c=b.logger),b.schema){let a=(0,h._k)(b.schema,h.DZ);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let g=new an(a,e,d,{logger:c,cache:b.cache}),i=new ar("async",e,g,d);return i.$client=a,i.$cache=b.cache,i.$cache&&(i.$cache.invalidate=b.cache?.onMutate),i}},4035:(a,b,c)=>{c.d(b,{Pe:()=>h});var d=c(46493);class e{constructor(a,b){this.name=a,this.unique=b}static [d.i]="SQLiteIndexBuilderOn";on(...a){return new f(this.name,a,this.unique)}}class f{static [d.i]="SQLiteIndexBuilder";config;constructor(a,b,c){this.config={name:a,columns:b,unique:c,where:void 0}}where(a){return this.config.where=a,this}build(a){return new g(this.config,a)}}class g{static [d.i]="SQLiteIndex";config;constructor(a,b){this.config={...a,table:b}}}function h(a){return new e(a,!1)}},7284:(a,b,c)=>{c.d(b,{HE:()=>k,Io:()=>o,Lf:()=>p,XI:()=>n,e:()=>g});var d=c(46493),e=c(35071);let f=Symbol.for("drizzle:Schema"),g=Symbol.for("drizzle:Columns"),h=Symbol.for("drizzle:ExtraConfigColumns"),i=Symbol.for("drizzle:OriginalName"),j=Symbol.for("drizzle:BaseName"),k=Symbol.for("drizzle:IsAlias"),l=Symbol.for("drizzle:ExtraConfigBuilder"),m=Symbol.for("drizzle:IsDrizzleTable");class n{static [d.i]="Table";static Symbol={Name:e.E,Schema:f,OriginalName:i,Columns:g,ExtraConfigColumns:h,BaseName:j,IsAlias:k,ExtraConfigBuilder:l};[e.E];[i];[f];[g];[h];[j];[k]=!1;[m]=!0;[l]=void 0;constructor(a,b,c){this[e.E]=this[i]=a,this[f]=b,this[j]=c}}function o(a){return a[e.E]}function p(a){return`${a[f]??"public"}.${a[e.E]}`}},19593:(a,b,c)=>{c.d(b,{n:()=>d});let d=Symbol.for("drizzle:ViewBaseConfig")},19643:(a,b,c)=>{c.d(b,{x:()=>h});var d=c(46493),e=c(31496);class f extends e.o{static [d.i]="SQLiteRealBuilder";constructor(a){super(a,"number","SQLiteReal")}build(a){return new g(a,this.config)}}class g extends e.v{static [d.i]="SQLiteReal";getSQLType(){return"real"}}function h(a){return new f(a??"")}},20377:(a,b,c)=>{c.d(b,{nd:()=>p});var d=c(46493),e=c(85766),f=c(41313),g=c(31496);class h extends g.o{static [d.i]="SQLiteBaseIntegerBuilder";constructor(a,b,c){super(a,b,c),this.config.autoIncrement=!1}primaryKey(a){return a?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}}class i extends g.v{static [d.i]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class j extends h{static [d.i]="SQLiteIntegerBuilder";constructor(a){super(a,"number","SQLiteInteger")}build(a){return new k(a,this.config)}}class k extends i{static [d.i]="SQLiteInteger"}class l extends h{static [d.i]="SQLiteTimestampBuilder";constructor(a,b){super(a,"date","SQLiteTimestamp"),this.config.mode=b}defaultNow(){return this.default((0,e.ll)`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(a){return new m(a,this.config)}}class m extends i{static [d.i]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(a){return new Date("timestamp"===this.config.mode?1e3*a:a)}mapToDriverValue(a){let b=a.getTime();return"timestamp"===this.config.mode?Math.floor(b/1e3):b}}class n extends h{static [d.i]="SQLiteBooleanBuilder";constructor(a,b){super(a,"boolean","SQLiteBoolean"),this.config.mode=b}build(a){return new o(a,this.config)}}class o extends i{static [d.i]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(a){return 1===Number(a)}mapToDriverValue(a){return+!!a}}function p(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode==="timestamp"||d?.mode==="timestamp_ms"?new l(c,d.mode):d?.mode==="boolean"?new n(c,d.mode):new j(c)}},30248:(a,b,c)=>{c.d(b,{iv:()=>r,pD:()=>q,DZ:()=>x,_k:()=>u,mm:()=>s,rl:()=>t,I$:()=>function a(b,c,d,g,h=a=>a){let i={};for(let[j,k]of g.entries())if(k.isJson){let e=c.relations[k.tsKey],g=d[j],l="string"==typeof g?JSON.parse(g):g;i[k.tsKey]=(0,f.is)(e,q)?l&&a(b,b[k.relationTableTsKey],l,k.selection,h):l.map(c=>a(b,b[k.relationTableTsKey],c,k.selection,h))}else{let a,b=h(d[j]),c=k.field;a=(0,f.is)(c,e.V)?c:(0,f.is)(c,n.Xs)?c.decoder:c.sql.decoder,i[k.tsKey]=null===b?null:a.mapFromDriverValue(b)}return i},W0:()=>w,K1:()=>v});var d=c(7284),e=c(80228),f=c(46493);let g=Symbol.for("drizzle:PgInlineForeignKeys"),h=Symbol.for("drizzle:EnableRLS");class i extends d.XI{static [f.i]="PgTable";static Symbol=Object.assign({},d.XI.Symbol,{InlineForeignKeys:g,EnableRLS:h});[g]=[];[h]=!1;[d.XI.Symbol.ExtraConfigBuilder]=void 0;[d.XI.Symbol.ExtraConfigColumns]={}}class j{static [f.i]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new k(a,this.columns,this.name)}}class k{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [f.i]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[i.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}var l=c(48689),m=c(71559),n=c(85766);class o{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[d.XI.Symbol.Name]}static [f.i]="Relation";referencedTableName;fieldName}class p{constructor(a,b){this.table=a,this.config=b}static [f.i]="Relations"}class q extends o{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [f.i]="One";withFieldName(a){let b=new q(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class r extends o{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [f.i]="Many";withFieldName(a){let b=new r(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function s(){return{and:l.Uo,between:l.Tq,eq:l.eq,exists:l.t2,gt:l.gt,gte:l.RO,ilike:l.B3,inArray:l.RV,isNull:l.kZ,isNotNull:l.Pe,like:l.mj,lt:l.lt,lte:l.wJ,ne:l.ne,not:l.AU,notBetween:l.o8,notExists:l.KJ,notLike:l.RK,notIlike:l.q1,notInArray:l.KL,or:l.or,sql:n.ll}}function t(){return{sql:n.ll,asc:m.Y,desc:m.i}}function u(a,b){1===Object.keys(a).length&&"default"in a&&!(0,f.is)(a.default,d.XI)&&(a=a.default);let c={},e={},g={};for(let[h,i]of Object.entries(a))if((0,f.is)(i,d.XI)){let a=(0,d.Lf)(i),b=e[a];for(let e of(c[a]=h,g[h]={tsName:h,dbName:i[d.XI.Symbol.Name],schema:i[d.XI.Symbol.Schema],columns:i[d.XI.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(i[d.XI.Symbol.Columns])))e.primary&&g[h].primaryKey.push(e);let k=i[d.XI.Symbol.ExtraConfigBuilder]?.(i[d.XI.Symbol.ExtraConfigColumns]);if(k)for(let a of Object.values(k))(0,f.is)(a,j)&&g[h].primaryKey.push(...a.columns)}else if((0,f.is)(i,p)){let a,f=(0,d.Lf)(i.table),h=c[f];for(let[c,d]of Object.entries(i.config(b(i.table))))if(h){let b=g[h];b.relations[c]=d,a&&b.primaryKey.push(...a)}else f in e||(e[f]={relations:{},primaryKey:a}),e[f].relations[c]=d}return{tables:g,tableNamesMap:c}}function v(a,b){return new p(a,a=>Object.fromEntries(Object.entries(b(a)).map(([a,b])=>[a,b.withFieldName(a)])))}function w(a,b,c){if((0,f.is)(c,q)&&c.config)return{fields:c.config.fields,references:c.config.references};let e=b[(0,d.Lf)(c.referencedTable)];if(!e)throw Error(`Table "${c.referencedTable[d.XI.Symbol.Name]}" not found in schema`);let g=a[e];if(!g)throw Error(`Table "${e}" not found in schema`);let h=c.sourceTable,i=b[(0,d.Lf)(h)];if(!i)throw Error(`Table "${h[d.XI.Symbol.Name]}" not found in schema`);let j=[];for(let a of Object.values(g.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&j.push(a);if(j.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${e}"`):Error(`There are multiple relations between "${e}" and "${c.sourceTable[d.XI.Symbol.Name]}". Please specify relation name`);if(j[0]&&(0,f.is)(j[0],q)&&j[0].config)return{fields:j[0].config.references,references:j[0].config.fields};throw Error(`There is not enough information to infer relation "${i}.${c.fieldName}"`)}function x(a){return{one:function(b,c){return new q(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new r(a,b,c)}}}},31496:(a,b,c)=>{c.d(b,{v:()=>o,o:()=>n});var d=c(98046),e=c(80228),f=c(46493),g=c(35071);class h{static [f.i]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=a,this}onDelete(a){return this._onDelete=a,this}build(a){return new i(a,this)}}class i{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [f.i]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[g.E],...d,c[0].table[g.E],...e];return a??`${f.join("_")}_fk`}}function j(a,b){return`${a[g.E]}_${b.join("_")}_unique`}class k{constructor(a,b){this.name=b,this.columns=a}static [f.i]=null;columns;build(a){return new m(a,this.columns,this.name)}}class l{static [f.i]=null;name;constructor(a){this.name=a}on(...a){return new k(a,this.name)}}class m{constructor(a,b,c){this.table=a,this.columns=b,this.name=c??j(this.table,this.columns.map(a=>a.name))}static [f.i]=null;columns;name;getName(){return this.name}}class n extends d.Q{static [f.i]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a){return this.config.isUnique=!0,this.config.uniqueName=a,this}generatedAlwaysAs(a,b){return this.config.generated={as:a,type:"always",mode:b?.mode??"virtual"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>((c,d)=>{let e=new h(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)})(c,d))}}class o extends e.V{constructor(a,b){b.uniqueName||(b.uniqueName=j(a,[b.name])),super(a,b),this.table=a}static [f.i]="SQLiteColumn"}},35071:(a,b,c)=>{c.d(b,{E:()=>d});let d=Symbol.for("drizzle:Name")},41313:(a,b,c)=>{c.d(b,{DV:()=>k,He:()=>function a(b,c){return Object.entries(b).reduce((b,[g,i])=>{if("string"!=typeof g)return b;let j=c?[...c,g]:[g];return(0,e.is)(i,d.V)||(0,e.is)(i,f.Xs)||(0,e.is)(i,f.Xs.Aliased)?b.push({path:j,field:i}):(0,e.is)(i,h.XI)?b.push(...a(i[h.XI.Symbol.Columns],j)):b.push(...a(i,j)),b},[])},Ll:()=>p,XJ:()=>m,YD:()=>n,a6:()=>j,q:()=>l,su:()=>q,zN:()=>o});var d=c(80228),e=c(46493),f=c(85766),g=c(96176),h=c(7284),i=c(19593);function j(a,b,c){let g={},i=a.reduce((a,{path:i,field:j},k)=>{let l;l=(0,e.is)(j,d.V)?j:(0,e.is)(j,f.Xs)?j.decoder:j.sql.decoder;let m=a;for(let[a,f]of i.entries())if(a<i.length-1)f in m||(m[f]={}),m=m[f];else{let a=b[k],n=m[f]=null===a?null:l.mapFromDriverValue(a);if(c&&(0,e.is)(j,d.V)&&2===i.length){let a=i[0];a in g?"string"==typeof g[a]&&g[a]!==(0,h.Io)(j.table)&&(g[a]=!1):g[a]=null===n&&(0,h.Io)(j.table)}}return a},{});if(c&&Object.keys(g).length>0)for(let[a,b]of Object.entries(g))"string"!=typeof b||c[b]||(i[a]=null);return i}function k(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function l(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>(0,e.is)(c,f.Xs)||(0,e.is)(c,d.V)?[b,c]:[b,new f.Iw(c,a[h.XI.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function m(a,b){for(let c of b)for(let b of Object.getOwnPropertyNames(c.prototype))"constructor"!==b&&Object.defineProperty(a.prototype,b,Object.getOwnPropertyDescriptor(c.prototype,b)||Object.create(null))}function n(a){return a[h.XI.Symbol.Columns]}function o(a){return(0,e.is)(a,g.n)?a._.alias:(0,e.is)(a,f.Ss)?a[i.n].name:(0,e.is)(a,f.Xs)?void 0:a[h.XI.Symbol.IsAlias]?a[h.XI.Symbol.Name]:a[h.XI.Symbol.BaseName]}function p(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}let q="undefined"==typeof TextDecoder?null:new TextDecoder},46493:(a,b,c)=>{c.d(b,{i:()=>d,is:()=>e});let d=Symbol.for("drizzle:entityKind");function e(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,d))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(d in c&&c[d]===b[d])return!0;c=Object.getPrototypeOf(c)}return!1}Symbol.for("drizzle:hasOwnEntityKind")},48689:(a,b,c)=>{c.d(b,{AU:()=>m,B3:()=>B,KJ:()=>w,KL:()=>s,Pe:()=>u,RK:()=>A,RO:()=>o,RV:()=>r,Tq:()=>x,Uo:()=>k,eq:()=>i,gt:()=>n,kZ:()=>t,lt:()=>p,mj:()=>z,ne:()=>j,o8:()=>y,or:()=>l,q1:()=>C,t2:()=>v,wJ:()=>q});var d=c(80228),e=c(46493),f=c(7284),g=c(85766);function h(a,b){return!(0,g.eG)(b)||(0,g.qt)(a)||(0,e.is)(a,g.Iw)||(0,e.is)(a,g.Or)||(0,e.is)(a,d.V)||(0,e.is)(a,f.XI)||(0,e.is)(a,g.Ss)?a:new g.Iw(a,b)}let i=(a,b)=>(0,g.ll)`${a} = ${h(b,a)}`,j=(a,b)=>(0,g.ll)`${a} <> ${h(b,a)}`;function k(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" and ")),new g.DJ(")")])}function l(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" or ")),new g.DJ(")")])}function m(a){return(0,g.ll)`not ${a}`}let n=(a,b)=>(0,g.ll)`${a} > ${h(b,a)}`,o=(a,b)=>(0,g.ll)`${a} >= ${h(b,a)}`,p=(a,b)=>(0,g.ll)`${a} < ${h(b,a)}`,q=(a,b)=>(0,g.ll)`${a} <= ${h(b,a)}`;function r(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`false`:(0,g.ll)`${a} in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} in ${h(b,a)}`}function s(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`true`:(0,g.ll)`${a} not in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} not in ${h(b,a)}`}function t(a){return(0,g.ll)`${a} is null`}function u(a){return(0,g.ll)`${a} is not null`}function v(a){return(0,g.ll)`exists ${a}`}function w(a){return(0,g.ll)`not exists ${a}`}function x(a,b,c){return(0,g.ll)`${a} between ${h(b,a)} and ${h(c,a)}`}function y(a,b,c){return(0,g.ll)`${a} not between ${h(b,a)} and ${h(c,a)}`}function z(a,b){return(0,g.ll)`${a} like ${b}`}function A(a,b){return(0,g.ll)`${a} not like ${b}`}function B(a,b){return(0,g.ll)`${a} ilike ${b}`}function C(a,b){return(0,g.ll)`${a} not ilike ${b}`}},57004:(a,b,c)=>{c.d(b,{_z:()=>i});var d=c(46493),e=c(41313),f=c(31496);class g extends f.o{static [d.i]="SQLiteCustomColumnBuilder";constructor(a,b,c){super(a,"custom","SQLiteCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new h(a,this.config)}}class h extends f.v{static [d.i]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function i(a){return(b,c)=>{let{name:d,config:f}=(0,e.Ll)(b,c);return new g(d,f,a)}}},58040:(a,b,c)=>{c.d(b,{Qq:()=>k});var d=c(46493),e=c(41313),f=c(31496);class g extends f.o{static [d.i]="SQLiteTextBuilder";constructor(a,b){super(a,"string","SQLiteText"),this.config.enumValues=b.enum,this.config.length=b.length}build(a){return new h(a,this.config)}}class h extends f.v{static [d.i]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(a,b){super(a,b)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class i extends f.o{static [d.i]="SQLiteTextJsonBuilder";constructor(a){super(a,"json","SQLiteTextJson")}build(a){return new j(a,this.config)}}class j extends f.v{static [d.i]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(a){return JSON.parse(a)}mapToDriverValue(a){return JSON.stringify(a)}}function k(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return"json"===d.mode?new i(c):new g(c,d)}},71559:(a,b,c)=>{c.d(b,{Y:()=>e,i:()=>f});var d=c(85766);function e(a){return(0,d.ll)`${a} asc`}function f(a){return(0,d.ll)`${a} desc`}},80228:(a,b,c)=>{c.d(b,{V:()=>e});var d=c(46493);class e{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [d.i]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}},82543:(a,b,c)=>{c.d(b,{jo:()=>A,D:()=>B});var d=c(46493),e=c(7284),f=c(41313),g=c(31496);class h extends g.o{static [d.i]="SQLiteBigIntBuilder";constructor(a){super(a,"bigint","SQLiteBigInt")}build(a){return new i(a,this.config)}}class i extends g.v{static [d.i]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?BigInt((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):BigInt(f.su.decode(a))}mapToDriverValue(a){return Buffer.from(a.toString())}}class j extends g.o{static [d.i]="SQLiteBlobJsonBuilder";constructor(a){super(a,"json","SQLiteBlobJson")}build(a){return new k(a,this.config)}}class k extends g.v{static [d.i]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?JSON.parse((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):JSON.parse(f.su.decode(a))}mapToDriverValue(a){return Buffer.from(JSON.stringify(a))}}class l extends g.o{static [d.i]="SQLiteBlobBufferBuilder";constructor(a){super(a,"buffer","SQLiteBlobBuffer")}build(a){return new m(a,this.config)}}class m extends g.v{static [d.i]="SQLiteBlobBuffer";mapFromDriverValue(a){return Buffer.isBuffer(a)?a:Buffer.from(a)}getSQLType(){return"blob"}}function n(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode==="json"?new j(c):d?.mode==="bigint"?new h(c):new l(c)}var o=c(57004),p=c(20377);class q extends g.o{static [d.i]="SQLiteNumericBuilder";constructor(a){super(a,"string","SQLiteNumeric")}build(a){return new r(a,this.config)}}class r extends g.v{static [d.i]="SQLiteNumeric";mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return"numeric"}}class s extends g.o{static [d.i]="SQLiteNumericNumberBuilder";constructor(a){super(a,"number","SQLiteNumericNumber")}build(a){return new t(a,this.config)}}class t extends g.v{static [d.i]="SQLiteNumericNumber";mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return"numeric"}}class u extends g.o{static [d.i]="SQLiteNumericBigIntBuilder";constructor(a){super(a,"bigint","SQLiteNumericBigInt")}build(a){return new v(a,this.config)}}class v extends g.v{static [d.i]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function w(a,b){let{name:c,config:d}=(0,f.Ll)(a,b),e=d?.mode;return"number"===e?new s(c):"bigint"===e?new u(c):new q(c)}var x=c(19643),y=c(58040);let z=Symbol.for("drizzle:SQLiteInlineForeignKeys");class A extends e.XI{static [d.i]="SQLiteTable";static Symbol=Object.assign({},e.XI.Symbol,{InlineForeignKeys:z});[e.XI.Symbol.Columns];[z]=[];[e.XI.Symbol.ExtraConfigBuilder]=void 0}let B=(a,b,c)=>(function(a,b,c,d,f=a){let g=new A(a,void 0,f),h=Object.fromEntries(Object.entries("function"==typeof b?b({blob:n,customType:o._z,integer:p.nd,numeric:w,real:x.x,text:y.Qq}):b).map(([a,b])=>{b.setName(a);let c=b.build(g);return g[z].push(...b.buildForeignKeys(c,g)),[a,c]})),i=Object.assign(g,h);return i[e.XI.Symbol.Columns]=h,i[e.XI.Symbol.ExtraConfigColumns]=h,c&&(i[A.Symbol.ExtraConfigBuilder]=c),i})(a,b,c)},85766:(a,b,c)=>{let d,e;c.d(b,{Iw:()=>O,Or:()=>Q,Xs:()=>J,DJ:()=>I,Ss:()=>T,Ct:()=>R,eG:()=>L,qt:()=>H,ll:()=>P});var f=c(46493),g=c(98046),h=c(80228),i=c(35071);class j{static [f.i]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new k(a,this)}}class k{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [f.i]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[i.E],...d,c[0].table[i.E],...e];return a??`${f.join("_")}_fk`}}function l(a,...b){return a(...b)}function m(a,b){return`${a[i.E]}_${b.join("_")}_unique`}class n{constructor(a,b){this.name=b,this.columns=a}static [f.i]=null;columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new p(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class o{static [f.i]=null;name;constructor(a){this.name=a}on(...a){return new n(a,this.name)}}class p{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??m(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [f.i]=null;columns;name;nullsNotDistinct=!1;getName(){return this.name}}function q(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}class r extends g.Q{foreignKeyConfigs=[];static [f.i]="PgColumnBuilder";array(a){return new v(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>l((c,d)=>{let e=new j(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new t(a,this.config)}}class s extends h.V{constructor(a,b){b.uniqueName||(b.uniqueName=m(a,[b.name])),super(a,b),this.table=a}static [f.i]="PgColumn"}class t extends s{static [f.i]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class u{static [f.i]=null;constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class v extends r{static [f.i]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new w(a,this.config,b)}}class w extends s{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [f.i]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=q(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=q(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:(0,f.is)(this.baseColumn,w)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}class x extends r{static [f.i]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new y(a,this.config)}}class y extends s{static [f.i]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let z=Symbol.for("drizzle:isPgEnum");class A extends r{static [f.i]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new B(a,this.config)}}class B extends s{static [f.i]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}var C=c(96176);let D={startActiveSpan:(a,b)=>d?(e||(e=d.trace.getTracer("drizzle-orm","0.44.6")),l((c,d)=>d.startActiveSpan(a,a=>{try{return b(a)}catch(b){throw a.setStatus({code:c.SpanStatusCode.ERROR,message:b instanceof Error?b.message:"Unknown error"}),b}finally{a.end()}}),d,e)):b()};var E=c(19593),F=c(7284);class G{static [f.i]=null}function H(a){return null!=a&&"function"==typeof a.getSQL}class I{static [f.i]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new J([this])}}class J{constructor(a){for(let b of(this.queryChunks=a,a))if((0,f.is)(b,F.XI)){let a=b[F.XI.Symbol.Schema];this.usedTables.push(void 0===a?b[F.XI.Symbol.Name]:a+"."+b[F.XI.Symbol.Name])}}static [f.i]="SQL";decoder=M;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return D.startActiveSpan("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:d,escapeName:e,escapeParam:g,prepareTyping:i,inlineParams:j,paramStartIndex:k}=c;var l=a.map(a=>{if((0,f.is)(a,I))return{sql:a.value.join(""),params:[]};if((0,f.is)(a,K))return{sql:e(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new I("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new I(", "));return b.push(new I(")")),this.buildQueryFromSourceParams(b,c)}if((0,f.is)(a,J))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:j||a.shouldInlineParams});if((0,f.is)(a,F.XI)){let b=a[F.XI.Symbol.Schema],c=a[F.XI.Symbol.Name];return{sql:void 0===b||a[F.HE]?e(c):e(b)+"."+e(c),params:[]}}if((0,f.is)(a,h.V)){let c=d.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:e(c),params:[]};let f=a.table[F.XI.Symbol.Schema];return{sql:a.table[F.HE]||void 0===f?e(a.table[F.XI.Symbol.Name])+"."+e(c):e(f)+"."+e(a.table[F.XI.Symbol.Name])+"."+e(c),params:[]}}if((0,f.is)(a,T)){let b=a[E.n].schema,c=a[E.n].name;return{sql:void 0===b||a[E.n].isAlias?e(c):e(b)+"."+e(c),params:[]}}if((0,f.is)(a,O)){if((0,f.is)(a.value,Q))return{sql:g(k.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if((0,f.is)(b,J))return this.buildQueryFromSourceParams([b],c);if(j)return{sql:this.mapInlineParam(b,c),params:[]};let d=["none"];return i&&(d=[i(a.encoder)]),{sql:g(k.value++,b),params:[b],typings:d}}return(0,f.is)(a,Q)?{sql:g(k.value++,a),params:[a],typings:["none"]}:(0,f.is)(a,J.Aliased)&&void 0!==a.fieldAlias?{sql:e(a.fieldAlias),params:[]}:(0,f.is)(a,C.n)?a._.isWith?{sql:e(a._.alias),params:[]}:this.buildQueryFromSourceParams([new I("("),a._.sql,new I(") "),new K(a._.alias)],c):a&&"function"==typeof a&&z in a&&!0===a[z]?a.schema?{sql:e(a.schema)+"."+e(a.enumName),params:[]}:{sql:e(a.enumName),params:[]}:H(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new I("("),a.getSQL(),new I(")")],c):j?{sql:this.mapInlineParam(a,c),params:[]}:{sql:g(k.value++,a),params:[a],typings:["none"]}});let m={sql:"",params:[]};for(let a of l)m.sql+=a.sql,m.params.push(...a.params),a.typings?.length&&(m.typings||(m.typings=[]),m.typings.push(...a.typings));return m}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new J.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class K{constructor(a){this.value=a}static [f.i]="Name";brand;getSQL(){return new J([this])}}function L(a){return"object"==typeof a&&null!==a&&"mapToDriverValue"in a&&"function"==typeof a.mapToDriverValue}let M={mapFromDriverValue:a=>a},N={mapToDriverValue:a=>a};({...M,...N});class O{constructor(a,b=N){this.value=a,this.encoder=b}static [f.i]="Param";brand;getSQL(){return new J([this])}}function P(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new I(a[0])),b.entries()))c.push(e,new I(a[d+1]));return new J(c)}(a=>{a.empty=function(){return new J([])},a.fromList=function(a){return new J(a)},a.raw=function(a){return new J([new I(a)])},a.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new J(c)},a.identifier=function(a){return new K(a)},a.placeholder=function(a){return new Q(a)},a.param=function(a,b){return new O(a,b)}})(P||(P={})),(a=>{class b{constructor(a,b){this.sql=a,this.fieldAlias=b}static [f.i]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new b(this.sql,this.fieldAlias)}}a.Aliased=b})(J||(J={}));class Q{constructor(a){this.name=a}static [f.i]="Placeholder";getSQL(){return new J([this])}}function R(a,b){return a.map(a=>{if((0,f.is)(a,Q)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if((0,f.is)(a,O)&&(0,f.is)(a.value,Q)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let S=Symbol.for("drizzle:IsDrizzleView");class T{static [f.i]="View";[E.n];[S]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[E.n]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new J([this])}}h.V.prototype.getSQL=function(){return new J([this])},F.XI.prototype.getSQL=function(){return new J([this])},C.n.prototype.getSQL=function(){return new J([this])}},96176:(a,b,c)=>{c.d(b,{J:()=>f,n:()=>e});var d=c(46493);class e{static [d.i]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class f extends e{static [d.i]="WithSubquery"}},98046:(a,b,c)=>{c.d(b,{Q:()=>e});var d=c(46493);class e{static [d.i]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}}};