(()=>{var a={};a.id=2877,a.ids=[2877],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3241:(a,b,c)=>{"use strict";c.d(b,{WorkoutSessionWithHealthAdvice:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call WorkoutSessionWithHealthAdvice() from the server but WorkoutSessionWithHealthAdvice is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/steven/swole-tracker/src/app/_components/WorkoutSessionWithHealthAdvice.tsx","WorkoutSessionWithHealthAdvice")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6342:(a,b,c)=>{"use strict";c.d(b,{Rf:()=>f,aF:()=>g});var d=c(38301),e=c(47434);function f(a){let{exerciseName:b,templateExerciseId:c,unit:f="kg",limitSessions:g=10,excludeSessionId:h}=a,i=e.F.insights.getExerciseInsights.useQuery({exerciseName:b,templateExerciseId:c,unit:f,limitSessions:g,excludeSessionId:h},{enabled:!!b,staleTime:3e4}),j=(0,d.useMemo)(()=>i.data??{unit:f,bestSet:void 0,best1RM:void 0,volumeSparkline:[],recommendation:void 0,suggestions:[]},[i.data,f]);return{...i,data:j}}function g(a){let b=a?.since,c=a?.limit??50;return e.F.insights.exportWorkoutsCSV.useQuery({since:b,limit:c},{enabled:!0,staleTime:0,refetchOnWindowFocus:!1})}},7360:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>n});var d=c(75338),e=c(65169),f=c.n(e),g=c(82161),h=c(58511),i=c(86802),j=c(830),k=c(3241),l=c(85156),m=c(52446);async function n({params:a}){let b,c=await (0,i.b3)(),e=await h.x.get({headers:{get:a=>c.get(a)}}),{id:n}=await a;(!e||h.x.isExpired(e))&&(0,g.redirect)("/auth/login");let o=parseInt(n);isNaN(o)&&(0,g.notFound)();try{b=await j.F.workouts.getById({id:o})}catch{(0,g.notFound)()}j.F.preferences.get.prefetch();let p=Array.isArray(b.exercises)?b.exercises:[],q=(()=>{let a=b.template;return a&&"object"==typeof a&&!Array.isArray(a)&&"string"==typeof a.name?a:{name:"Workout"}})(),r=`${p.length>0?"View Workout: ":""}${q.name}`,s=(()=>{let a=b.workoutDate;return a instanceof Date?a.toLocaleString():"string"==typeof a||"number"==typeof a?new Date(a).toLocaleString():new Date().toLocaleString()})();return(0,d.jsx)(j.d,{children:(0,d.jsxs)("main",{className:"min-h-screen overflow-x-hidden",children:[(0,d.jsx)(l.GlassHeader,{title:r,subtitle:s,actions:(0,d.jsx)(f(),{href:"/",children:(0,d.jsx)(m.Button,{variant:"ghost",size:"sm",children:"← Back"})})}),(0,d.jsx)("div",{className:"container mx-auto w-full min-w-0 px-3 py-4 sm:px-4 sm:py-6",children:(0,d.jsx)(k.WorkoutSessionWithHealthAdvice,{sessionId:o})})]})})}},8642:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(49754),e=c(9117),f=c(46595),g=c(32324),h=c(39326),i=c(38928),j=c(20175),k=c(12),l=c(54290),m=c(12696),n=c(82802),o=c(77533),p=c(45229),q=c(32822),r=c(261),s=c(26453),t=c(52474),u=c(26713),v=c(51356),w=c(62685),x=c(36225),y=c(63446),z=c(2762),A=c(45742),B=c(86439),C=c(81170),D=c.n(C),E=c(62506),F=c(91203),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H={children:["",{children:["workout",{children:["session",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,7360)),"/Users/steven/swole-tracker/src/app/workout/session/[id]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(c.bind(c,51472)),"/Users/steven/swole-tracker/src/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,81170,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.bind(c,59732)),"/Users/steven/swole-tracker/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,90461,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,32768,23)),"next/dist/client/components/builtin/unauthorized.js"]}]}.children,I=["/Users/steven/swole-tracker/src/app/workout/session/[id]/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/workout/session/[id]/page",pathname:"/workout/session/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/workout/session/[id]/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(33873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw aF||b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},17819:(a,b,c)=>{"use strict";c.d(b,{WorkoutSessionWithHealthAdvice:()=>Q});var d=c(21124),e=c(38301),f=c.n(e),g=c(35284),h=c(42378),i=c(3991),j=c.n(i);let k={dismissThreshold:150,velocityThreshold:8,friction:.95,minimumVelocity:.5,framesPerSecond:60};function l({name:a,isExpanded:b,previousBest:c,onToggleExpansion:e,onSwipeToBottom:f,exerciseIndex:g}){return(0,d.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex min-w-0 flex-col",children:[(0,d.jsx)("div",{className:"truncate text-base font-semibold",style:{color:"var(--color-text)"},children:a}),c&&(0,d.jsxs)("div",{className:"text-xs",style:{color:"var(--color-text-muted)"},children:["Prev best:"," ",void 0!==c.weight?`${c.weight}${c.unit}`:"-",void 0!==c.reps?` \xd7 ${c.reps}`:"",void 0!==c.sets?` (${c.sets} set${c.sets>1?"s":""})`:""]})]}),(0,d.jsx)("div",{className:"ml-3 flex shrink-0 items-center gap-2",children:(0,d.jsx)("button",{type:"button",className:"rounded border px-2 py-1 text-xs transition-colors",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-surface)",color:"var(--color-text)"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="var(--color-border)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="var(--color-bg-surface)"},onClick:a=>{a.stopPropagation(),e(g)},"aria-expanded":b,"aria-label":b?"Collapse exercise":"Expand exercise",children:b?"Collapse":"Expand"})})]})}var m=c(91850);function n({set:a,setIndex:b,exerciseIndex:c,exerciseName:f,templateExerciseId:g,onUpdate:h,onToggleUnit:i,onDelete:j,readOnly:k=!1,showDelete:l=!0,onMoveUp:n,onMoveDown:o,preferredUnit:p="kg"}){let q=(0,e.useRef)(null),r=(0,e.useRef)(null),s=(0,e.useRef)(null);(0,e.useRef)(null);let t=a=>{h(c,b,"rest",a)};return(0,d.jsxs)("div",{className:"glass-card glass-hairline text-foreground card-interactive flex items-center gap-3 rounded-lg p-3 select-none",children:[(0,d.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full text-xs font-medium",style:{backgroundColor:"var(--color-primary)",color:"var(--btn-primary-fg)"},children:b+1}),(0,d.jsxs)("div",{className:"flex flex-1 flex-wrap gap-3",children:[(0,d.jsxs)("div",{className:"min-w-[120px] flex-1",children:[(0,d.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Weight"}),(0,d.jsxs)("div",{className:"relative flex items-center",children:[(0,d.jsx)("input",{ref:q,type:"number",step:"0.5",inputMode:"decimal",pattern:"[0-9]*",value:a.weight??"",onChange:d=>{var e;h(c,b,"weight",e=d.target.value?parseFloat(d.target.value):void 0),e&&a.sets&&m.z.exerciseLogged(g?.toString()??"custom",f,a.sets,e)},onFocus:a=>{a.target.select();try{a.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch{}},placeholder:"0",disabled:k,className:`input-primary w-full pr-12 ${k?"cursor-not-allowed opacity-60":""}`}),(0,d.jsx)("span",{className:"pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-xs select-none",style:{color:"var(--color-text-muted)"},children:p})]})]}),(0,d.jsxs)("div",{className:"min-w-[100px] flex-1",children:[(0,d.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Reps"}),(0,d.jsx)("input",{ref:r,type:"number",inputMode:"numeric",pattern:"[0-9]*",value:a.reps??"",onChange:a=>{h(c,b,"reps",a.target.value?parseInt(a.target.value):void 0)},onFocus:a=>{a.target.select();try{a.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch{}},placeholder:"0",disabled:k,className:`input-primary w-full ${k?"cursor-not-allowed opacity-60":""}`})]}),(0,d.jsxs)("div",{className:"min-w-[100px] flex-1",children:[(0,d.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Sets"}),(0,d.jsx)("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",value:a.sets,onChange:a=>{h(c,b,"sets",(a.target.value?parseInt(a.target.value):1)??1)},onFocus:a=>{a.target.select();try{a.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch{}},placeholder:"1",min:"1",disabled:k,className:`input-primary w-full ${k?"cursor-not-allowed opacity-60":""}`})]}),(0,d.jsxs)("div",{className:"min-w-[160px]",children:[(0,d.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"RPE"}),(0,d.jsx)("div",{className:"flex items-center gap-1",children:[6,7,8,9,10].map(e=>{let f=a.rpe===e;return(0,d.jsx)("button",{type:"button",disabled:k,onClick:()=>!k&&void h(c,b,"rpe",e),className:`rounded-md px-2 py-1 text-xs ${f?"btn-primary":"btn-secondary"} ${k?"cursor-not-allowed opacity-60":""} `,children:e},e)})})]}),(0,d.jsxs)("div",{className:"min-w-[160px] flex-1",children:[(0,d.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Rest (s)"}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)("input",{ref:s,type:"number",inputMode:"numeric",pattern:"[0-9]*",value:a.rest??"",onChange:a=>{t(a.target.value?parseInt(a.target.value):void 0)},onFocus:a=>{a.target.select();try{a.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch{}},placeholder:"60",disabled:k,className:`input-primary w-full ${k?"cursor-not-allowed opacity-60":""}`}),[30,60,90].map(a=>(0,d.jsx)("button",{type:"button",disabled:k,onClick:()=>!k&&t(a),className:`btn-secondary rounded-md px-2 py-1 text-xs ${k?"cursor-not-allowed opacity-60":""}`,children:a},a))]})]})]}),!k&&(n||o)&&(0,d.jsxs)("div",{className:"mr-1 ml-1 flex flex-col gap-1",children:[(0,d.jsx)("button",{type:"button",onClick:()=>{console.log("[SetInput] Move Up button clicked",{exerciseIndex:c,setIndex:b}),n?.()},disabled:!n,className:"px-1 py-1 transition-colors disabled:cursor-not-allowed disabled:opacity-30",style:{color:"var(--color-text-secondary)"},onMouseEnter:a=>a.currentTarget.style.color="var(--color-text)",onMouseLeave:a=>a.currentTarget.style.color="var(--color-text-secondary)",title:"Move set up","aria-label":"Move set up",children:(0,d.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M7 14l5-5 5 5z"})})}),(0,d.jsx)("button",{type:"button",onClick:()=>{console.log("[SetInput] Move Down button clicked",{exerciseIndex:c,setIndex:b}),o?.()},disabled:!o,className:"px-1 py-1 transition-colors disabled:cursor-not-allowed disabled:opacity-30",style:{color:"var(--color-text-secondary)"},onMouseEnter:a=>a.currentTarget.style.color="var(--color-text)",onMouseLeave:a=>a.currentTarget.style.color="var(--color-text-secondary)",title:"Move set down","aria-label":"Move set down",children:(0,d.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:(0,d.jsx)("path",{d:"M7 10l5 5 5-5z"})})})]}),!k&&l&&(0,d.jsx)("button",{onClick:a=>{a.stopPropagation(),j(c,b)},onPointerDown:a=>a.stopPropagation(),onMouseDown:a=>a.stopPropagation(),onTouchStart:a=>a.stopPropagation(),className:"btn-destructive flex h-8 w-8 items-center justify-center rounded-full",title:"Delete set",children:"\xd7"})]})}function o({exerciseIndex:a,exerciseName:b,templateExerciseId:c,sets:e,readOnly:f,onUpdate:g,onToggleUnit:h,onAddSet:i,onDeleteSet:j,onMoveSet:k,preferredUnit:l="kg"}){return(0,d.jsxs)("div",{className:"space-y-2",children:[e.map((i,m)=>(0,d.jsx)(n,{set:i,setIndex:m,exerciseIndex:a,exerciseName:b,templateExerciseId:c,onUpdate:g,onToggleUnit:h,onDelete:j,readOnly:f,showDelete:e.length>1,preferredUnit:l,onMoveUp:m>0?()=>{console.log("[SetList] onMoveUp callback triggered",{exerciseIndex:a,setIndex:m}),k(a,m,"up")}:void 0,onMoveDown:m<e.length-1?()=>{console.log("[SetList] onMoveDown callback triggered",{exerciseIndex:a,setIndex:m}),k(a,m,"down")}:void 0},`${a}-${i.id}-${m}`)),!f&&(0,d.jsx)("div",{children:(0,d.jsx)("button",{className:"w-full rounded-md border border-border bg-background py-2 text-sm text-foreground transition-colors hover:bg-muted",onClick:b=>{b.preventDefault(),b.stopPropagation(),i(a)},children:"Add Set"})})]})}var p=c(77196);let q=[];function r(a){try{"undefined"!=typeof navigator&&navigator.vibrate&&navigator.vibrate(a)}catch{}}function s(){let a=(0,e.useRef)(null);function b(b,c){a.current&&a.current(b,c)}return b.__attach=b=>{a.current=b},b}var t=c(6342);function u({exercise:a,exerciseIndex:b,onUpdate:c,onToggleUnit:f,onAddSet:g,onDeleteSet:h,onMoveSet:i,isExpanded:j,onToggleExpansion:m,previousBest:n,previousSets:q,readOnly:u=!1,onSwipeToBottom:v,isDraggedOver:w=!1,isDragging:x=!1,dragOffset:y={x:0,y:0},swipeSettings:z,isSwiped:A=!1,draggable:B=!1,onPointerDown:C,setCardElement:D,preferredUnit:E="kg"}){let F=s(),[G,H,I]=function(a,b={},c="horizontal"){let d=(0,e.useMemo)(()=>({...k,...b}),[b]),[f,g]=(0,e.useState)(0),[h,i]=(0,e.useState)(0),[j,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)(0),[o,p]=(0,e.useState)(!1),q=(0,e.useRef)(null),r=(0,e.useRef)(null),s=(0,e.useRef)(0),t=(0,e.useRef)(0),u=(0,e.useRef)(0),v=(0,e.useRef)(null),w=(0,e.useRef)(!1),x=(0,e.useCallback)(()=>{v.current&&cancelAnimationFrame(v.current);let b=()=>{n(e=>{let f=e*d.friction;return .1>Math.abs(f)?("horizontal"===c?g(0):i(0),0):("horizontal"===c?g(b=>{let c=b+f;return Math.abs(c)>d.dismissThreshold||Math.abs(m)>d.velocityThreshold?(p(!0),a?.(),0):c}):i(b=>{let c=b+f;return Math.abs(c)>d.dismissThreshold||Math.abs(m)>d.velocityThreshold?(p(!0),a?.(),0):c}),v.current=requestAnimationFrame(b),f)})};v.current=requestAnimationFrame(b)},[d,c,m,a]),y=(0,e.useCallback)((a,b,c=!1)=>{q.current=a,r.current=b,s.current=a,t.current=b,u.current=Date.now(),l(!0),n(0),w.current=c,v.current&&cancelAnimationFrame(v.current)},[]),z=(0,e.useCallback)((a,b,e=!0)=>{if(!j||!q.current||!r.current)return;let f=a-q.current,h=b-r.current;if("horizontal"===c){if(Math.abs(f)>Math.abs(h)){g(f);let b=Date.now(),c=b-u.current,e=a-s.current;c>0&&n(e/c*(1e3/d.framesPerSecond)),s.current=a,u.current=b}}else if(Math.abs(h)>Math.abs(f)){i(h);let a=Date.now(),c=a-u.current,e=b-t.current;c>0&&n(e/c*(1e3/d.framesPerSecond)),t.current=b,u.current=a}},[j,c,d.framesPerSecond]),A=(0,e.useCallback)(()=>{j&&(l(!1),w.current=!1,Math.abs("horizontal"===c?f:h)>d.dismissThreshold||Math.abs(m)>d.velocityThreshold?(p(!0),a?.(),"horizontal"===c?g(0):i(0)):Math.abs(m)>d.minimumVelocity?x():"horizontal"===c?g(0):i(0))},[j,c,f,h,m,d,a,x]),B=(0,e.useCallback)(a=>{let b=a.touches[0];b&&y(b.clientX,b.clientY)},[y]),C=(0,e.useCallback)(a=>{let b=a.touches[0];b&&z(b.clientX,b.clientY,!1)},[z]),D=(0,e.useCallback)(()=>{A()},[A]),E=(0,e.useCallback)(a=>{a.preventDefault(),y(a.clientX,a.clientY,!0)},[y]),F=(0,e.useCallback)(a=>{w.current&&z(a.clientX,a.clientY)},[z]),G=(0,e.useCallback)(()=>{w.current&&A()},[A]),H=(0,e.useCallback)(()=>{w.current&&A()},[A]);return[{translateX:f,translateY:h,isDragging:j,velocity:m,isDismissed:o},{onTouchStart:B,onTouchMove:C,onTouchEnd:D,onMouseDown:E,onMouseMove:F,onMouseUp:G,onMouseLeave:H},(0,e.useCallback)(()=>{g(0),i(0),l(!1),n(0),p(!1),w.current=!1,v.current&&cancelAnimationFrame(v.current)},[])]}(()=>{if(v&&!u){try{r(10)}catch{}try{p.Ay.capture("haptic_action",{kind:"swipe"})}catch{}try{F(`Moved ${a.exerciseName} to end`,{assertive:!0})}catch{}v(b),setTimeout(()=>I(),50)}},z,"horizontal"),J=a.sets.some(a=>a.weight??a.reps),K=(()=>{if(0===a.sets.length)return null;let b=Math.max(...a.sets.map(a=>a.weight??0)),c=a.sets.find(a=>a.weight===b);return c?.weight?{weight:c.weight,reps:c.reps,sets:c.sets,unit:c.unit}:null})(),{data:L}=(0,t.Rf)({exerciseName:a.exerciseName,templateExerciseId:a.templateExerciseId,unit:a.unit,limitSessions:10}),M=G.isDragging&&Math.abs(G.translateX)>0,N=M&&G.translateX>0,O=M&&G.translateX<0,P=x&&Math.abs(y.y)>Math.abs(y.x),Q={transform:`translate(${P||G.isDismissed?0:G.translateX}px, ${P?y.y:0}px)`,opacity:P?.9:G.isDismissed?1:Math.max(.3,1-Math.abs(G.translateX)/300),scale:P?1.03:G.isDismissed?1:Math.max(.9,1-Math.abs(G.translateX)/600),zIndex:P?50:1,transition:G.isDragging&&M||P?"none":"transform var(--motion-duration-base) var(--motion-ease), opacity var(--motion-duration-base) var(--motion-ease), scale var(--motion-duration-base) var(--motion-ease)",touchAction:"pan-y pinch-zoom",willChange:P?"transform":void 0},R=`
    card glass-surface overflow-hidden select-none
    ${w?"glass-hairline":""}
    ${P?"shadow-xl cursor-grabbing":""}
  `.trim(),S=a=>{let b=a.target;!b.closest('[data-drag-handle="true"]')&&(b.closest("input,textarea,select,button,label,[contenteditable='true'],[role='textbox'],[role='spinbutton'],[role='button']")||("touches"in a?H.onTouchStart(a):H.onMouseDown(a)))},T=H.onMouseMove,U=H.onMouseUp,V=H.onMouseLeave,W=H.onTouchMove,X=H.onTouchEnd;return(0,d.jsxs)("div",{ref:D,className:R,style:Q,role:"group","aria-roledescription":"Exercise card","aria-label":`${a.exerciseName}`,onPointerDown:S,onMouseDown:S,onTouchStart:S,onMouseMove:T,onMouseUp:U,onMouseLeave:V,onTouchMove:W,onTouchEnd:X,children:[O&&!u&&(0,d.jsx)("div",{className:"glass-surface pointer-events-none absolute inset-y-0 right-2 my-auto flex h-6 items-center rounded px-2 text-xs",role:"status","aria-live":"polite",children:"Move to end →"}),N&&!u&&(0,d.jsxs)("div",{className:"glass-surface pointer-events-none absolute inset-y-0 left-2 my-auto flex h-6 items-center rounded px-2 text-xs",role:"status","aria-live":"polite",children:[j?"Collapse":"Expand"," ←"]}),(0,d.jsx)("div",{className:"hover:glass-hairline w-full cursor-pointer p-4 text-left transition-colors",role:"button","aria-expanded":j?"true":"false","aria-label":`${j?"Collapse":"Expand"} ${a.exerciseName}`,onClick:()=>m(b),children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("div",{className:"flex-1",children:(0,d.jsx)(l,{name:a.exerciseName,isExpanded:j,isSwiped:A,readOnly:u??!1,previousBest:J&&K?K:n,onToggleExpansion:m,onSwipeToBottom:v,exerciseIndex:b})}),B&&!u&&(0,d.jsx)("button",{type:"button","aria-label":"Drag to reorder","data-drag-handle":"true",className:"group ml-2 cursor-grab touch-none px-1 py-2 text-gray-400 hover:text-gray-200 active:cursor-grabbing",onPointerDown:a=>C?.(a,{force:!0}),onMouseDown:a=>C?.(a,{force:!0}),onTouchStart:a=>C?.(a,{force:!0}),style:{touchAction:"none"},title:"Drag to reorder",children:(0,d.jsxs)("span",{className:"inline-flex flex-col gap-0.5",children:[(0,d.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,d.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,d.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,d.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,d.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,d.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"})]})})]})}),j&&(0,d.jsxs)("div",{className:"space-y-3 px-4 pb-4",children:[!u&&(0,d.jsxs)("div",{className:"glass-surface glass-hairline rounded-lg p-3",children:[(0,d.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("span",{className:"text-secondary text-xs font-medium",children:"INSIGHTS"}),L?.bestSet?(0,d.jsxs)("span",{className:"text-sm",children:["Best:"," ",(0,d.jsxs)("strong",{children:[L.bestSet.weight,L.bestSet.unit]}),L.bestSet.reps?(0,d.jsxs)(d.Fragment,{children:[" \xd7 ",L.bestSet.reps]}):null,"number"==typeof L.best1RM?(0,d.jsxs)("span",{className:"text-muted ml-2 text-xs",children:["1RM≈ ",L.best1RM.toFixed(1),a.unit]}):null]}):(0,d.jsx)("span",{className:"text-muted text-sm",children:"No history yet"})]}),L?.recommendation?(0,d.jsx)("button",{type:"button",className:"glass-surface hover:glass-hairline ml-auto shrink-0 rounded-full px-3 py-1 text-xs transition-colors","aria-label":"Apply auto-progression recommendation",onClick:()=>{try{r(5)}catch{}try{let b=L.recommendation;p.Ay.capture("insights_apply_recommendation",{exerciseName:a.exerciseName,type:b?.type,nextWeight:b?.type==="weight"?b.nextWeight:void 0,nextReps:b?.type==="reps"?b.nextReps:void 0,unit:b?.unit})}catch(a){}let d=L.recommendation;if(d&&"weight"===d.type&&Object.prototype.hasOwnProperty.call(d,"nextWeight")&&"number"==typeof d.nextWeight)c(b,Math.max(0,a.sets.length-1),"weight",d.nextWeight);else if(d&&"reps"===d.type&&Object.prototype.hasOwnProperty.call(d,"nextReps")&&"number"==typeof d.nextReps){let e=a.sets.length-1,f=a.sets[Math.max(0,e)]?.reps??0;c(b,Math.max(0,e),"reps",f+(d.nextReps??0))}},title:L.recommendation.rationale,children:"weight"===L.recommendation.type?`Suggest: ${L.recommendation.nextWeight}${L.recommendation.unit}`:`Suggest: +${L.recommendation.nextReps} rep`}):null]}),L?.volumeSparkline&&L.volumeSparkline.length>=2&&(0,d.jsx)("div",{className:"mt-2",children:(0,d.jsx)("div",{className:"flex h-8 items-end gap-1","aria-hidden":"true",children:(()=>{let a=L.volumeSparkline.map(a=>a.volume),b=Math.max(...a),c=Math.min(...a),e=Math.max(1,b-c);return L.volumeSparkline.map((a,b)=>{let f=Math.round((a.volume-c)/e*100);return(0,d.jsx)("span",{className:"w-1.5 rounded-sm bg-emerald-500/70 dark:bg-emerald-400/70",style:{height:`${Math.max(8,f)}%`},title:`${new Date(a.date).toLocaleDateString()}: Vol ${a.volume.toFixed(0)}`},b)})})()})}),L?.suggestions&&L.suggestions.length>0&&(0,d.jsx)("ul",{className:"text-muted mt-2 list-disc space-y-1 pl-5 text-xs",children:L.suggestions.slice(0,2).map((a,b)=>(0,d.jsx)("li",{children:a.message},b))})]}),q&&q.length>0&&!u&&(0,d.jsxs)("div",{className:"glass-surface glass-hairline rounded-lg p-3",children:[(0,d.jsx)("h4",{className:"text-secondary mb-2 text-xs font-medium",children:"LAST WORKOUT"}),(0,d.jsx)("div",{className:"space-y-2",children:[...q].sort((a,b)=>{let c=a.weight??0,d=b.weight??0;return c!==d?d-c:q.indexOf(a)-q.indexOf(b)}).map((a,b)=>{let c=q.indexOf(a),e=0===b&&a.weight&&a.weight>0;return(0,d.jsxs)("div",{className:`flex items-center gap-3 text-sm ${e?"text-green-700 dark:text-green-300":"text-gray-700 dark:text-gray-300"}`,children:[(0,d.jsx)("div",{className:`flex h-6 w-6 items-center justify-center rounded-full text-xs ${e?"bg-green-600 text-background":"bg-muted text-muted-foreground"}`,children:c+1}),(0,d.jsxs)("div",{className:"flex gap-4",children:[a.weight&&(0,d.jsxs)("span",{className:e?"font-medium":"",children:[a.weight,a.unit]}),a.reps&&(0,d.jsxs)("span",{children:[a.reps," reps"]}),a.sets>1&&(0,d.jsxs)("span",{children:[a.sets," sets"]}),e&&(0,d.jsx)("span",{className:"text-xs text-green-700 dark:text-green-400",children:"← Best"})]})]},c)})})]}),(0,d.jsx)(o,{exerciseIndex:b,exerciseName:a.exerciseName,templateExerciseId:a.templateExerciseId,sets:a.sets,readOnly:u??!1,onUpdate:c,onToggleUnit:f,onAddSet:g,onDeleteSet:h,onMoveSet:i,preferredUnit:E})]})]})}var v=c(1002),w=c(96610),x=c(81793);function y(){return Date.now()}function z(a){}var A=c(47434);function B({sessionId:a}){let b=(0,h.useRouter)(),{invalidateWorkouts:c}=function(){let a=(0,w.useQueryClient)();return{invalidateWorkouts:()=>x.WG.workouts(a),invalidateTemplates:()=>x.WG.templates(a),invalidatePreferences:()=>x.WG.preferences(a),invalidateJokes:()=>x.WG.jokes(a),invalidateAll:()=>x.WG.all(a),onWorkoutStart:()=>{a.invalidateQueries({queryKey:["workouts","getRecent"]}),a.invalidateQueries({queryKey:["workouts","getLastExerciseData"]})},onWorkoutSave:()=>{x.WG.workouts(a)},optimisticWorkoutUpdate:(b,c)=>{a.setQueryData(["workouts","getRecent"],a=>a)}}}(),{exercises:f,expandedExercises:g,loading:i,isReadOnly:k,showDeleteConfirm:l,setShowDeleteConfirm:n,previousExerciseData:o,collapsedIndexes:t,saveWorkout:B,deleteWorkout:C,enqueue:D,swipeSettings:E,dragState:F,dragHandlers:G,getDisplayOrder:H,toggleExpansion:I,handleSwipeToBottom:J,updateSet:K,toggleUnit:L,addSet:M,deleteSet:N,moveSet:O,buildSavePayload:P,session:Q,preferences:R,setLastAction:S}=function({sessionId:a}){let[b,c]=(0,e.useState)([]),[d,f]=(0,e.useState)([0]),[g,h]=(0,e.useState)(!0),[i,j]=(0,e.useState)(!1),[k,l]=(0,e.useState)(!1),[m,n]=(0,e.useState)(new Map),[o,p]=(0,e.useState)(!1),[q,r]=(0,e.useState)([]),[s,t]=(0,e.useState)(null),[u,v]=(0,e.useState)([]),w=A.F.useUtils(),{data:x}=A.F.workouts.getById.useQuery({id:a},{enabled:a>0}),{data:B}=A.F.preferences.get.useQuery(),C=A.F.preferences.update.useMutation(),D=a=>{C.mutate(a)},{enqueue:E}=function(){let[a,b]=(0,e.useState)(()=>0),[c,d]=(0,e.useState)("idle"),[f,g]=(0,e.useState)(null),h=(0,e.useRef)(!1),i=A.F.useUtils(),j=A.F.workouts.save.useMutation(),k=(0,e.useCallback)(()=>{},[]),l=(0,e.useCallback)(a=>{let c=function(a){let b=[],c={id:`q_${Math.random().toString(36).slice(2)}_${y().toString(36)}`,type:"workout_save",payload:a,attempts:0,createdAt:y(),updatedAt:y()};return b.push(c),z(b),c.id}(a);return b(a=>a+1),c},[]),m=(0,e.useCallback)(async()=>{if(!h.current){h.current=!0,d("flushing"),g(null);try{for(z([].filter(a=>a.attempts<8));;){let d=function(){let a=[],b=a.shift();return b&&z(a),b}();if(!d)break;if("workout_save"===d.type)try{await j.mutateAsync({sessionId:d.payload.sessionId,exercises:d.payload.exercises}),await i.workouts.getRecent.invalidate(),b(a=>Math.max(0,a-1))}catch(f){let b=f&&"object"==typeof f&&"message"in f?String(f.message):"Network or server error",e=d.attempts+1;if(!function(a,b){let c=[],d=c.findIndex(b=>b.id===a);-1!==d&&(c[d]={...c[d],...b,updatedAt:y()})}(d.id,{attempts:e,lastError:b}),e>=8)g("Some items failed to sync after multiple attempts. See Sync Indicator for details.");else{await function(a){return new Promise(b=>setTimeout(b,a))}((a=d.attempts,Math.min(500*Math.pow(2,a),8e3)));var a,c={...d,attempts:e};let b=[];b.unshift(c)}break}}d("done")}catch{d("error"),g("Unexpected error while flushing queue.")}finally{h.current=!1,setTimeout(()=>d("idle"),500)}}},[j,i.workouts.getRecent]);return{queueSize:a,status:c,lastError:f,items:(0,e.useMemo)(()=>[],[]),enqueue:l,flush:m,refreshCount:k,isFlushing:"flushing"===c}}(),F=(0,e.useMemo)(()=>{if(!x)return;let a=x.template;if(a&&"object"==typeof a&&!Array.isArray(a))return a},[x]);(0,e.useMemo)(()=>{if(!F)return;let a=F.exercises;if(Array.isArray(a))return a.filter(a=>!(!a||"object"!=typeof a||Array.isArray(a))&&"number"==typeof a.id&&"string"==typeof a.exerciseName)},[F]);let G=(0,e.useRef)(0),H=(0,e.useCallback)(()=>b.map((a,b)=>({exercise:a,originalIndex:b})),[b]),I=(0,e.useMemo)(()=>H(),[H]),[J,K]=function(a,b,c,d){let[f,g]=(0,e.useState)(null),[h,i]=(0,e.useState)(null),[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)({x:0,y:0}),[n,o]=(0,e.useState)({x:0,y:0}),p=(0,e.useRef)(!1),q=(0,e.useRef)(0),r=(0,e.useRef)(!1),s=(0,e.useRef)(null),t=(0,e.useRef)([]),u=(0,e.useRef)(void 0),v=(0,e.useRef)(void 0),w=(0,e.useRef)(0),x=(0,e.useRef)(0),y=(0,e.useRef)(0),z=a=>{if("touches"in a){let b=a.touches;if(b&&b.length>0)return{x:b[0].clientX,y:b[0].clientY}}return"clientX"in a&&"clientY"in a?{x:a.clientX,y:a.clientY}:{x:0,y:0}},A=(0,e.useCallback)((a,b,c)=>{let d=0,e=1/0,f=0;for(let g=0;g<t.current.length;g++){let h=t.current[g];if(!h||g===c)continue;let i=h.getBoundingClientRect(),j=i.top+i.height/2,k=Math.abs(b-j);if(a>=i.left&&a<=i.right&&k<e&&(e=k,f=g),a>=i.left&&a<=i.right&&b<j)return g;a>=i.left&&a<=i.right&&(d=g+1)}if(e<1/0){let a=t.current[f];if(a){let c=a.getBoundingClientRect();return b>=c.top+c.height/2?f+1:f}}return d},[]),B=(0,e.useCallback)(a=>{let b=window.innerHeight,c=0;if(a<50?c=-Math.max(0,Math.round(6*Math.pow(Math.max(0,Math.min(1,(50-a)/50)),1.2))):a>b-50&&(c=Math.max(0,Math.round(6*Math.pow(Math.max(0,Math.min(1,(a-(b-50))/50)),1.2)))),w.current=c,0===c||v.current)0===c&&v.current&&(cancelAnimationFrame(v.current),v.current=void 0);else{let a=()=>{0!==w.current?(window.scrollBy(0,w.current),y.current=window.scrollY,v.current=requestAnimationFrame(a)):v.current=void 0};v.current=requestAnimationFrame(a)}},[]),C=(0,e.useCallback)(()=>{w.current=0,v.current&&(cancelAnimationFrame(v.current),v.current=void 0)},[]),D=(0,e.useCallback)((a,b)=>d=>{let e=d.target,f=!!e.closest('[data-drag-handle="true"]');console.log("[useUniversalDragReorder] onPointerDown called",{index:a,isHandle:f,targetTag:e.tagName,opts:b});let h=d.currentTarget;if(h){let a=a=>{try{a.preventDefault()}catch{}};h.addEventListener("touchmove",a,{passive:!1,once:!0}),h.addEventListener("pointermove",a,{passive:!1,once:!0}),h.addEventListener("mousemove",a,{passive:!1,once:!0})}if(!f&&(e.closest("button")||e.closest("input")||e.closest("select")))return;let i=d.currentTarget;if("pointerId"in d&&i&&"function"==typeof i.setPointerCapture)try{i.setPointerCapture(d.pointerId)}catch{}o(z(d)),g(a),q.current=Date.now(),r.current=!1,s.current=null,f||b?.force?(p.current=!0,r.current=!0,k(!0),c?.(a)):p.current=!1,x.current=window.scrollY,y.current=window.scrollY},[c]),E=(0,e.useCallback)(a=>{if(null===f)return;let b=z(a),d=b.x-n.x,e=b.y-n.y,g=Math.abs(d),j=Math.abs(e),l=Math.sqrt(d*d+e*e);if(!p.current){if(l<14||!(j>=.75*g))return;r.current=!0,p.current=!0,k(!0),c?.(f)}p.current&&r.current&&(console.log("[useUniversalDragReorder] onPointerMove - drag active",{draggedIndex:f,deltaX:d,deltaY:e,distance:l,dragOverIndex:h}),u.current&&cancelAnimationFrame(u.current),u.current=requestAnimationFrame(()=>{y.current=window.scrollY;let a=e+(y.current-x.current);if(m({x:0,y:a}),B(b.y),Math.abs(a)%8<4){let a=A(b.x,b.y,f);if(null===s.current||a!==s.current){let c=!0;if(null!==s.current){let a=t.current[Math.min(Math.max(s.current,0),t.current.length-1)];if(a){let d=a.getBoundingClientRect(),e=d.top+d.height/2;14>Math.abs(b.y-e)&&(c=!1)}}c&&(s.current=a,i(a))}}}))},[f,n,h,A,c,B]),F=(0,e.useCallback)(c=>{if(null!==f){if(p.current&&null!==h&&h!==f){console.log("[useUniversalDragReorder] onPointerUp - performing reorder",{draggedIndex:f,dragOverIndex:h});let c=[...a],d=c[f];if(d){c.splice(f,1);let a=h>f?h-1:h;c.splice(a,0,d),console.log("[useUniversalDragReorder] onReorder called with newItems",c.map(a=>a.identity??a.originalIndex)),b(c)}}console.log("[useUniversalDragReorder] onPointerUp - resetting state"),g(null),i(null),k(!1),m({x:0,y:0}),o({x:0,y:0}),p.current=!1,u.current&&(cancelAnimationFrame(u.current),u.current=void 0),C()}},[f,h,a,b,void 0,C]);return[{draggedIndex:f,dragOverIndex:h,isDragging:j,dragOffset:l,dragStartPos:n},{onPointerDown:D,onPointerMove:E,onPointerUp:F,setCardElement:(0,e.useCallback)((a,b)=>{t.current[a]=b},[])}]}(I,a=>{let e=b.map(a=>({name:a.exerciseName,templateExerciseId:a.templateExerciseId})),g=a.map(a=>a.exercise);c(g),t({type:"dragReorder",previousOrder:e});let h=a=>a.templateExerciseId??`name:${a.exerciseName}`,i=new Set(q.map(a=>b[a]).filter(Boolean).map(a=>h(a))),j=[];g.forEach((a,b)=>{i.has(h(a))&&j.push(b)}),r(j),f(d.map(a=>{let c=b[a]?.templateExerciseId;return g.findIndex(a=>a.templateExerciseId===c)}).filter(a=>-1!==a))},a=>{let b=I[a]?.originalIndex;void 0!==b&&f(a=>a.filter(a=>a!==b))}),L=A.F.workouts.save.useMutation({onMutate:async b=>{await w.workouts.getRecent.cancel();let c=w.workouts.getRecent.getData({limit:5});if(x&&F){let c={id:a,user_id:x.user_id,templateId:x.templateId,workoutDate:x.workoutDate,theme_used:x.theme_used??null,device_type:x.device_type??null,perf_metrics:x.perf_metrics??null,createdAt:new Date,updatedAt:new Date,template:F,exercises:b.exercises.flatMap((b,c)=>b.sets.map((d,e)=>({id:-(100*c+e),user_id:x.user_id,sessionId:a,templateExerciseId:b.templateExerciseId??null,exerciseName:b.exerciseName,setOrder:e,weight:d.weight??null,reps:d.reps??null,sets:d.sets??null,unit:d.unit,rpe:null,rest_seconds:null,is_estimate:!1,is_default_applied:!1,one_rm_estimate:null,volume_load:null,createdAt:new Date})))};w.workouts.getRecent.setData({limit:5},a=>a?[c,...a.slice(0,4)]:[c])}return{previousWorkouts:c}},onError:(a,b,c)=>{c?.previousWorkouts&&w.workouts.getRecent.setData({limit:5},c.previousWorkouts)},onSettled:()=>{w.workouts.getRecent.invalidate()}}),M=A.F.workouts.delete.useMutation({retry:!1,onMutate:async a=>{await w.workouts.getRecent.cancel();let b=w.workouts.getRecent.getData({limit:5}),c=a.id;return w.workouts.getRecent.setData({limit:5},a=>a?a.filter(a=>a.id!==c):[]),{previousWorkouts:b}},onSuccess:()=>{console.log("Workout deleted successfully")},onError:(a,b,c)=>{if(console.error("Failed to delete workout:",a.message),"Workout session not found"===a.message)return void console.log("Workout not found in database - likely an unsaved session, treating as successful deletion");c?.previousWorkouts&&w.workouts.getRecent.setData({limit:5},c.previousWorkouts)},onSettled:()=>{w.workouts.getRecent.invalidate()}}),N=(...a)=>{console.log("[WorkoutSessionState]",...a)},O=(0,e.useRef)(!1),P=(0,e.useRef)(!1),Q=(0,e.useRef)(!1),R=(0,e.useRef)(null),S=(0,e.useRef)(null),T=(a,d,e,f)=>{N("updateSet:start",{exerciseIndex:a,setIndex:d,field:e,value:f,len:b[a]?.sets.length});let g=[...b],h=g[a]?.sets[d];if(h){let b={[e]:h[e]};h[e]=f;let i={[e]:f};c(g),N("updateSet:applied",{exerciseIndex:a,setIndex:d,field:e,before:b,after:i}),t({type:"editSetFields",exerciseIndex:a,setIndex:d,before:b,after:i}),v([])}};return{exercises:b,setExercises:c,expandedExercises:d,setExpandedExercises:f,loading:g,isReadOnly:i,showDeleteConfirm:k,setShowDeleteConfirm:l,previousExerciseData:m,collapsedIndexes:q,utils:w,preferences:B,saveWorkout:L,deleteWorkout:M,enqueue:E,swipeSettings:{dismissThreshold:140,velocityThreshold:4,friction:.88,minimumVelocity:.15},dragState:J,dragHandlers:K,getDisplayOrder:H,toggleExpansion:a=>{let c=b[a];if(!c)return;let e=d.includes(a);f(b=>e?b.filter(b=>b!==a):[...b,a]),t({type:"toggleCollapse",exerciseId:(c.templateExerciseId??`name:${c.exerciseName}`).toString(),previousExpanded:e})},handleSwipeToBottom:a=>{c(b=>{if(a<0||a>=b.length)return b;let c=[...b],[d]=c.splice(a,1);if(!d)return b;let e=c.length;return c.push(d),t({type:"swipeToEnd",exerciseId:(d.templateExerciseId??`name:${d.exerciseName}`).toString(),fromIndex:a,toIndex:e}),c}),r(b=>[...b.filter(b=>b!==a),-1]),f(b=>b.filter(b=>b!==a))},updateSet:T,toggleUnit:(a,c)=>{let d=b[a]?.sets[c]?.unit??"kg",e="kg"===d?"lbs":"kg";t({type:"toggleUnit",exerciseIndex:a,setIndex:c,previousUnit:d}),v([]),T(a,c,"unit",e),D({defaultWeightUnit:e})},addSet:a=>{if(O.current)return void N("addSet:suppressedDuplicate",{exerciseIndex:a});O.current=!0,N("addSet:start",{exerciseIndex:a});let b=(()=>{let a=++G.current;return`set-${Date.now()}-${a}-${Math.random().toString(36).substr(2,9)}`})();c(c=>{let d,e;if(R.current===b)return N("addSet:suppressedDuplicateId",{exerciseIndex:a,newId:b}),c;let f=[...c],g=f[a];if(!g)return O.current=!1,c;if(g.sets.some(a=>a.id===b))return N("addSet:suppressedExistingId",{exerciseIndex:a,newId:b}),c;let h=g.sets[g.sets.length-1],i=B?.predictive_defaults_enabled===!0,j=1,k=h?.unit??g.unit;if(i){let a=[...g.sets].reverse().find(a=>(a.weight??a.reps??a.sets)!==void 0);a&&(d=a.weight,e=a.reps,j=a.sets??1)}let l={id:b,weight:d,reps:e,sets:j,unit:k},m=g.sets.map(a=>a.id);g.sets=[...g.sets,l];let n=g.sets.map(a=>a.id);return R.current=b,N("addSet:added",{exerciseIndex:a,newId:b,beforeIds:m,afterIds:n,totalSets:g.sets.length}),f}),t({type:"addSet",exerciseIndex:a,newSetId:b}),v([]),O.current=!1},deleteSet:(a,d)=>{if(P.current)return void N("deleteSet:suppressedDuplicate",{exerciseIndex:a,setIndex:d});P.current=!0,N("deleteSet:click",{exerciseIndex:a,setIndex:d,lenBefore:b[a]?.sets.length});let e=`delete-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,f=null,g=-1;c(b=>{if(S.current===e)return N("deleteSet:suppressedDuplicateOperation",{exerciseIndex:a,setIndex:d,operationId:e}),b;let c=[...b],h=c[a];if(!h)return N("deleteSet:exerciseNotFound",{exerciseIndex:a}),P.current=!1,b;if(0===h.sets.length)return N("deleteSet:noSets",{exerciseIndex:a}),P.current=!1,b;g=Math.max(0,Math.min(d,h.sets.length-1));let i=h.sets[g];if(!i)return N("deleteSet:setNotFound",{exerciseIndex:a,setIndex:d}),P.current=!1,b;S.current=e,f=i;let j=h.sets.map(a=>a.id);h.sets=h.sets.filter((a,b)=>b!==g);let k=h.sets.map(a=>a.id);return N("deleteSet:removed",{exerciseIndex:a,setIndex:g,removedId:i.id,beforeIds:j,afterIds:k,lenAfter:h.sets.length}),c}),f&&-1!==g&&(t({type:"deleteSet",exerciseIndex:a,deletedSet:{index:g,data:f}}),v([])),P.current=!1},moveSet:(a,b,d)=>{let e=`${a}-${b}-${d}`;if(console.log("[moveSet] Called with:",{exerciseIndex:a,setIndex:b,direction:d,operationKey:e}),Q.current)return void console.log("[moveSet] Operation already in progress, skipping");Q.current=!0,console.log("[moveSet] Starting move operation",{exerciseIndex:a,setIndex:b,direction:d}),setTimeout(()=>{Q.current=!1},100),c(c=>{let e=[...c],f=e[a];if(!f?.sets?.[b])return Q.current=!1,c;let g="up"===d?b-1:b+1;if(g<0||g>=f.sets.length)return console.log("[moveSet] Move out of bounds, skipping"),Q.current=!1,c;let h=[...f.sets],i=h[b],j=h[g];if(!i||!j)return console.log("[moveSet] Invalid sets for swap, skipping"),Q.current=!1,c;h[b]={...j},h[g]={...i},e[a]={...f,sets:h},console.log("[moveSet] Successfully moved set",d,{from:b,to:g}),t({type:"editSetFields",exerciseIndex:a,setIndex:g,before:{},after:{}}),v([]);let k={sessionId:x?.id||0,exercises:e.map(a=>({...a,sets:a.sets.filter(a=>void 0!==a.weight||void 0!==a.reps||void 0!==a.sets).map(a=>({...a,unit:a.unit||"kg"}))})).filter(a=>a.sets.length>0)};return console.log("[moveSet] Enqueuing save after move"),E(k),N("moveSet:applied",{exerciseIndex:a,setIndex:b,direction:d,newIndex:g}),e})},buildSavePayload:()=>({sessionId:a,exercises:b.map(a=>({...a,sets:a.sets.filter(a=>void 0!==a.weight||void 0!==a.reps||a.sets&&a.sets>0).map(a=>({...a,id:a.id??`offline-${Math.random().toString(36).slice(2)}`,weight:null===a.weight?void 0:a.weight,reps:null===a.reps?void 0:a.reps,sets:null===a.sets?1:a.sets}))})).filter(a=>a.sets.length>0)}),updatePreferences:D,session:x,lastAction:s,setLastAction:t,redoLastUndo:()=>{let a=u[0];a&&(v(u.slice(1)),"swipeToEnd"===a.type?c(b=>{let c=b.findIndex(b=>(b.templateExerciseId??`name:${b.exerciseName}`).toString()===a.exerciseId);if(-1===c)return b;let d=[...b],[e]=d.splice(c,1);return d.push(e),d}):"toggleCollapse"===a.type?f(c=>{let d=b.findIndex(b=>(b.templateExerciseId??`name:${b.exerciseName}`).toString()===a.exerciseId);if(-1===d)return c;let e=c.includes(d);return a.previousExpanded?c.filter(a=>a!==d):e?c:[...c,d]}):"dragReorder"===a.type||("addSet"===a.type?c(b=>{let c=[...b],d=c[a.exerciseIndex];return d?(d.sets.find(b=>b.id===a.newSetId)||d.sets.push({id:a.newSetId,unit:d.unit,sets:1}),c):b}):"deleteSet"===a.type?c(b=>{let c=[...b],d=c[a.exerciseIndex];if(!d)return b;let e=d.sets.findIndex(b=>b.id===a.deletedSet.data.id);return -1!==e&&d.sets.splice(e,1),c}):"toggleUnit"===a.type?c(b=>{let c=[...b];if("toggleUnit"!==a.type)return b;let d=c[a.exerciseIndex];if(!d)return b;let e=d.sets[a.setIndex];return e?(e.unit="kg"===a.previousUnit?"lbs":"kg",c):b}):"editSetFields"===a.type&&c(b=>{let c=[...b];if("editSetFields"!==a.type)return b;let d=c[a.exerciseIndex];if(!d)return b;let e=d.sets[a.setIndex];return e?(Object.assign(e,a.after),c):b})))},redoStack:u,undoLastAction:()=>{s&&(v(a=>[s,...a].slice(0,30)),"swipeToEnd"===s.type?(c(a=>{let b=a.findIndex(a=>(a.templateExerciseId??`name:${a.exerciseName}`).toString()===s.exerciseId);if(-1===b)return a;let c=[...a],[d]=c.splice(b,1);return c.splice(s.fromIndex,0,d),c}),r(a=>a.filter(a=>-1!==a))):"toggleCollapse"===s.type?f(a=>{let c=b.findIndex(a=>(a.templateExerciseId??`name:${a.exerciseName}`).toString()===s.exerciseId);if(-1===c)return a;let d=a.includes(c);return s.previousExpanded&&!d?[...a,c]:!s.previousExpanded&&d?a.filter(a=>a!==c):a}):"dragReorder"===s.type?c(a=>{let b=a=>(a.templateExerciseId??`name:${a.exerciseName}`).toString(),c=new Map(a.map(a=>[b(a),a])),d=[];for(let a of s.previousOrder){let b=(a.templateExerciseId??`name:${a.name}`).toString(),e=c.get(b);e&&d.push(e)}for(let c of a){let a=b(c);d.find(c=>b(c)===a)||d.push(c)}return d}):"addSet"===s.type?c(a=>{let b=[...a],c=b[s.exerciseIndex];if(!c)return a;let d=c.sets.findIndex(a=>a.id===s.newSetId);return -1!==d&&c.sets.splice(d,1),b}):"deleteSet"===s.type?c(a=>{let b=[...a],c=b[s.exerciseIndex];if(!c)return a;let d=Math.min(Math.max(0,s.deletedSet.index),c.sets.length);return c.sets.splice(d,0,s.deletedSet.data),b}):"toggleUnit"===s.type?c(a=>{let b=[...a];if("toggleUnit"!==s.type)return a;let c=b[s.exerciseIndex];if(!c)return a;let d=c.sets[s.setIndex];return d?(d.unit=s.previousUnit,b):a}):"editSetFields"===s.type&&c(a=>{let b=[...a],c=b[s.exerciseIndex];if(!c)return a;let d=c.sets[s.setIndex];return d?(Object.assign(d,s.before),b):a}),t(null))}}}({sessionId:a}),[T,U]=(0,e.useState)(0),[V,W]=(0,e.useState)(!1),X=s(),{restoreFocus:Y}=(0,v.G)(),Z=H(),$=Z.length,_=$>=20,aa=_?Math.max(0,Math.floor(T/120)-6):0,ab=_?Math.min($-1,Math.ceil((T+800)/120)+6):$-1,ac=()=>{W(!1)},ad=a=>{try{r(a)}catch{}},ae=async()=>{let b=[];if(f.forEach((a,c)=>{a.sets.forEach((c,d)=>{(void 0!==c.weight||void 0!==c.reps||c.sets&&c.sets>0)&&(void 0!==c.weight&&(null===c.weight||isNaN(c.weight))&&b.push(`${a.exerciseName}, Set ${d+1}: Weight must be a valid number`),void 0!==c.reps&&(null===c.reps||isNaN(c.reps)||c.reps<=0)&&b.push(`${a.exerciseName}, Set ${d+1}: Reps must be a valid positive number`),void 0!==c.sets&&(null===c.sets||isNaN(c.sets)||c.sets<=0)&&b.push(`${a.exerciseName}, Set ${d+1}: Sets must be a valid positive number`))})}),b.length>0)return void console.error("Validation errors:",b);try{let a=P();if("undefined"!=typeof navigator&&!1===navigator.onLine)return void D(a);await B.mutateAsync(a)}catch(c){console.error("Error saving workout:",c),m.z.error(c,{context:"workout_save",sessionId:a?.toString()||"unknown"});let b=c&&"object"==typeof c&&"message"in c?String(c.message):"";if(b.includes("Failed to fetch")||b.includes("NetworkError")||b.includes("TypeError"))return void D(P());b.includes("Expected number, received null")||b.includes("invalid_type")?console.error("Validation error:",b):console.error("Error saving workout:",b||"Unknown error")}},af=async()=>{if(C.isPending)return void console.log("Delete already in progress, ignoring duplicate call");if(!a||"number"!=typeof a){console.error("Invalid sessionId for workout deletion:",a),alert("Cannot delete workout: invalid session ID");return}try{console.log("Attempting to delete workout session:",a),await C.mutateAsync({id:a}),console.log("Workout deletion completed successfully"),n(!1),b.push("/")}catch(c){console.error("Unexpected error during workout deletion:",c),m.z.error(c,{context:"workout_delete",sessionId:a?.toString()||"unknown"}),n(!1),b.push("/")}};return i||!Q?(0,d.jsx)("div",{className:"space-y-3 sm:space-y-4",children:[void 0,void 0,void 0].map((a,b)=>(0,d.jsxs)("div",{className:"animate-pulse rounded-lg p-3 sm:p-4",style:{backgroundColor:"var(--color-bg-surface)"},children:[(0,d.jsx)("div",{className:"mb-3 h-3 w-1/2 rounded sm:mb-4 sm:h-4",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[(0,d.jsx)("div",{className:"h-8 rounded sm:h-10",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsx)("div",{className:"h-8 rounded sm:h-10",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsx)("div",{className:"h-8 rounded sm:h-10",style:{backgroundColor:"var(--color-border)"}})]})]},b))}):(0,d.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[!k&&f.length>0&&(0,d.jsxs)("div",{className:"text-muted mb-2 px-2 text-center text-xs sm:text-sm",children:["\uD83D\uDCA1 ",(0,d.jsx)("strong",{children:"Tip:"})," Swipe ← → to move to bottom • Drag ↕ to reorder & move between sections • Works on mobile & desktop"]}),(_?Z.slice(aa,ab+1).map((a,b)=>({...a,windowIndex:aa+b})):Z.map((a,b)=>({...a,windowIndex:b}))).map(({exercise:a,originalIndex:b,windowIndex:c})=>{let e=t.includes(c),f=!e&&g.includes(b);return(0,d.jsx)("div",{style:_?{minHeight:0}:void 0,children:(0,d.jsx)(u,{exercise:a,exerciseIndex:b,onUpdate:K,onToggleUnit:L,onAddSet:M,onDeleteSet:N,onMoveSet:O,isExpanded:f,onToggleExpansion:I,previousBest:o.get(a.exerciseName)?.best,previousSets:o.get(a.exerciseName)?.sets,readOnly:k,onSwipeToBottom:J,swipeSettings:E,isSwiped:e,draggable:!k,isDraggedOver:F.dragOverIndex===c||F.dragOverIndex===c+1,isDragging:F.isDragging&&F.draggedIndex===c,dragOffset:F.dragOffset,onPointerDown:G.onPointerDown(c),setCardElement:a=>G.setCardElement?.(c,a),preferredUnit:R?.defaultWeightUnit??"kg"})},a.templateExerciseId??b)}),0===f.length&&(0,d.jsx)("div",{className:"py-6 text-center sm:py-8",children:(0,d.jsx)("p",{className:"text-secondary text-sm sm:text-base",children:"No exercises in this template"})}),!k&&(0,d.jsx)("div",{className:"sticky bottom-2 z-50 pt-4 sm:bottom-4 sm:pt-6",role:"region","aria-label":"Workout actions",children:(0,d.jsxs)("div",{className:"glass-surface glass-hairline rounded-xl p-2 shadow-lg sm:p-3",children:[(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-1 sm:gap-2",children:[(0,d.jsx)("button",{onClick:a=>{if(a.preventDefault(),a.stopPropagation(),a.nativeEvent?._addSetHandled)return;a.nativeEvent._addSetHandled=!0;let b=void 0!==g[0]?g[0]:0;if("number"==typeof b){M(b),S(null),ad(10);try{p.Ay.capture("haptic_action",{kind:"add_set"})}catch{}try{X("Set added",{assertive:!1})}catch{}try{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}catch{}}},onPointerDown:a=>a.stopPropagation(),onMouseDown:a=>a.stopPropagation(),onTouchStart:a=>a.stopPropagation(),className:"btn-secondary py-2 text-sm sm:py-3 sm:text-base","aria-label":"Add set to current exercise",children:"Add Set"}),(0,d.jsx)("button",{onClick:async()=>{try{let a=function(){if("undefined"==typeof document)return null;try{return document.documentElement.dataset.theme||null}catch{return null}}(),b=function(){if("undefined"==typeof navigator)return"unknown";let a=navigator.userAgent||navigator.vendor||"";return"undefined"!=typeof document&&/Macintosh/i.test(a)&&document.ontouchend||/iPad/i.test(a)?"ipad":/iPod|iPhone/i.test(a)?"ios":/Android/i.test(a)?"android":/Windows|Macintosh|Linux/i.test(a)||/CrOS/i.test(a)||/X11/i.test(a)?"desktop":navigator.vendor&&/(Apple|Google|Microsoft|Opera)/i.test(navigator.vendor)?"other":"unknown"}(),c=function(){try{let{tti:a,tbt:b}=function(){if("undefined"==typeof performance)return{};try{let a,b,c=performance.getEntriesByType("navigation"),d=performance.getEntriesByType("paint"),e=c[0],f=d.find(a=>"first-contentful-paint"===a.name);if(a=e&&f?f.startTime+100:e?e.domContentLoadedEventEnd:performance.now(),e){let a=e.loadEventEnd-e.loadEventStart;b=Math.max(0,a-50)}else b=0;return{tti:a,tbt:b}}catch{return{}}}(),c=function(){let a=[...q];if(0===a.length)return{samples:[]};let b=a.reduce((a,b)=>a+b,0)/a.length,c=function(a){if(0===a.length)return;let b=[...a].sort((a,b)=>a-b),c=Math.floor(.95*b.length);return b[c]}(a);return{samples:a,avg:b,p95:c}}();return{tti:a,tbt:b,inputLatency:{avg:c.avg,p95:c.p95},ts:Date.now()}}catch{return{ts:Date.now()}}}();p.Ay.capture("workout_save",{theme_used:a,device_type:b,tti:c.tti,tbt:c.tbt,input_latency_avg:c.inputLatency?.avg,input_latency_p95:c.inputLatency?.p95})}catch{}await ae(),ad([10,30,10]);try{p.Ay.capture("haptic_action",{kind:"save"})}catch{}try{X("Workout saved",{assertive:!0})}catch{}},disabled:B.isPending,className:"btn-secondary py-2 text-sm disabled:opacity-50 sm:py-3 sm:text-base","aria-busy":B.isPending?"true":"false","aria-label":"Save workout",children:B.isPending?"Saving…":"Save"}),(0,d.jsx)("button",{onClick:()=>{W(!0),ad(10);try{p.Ay.capture("haptic_action",{kind:"save"})}catch{}},className:"btn-primary py-2 text-sm sm:py-3 sm:text-base",children:"Complete"})]}),(0,d.jsxs)("div",{className:"mt-1.5 text-center sm:mt-2",children:[(0,d.jsx)("button",{onClick:()=>{n(!0),S(null),ad(10)},disabled:C.isPending,className:"btn-destructive px-3 py-1.5 text-xs font-semibold disabled:opacity-50 sm:px-4 sm:py-2 sm:text-sm","aria-describedby":"delete-workout-help",children:C.isPending?"Deleting…":"Delete Workout"}),(0,d.jsx)("span",{id:"delete-workout-help",className:"sr-only",children:"Opens a confirmation dialog"})]})]})}),k&&(0,d.jsxs)("div",{className:"sticky bottom-4 space-y-2 pt-6 sm:space-y-3",children:[(0,d.jsx)(j(),{href:`/workout/start?templateId=${Q?.templateId}`,className:"btn-primary block w-full py-2.5 text-center text-base font-medium sm:py-3 sm:text-lg",children:"Repeat This Workout"}),(0,d.jsx)("button",{onClick:()=>n(!0),disabled:C.isPending,className:"btn-destructive w-full py-2.5 text-base font-medium disabled:opacity-50 sm:py-3 sm:text-lg",children:C.isPending?"Deleting...":"Delete Workout"}),(0,d.jsx)("button",{onClick:()=>b.back(),className:"btn-secondary w-full py-2.5 text-base font-medium sm:py-3 sm:text-lg",children:"Back to History"})]}),l&&(0,d.jsx)("div",{className:"bg-opacity-75 bg-background fixed inset-0 z-[9999] flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"delete-workout-title","aria-describedby":"delete-workout-desc",onClick:()=>{Y(),n(!1)},children:(0,d.jsx)(v.s,{onEscape:()=>{Y(),n(!1)},preventScroll:!0,children:(0,d.jsxs)("div",{className:"card w-full max-w-md p-4 shadow-2xl sm:p-6",onClick:a=>a.stopPropagation(),children:[(0,d.jsx)("h3",{id:"delete-workout-title",className:"mb-3 text-lg font-bold sm:mb-4 sm:text-xl",style:{color:"var(--color-danger)"},children:"Delete Workout"}),(0,d.jsxs)("p",{id:"delete-workout-desc",className:"text-secondary mb-4 text-sm leading-relaxed sm:mb-6 sm:text-base",children:["Are you sure you want to delete this workout?",(0,d.jsx)("br",{}),(0,d.jsx)("strong",{style:{color:"var(--color-danger)"},children:"This action cannot be undone."})]}),(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)("button",{onClick:()=>{Y(),n(!1)},className:"btn-secondary flex-1 py-2.5 text-sm font-medium sm:py-3 sm:text-base",children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{Y(),n(!1),af()},disabled:C.isPending,className:"btn-destructive flex-1 py-2.5 text-sm font-medium disabled:opacity-50 sm:py-3 sm:text-base",children:C.isPending?"Deleting...":"Yes, Delete"})]})]})})}),V&&(0,d.jsx)("div",{className:"bg-opacity-75 bg-background fixed inset-0 z-[9999] flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"complete-workout-title","aria-describedby":"complete-workout-desc",onClick:()=>{Y(),ac()},children:(0,d.jsx)(v.s,{onEscape:()=>{Y(),ac()},preventScroll:!0,children:(0,d.jsxs)("div",{className:"card w-full max-w-lg p-4 shadow-2xl sm:p-6",onClick:a=>a.stopPropagation(),children:[(0,d.jsx)("h3",{id:"complete-workout-title",className:"mb-1 text-lg font-bold sm:text-xl",style:{color:"var(--color-primary)"},children:"Complete Workout"}),(0,d.jsx)("p",{id:"complete-workout-desc",className:"text-secondary mb-3 text-xs sm:mb-4 sm:text-sm",children:"Review your performance compared to your previous best for each exercise."}),(0,d.jsx)("div",{className:"max-h-[50vh] overflow-y-auto pr-1",children:(0,d.jsx)("div",{className:"space-y-3",children:f.map((a,b)=>{let c=(a=>{if(!a.sets||0===a.sets.length)return{};let b=Math.max(...a.sets.map(a=>a.weight??0)),c=a.sets.filter(a=>(a.weight??0)===b).sort((a,b)=>(b.reps??0)-(a.reps??0))[0],d=a.sets.map(a=>({...a,volume:(a.weight??0)*(a.reps??0)})).filter(a=>a.volume&&a.volume>0).sort((a,b)=>b.volume-a.volume)[0];return{bestWeight:c?.weight?{weight:c.weight,reps:c.reps,sets:c.sets,unit:c.unit}:void 0,bestVolume:d?{volume:d.volume,weight:d.weight,reps:d.reps,unit:d.unit}:void 0}})(a),e=o.get(a.exerciseName)?.best,f=(c.bestWeight?.weight??0)-(e?.weight??0),g=c.bestWeight&&e?f>0?{color:"var(--color-success)"}:f<0?{color:"var(--color-danger)"}:{color:"var(--color-text-muted)"}:{color:"var(--color-text-muted)"},h=c.bestVolume?.volume??0,i=h-(e?.weight??0)*(e?.reps??0),j=h&&e?i>0?{color:"var(--color-success)"}:i<0?{color:"var(--color-danger)"}:{color:"var(--color-text-muted)"}:{color:"var(--color-text-muted)"},k=(a,b,c)=>a?`${a}${c??"kg"}${b?` \xd7 ${b}`:""}`:"N/A";return(0,d.jsxs)("div",{className:"card p-3",children:[(0,d.jsx)("div",{className:"mb-2 text-sm font-semibold",children:a.exerciseName}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-muted mb-1 text-xs",children:"Previous Best"}),(0,d.jsxs)("div",{children:["Weight:"," ",k(e?.weight,e?.reps,e?.unit)]}),(0,d.jsxs)("div",{children:["Volume:"," ",e?(e.weight??0)*(e.reps??0):"N/A"]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-muted mb-1 text-xs",children:"Current Best"}),(0,d.jsxs)("div",{style:g,children:["Weight:"," ",k(c.bestWeight?.weight,c.bestWeight?.reps,c.bestWeight?.unit),e&&c.bestWeight?.weight!==void 0?(0,d.jsx)("span",{className:"ml-2 text-xs opacity-80",children:f>0?`(+${f})`:f<0?`(${f})`:"(=)"}):null]}),(0,d.jsxs)("div",{style:j,children:["Volume: ",c.bestVolume?.volume??"N/A",e?(0,d.jsx)("span",{className:"ml-2 text-xs opacity-80",children:i>0?`(+${i})`:i<0?`(${i})`:"(=)"}):null]})]})]})]},`${a.exerciseName}-${b}`)})})}),(0,d.jsxs)("div",{className:"mt-4 flex items-center gap-3 sm:mt-5",children:[(0,d.jsx)("button",{onClick:async()=>{ac(),await ae(),b.push("/")},className:"btn-primary flex-1 py-2.5 text-base font-semibold sm:py-3 sm:text-lg",children:"Complete Workout"}),(0,d.jsx)("button",{onClick:ac,className:"btn-secondary flex-1 py-2.5 text-base font-medium sm:py-3 sm:text-lg",children:"Continue Workout"})]})]})})})]})}var C=c(62186);function D(...a){return a.filter(Boolean).join(" ")}function E({rho:a,flags:b,overloadMultiplier:c}){let e=Math.round(100*a),f=a>=.8?"high":a>=.6?"medium":a>=.35?"low":"very-low";return(0,d.jsxs)(C.Zp,{className:"p-4 space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Readiness Score"}),(0,d.jsxs)("span",{className:D("text-2xl font-bold",({"very-low":"text-red-600 bg-red-50 border-red-200",low:"text-orange-600 bg-orange-50 border-orange-200",medium:"text-yellow-600 bg-yellow-50 border-yellow-200",high:"text-green-600 bg-green-50 border-green-200"})[f].split(" ")[0]),children:[e,"%"]})]}),(0,d.jsx)("div",{className:"w-full rounded-full h-3",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 50%, var(--color-border) 50%)"},children:(0,d.jsx)("div",{className:D("h-3 rounded-full transition-all duration-300",{"very-low":"bg-red-500",low:"bg-orange-500",medium:"bg-yellow-500",high:"bg-green-500"}[f]),style:{width:`${e}%`}})}),(0,d.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,d.jsx)("span",{className:"text-muted",children:"Load Adjustment:"}),(0,d.jsxs)("span",{className:D("font-semibold",c>1?"text-blue-600":c<1?"text-orange-600":"text-gray-600"),children:[c>1?"+":"",Math.round((c-1)*100),"%"]})]}),b.length>0&&(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("h4",{className:"text-sm font-medium text-secondary",children:"Status Flags:"}),(0,d.jsx)("div",{className:"flex flex-wrap gap-1",children:b.map((a,b)=>(0,d.jsx)("span",{className:D("px-2 py-1 text-xs rounded-full border",a.includes("good")||a.includes("high")?"text-green-700 bg-green-50 border-green-200":a.includes("low")||a.includes("poor")||a.includes("missing")?"text-orange-700 bg-orange-50 border-orange-200":"text-gray-700 bg-gray-50 border-gray-200"),children:a.replace("_"," ")},b))})]})]})}function F({sessionId:a,readiness:b,overloadMultiplier:c,userAcceptedSuggestions:d,totalSuggestions:e,modelUsed:f,responseTime:g,hasWhoopData:h,experienceLevel:i,flags:j=[],warnings:k=[],hasManualWellness:l=!1,manualWellnessData:n}){m.z.featureUsed("health_advice",{sessionId:a,readiness:b,overloadMultiplier:c,acceptanceRate:e>0?d/e:0,modelUsed:f,hasWhoopData:h,experienceLevel:i,flagsCount:j.length,warningsCount:k.length})}function G({sessionId:a,errorType:b,errorMessage:c,modelUsed:d,hasWhoopData:e,experienceLevel:f}){m.z.error(Error(c),{context:"health_advice",sessionId:a,errorType:b,modelUsed:d,hasWhoopData:e,experienceLevel:f})}function H({sessionId:a,totalDuration:b,aiGenerationTime:c,serverProcessingTime:d,modelUsed:e,inputSize:f,outputSize:g}){b>3e3&&m.z.featureUsed("health_advice_slow_response",{sessionId:a,totalDuration:b,modelUsed:e,aiGenerationTime:c,serverProcessingTime:d,performance_issue:"slow_response"})}function I(...a){return a.filter(Boolean).join(" ")}function J({exercise:a,onAcceptSuggestion:b,onOverrideSuggestion:c,sessionId:f}){let[h,i]=(0,e.useState)(new Set),[j,k]=(0,e.useState)({}),l=(c,d,e="ai_recommended")=>{if(i(a=>new Set(a).add(c)),b(c,d),f){let b=a.sets.find(a=>a.set_id===c);b&&(void 0!==d.weight&&void 0!==b.suggested_weight_kg&&(a.exercise_id,b.suggested_weight_kg,d.weight),void 0!==d.reps&&void 0!==b.suggested_reps&&(a.exercise_id,b.suggested_reps,d.reps))}},m=Math.round(100*a.predicted_chance_to_beat_best),n=a.predicted_chance_to_beat_best>=.7?"text-success":a.predicted_chance_to_beat_best>=.5?"text-warning":"text-danger";return(0,d.jsxs)(C.Zp,{className:"space-y-4 p-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:a.name||a.exercise_id}),(0,d.jsxs)("div",{className:"text-right",children:[(0,d.jsx)("div",{className:"text-muted text-sm",children:"Beat Best Chance"}),(0,d.jsxs)("div",{className:I("text-lg font-bold",n),children:[m,"%"]})]})]}),(a.planned_volume_kg||a.best_volume_kg)&&(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4 rounded-lg p-3",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 50%, var(--color-bg-app) 50%)"},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-muted text-xs",children:"Planned Volume"}),(0,d.jsx)("div",{className:"font-semibold",children:a.planned_volume_kg?`${a.planned_volume_kg}kg`:"N/A"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-muted text-xs",children:"Best Volume"}),(0,d.jsx)("div",{className:"font-semibold",children:a.best_volume_kg?`${a.best_volume_kg}kg`:"N/A"})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("h4",{className:"text-md font-medium",style:{color:"var(--color-text)"},children:"Set Suggestions"}),a.sets.map((b,e)=>{let m=h.has(b.set_id);return(0,d.jsxs)("div",{className:I("rounded-lg border p-3 transition-all",m?"border-green-200 dark:border-green-700":""),style:{backgroundColor:m?"color-mix(in oklab, var(--color-success) 10%, var(--color-bg-surface))":"var(--color-bg-surface)",borderColor:m?"var(--color-success)":"var(--color-border)"},children:[(0,d.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,d.jsxs)("span",{className:"text-sm font-medium",children:["Set ",e+1]}),(0,d.jsx)("div",{className:"flex gap-2",children:m?(0,d.jsx)(g.Button,{size:"sm",variant:"secondary",onClick:()=>(b=>{if(i(a=>{let c=new Set(a);return c.delete(b),c}),c(b),f){let c=a.sets.find(a=>a.set_id===b);c&&(void 0!==c.suggested_weight_kg&&(a.exercise_id,c.suggested_weight_kg),void 0!==c.suggested_reps&&(a.exercise_id,c.suggested_reps))}})(b.set_id),children:"Override"}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.Button,{size:"sm",variant:"default",onClick:()=>l(b.set_id,{weight:b.suggested_weight_kg||void 0,reps:b.suggested_reps||void 0},"ai_recommended"),children:"Accept AI"}),(0,d.jsx)(g.Button,{size:"sm",variant:"secondary",onClick:()=>k(a=>({...a,[b.set_id]:!a[b.set_id]})),children:j[b.set_id]?"Hide":"Options"})]})})]}),(0,d.jsxs)("div",{className:"mb-2 grid grid-cols-2 gap-3",children:[b.suggested_weight_kg&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-muted text-xs",children:"Suggested Weight"}),(0,d.jsxs)("div",{className:"font-semibold",children:[b.suggested_weight_kg,"kg"]})]}),b.suggested_reps&&(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-muted text-xs",children:"Suggested Reps"}),(0,d.jsx)("div",{className:"font-semibold",children:b.suggested_reps})]})]}),b.suggested_rest_seconds&&(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("div",{className:"text-muted text-xs",children:"Suggested Rest"}),(0,d.jsxs)("div",{className:"font-semibold",children:[Math.round(b.suggested_rest_seconds/60)," ","minutes"]})]}),j[b.set_id]&&!m&&b.suggested_weight_kg&&b.suggested_reps&&(0,d.jsxs)("div",{className:"mt-3 rounded-lg p-3",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 70%, var(--color-bg-app) 30%)",borderColor:"var(--color-border)"},children:[(0,d.jsx)("div",{className:"text-muted mb-2 text-xs",children:"Alternative Progressions"}),(0,d.jsx)("div",{className:"space-y-2",children:((a,b)=>{let c=[];return c.push({weight_kg:Math.round((a+2.5)*10)/10,reps:Math.max(b-1,b),rationale:"Weight-focused: Prioritize strength gains through load increases",progression_type:"weight_focus"}),c.push({weight_kg:a,reps:b+1,rationale:"Reps-focused: Build endurance and volume tolerance",progression_type:"reps_focus"}),c.push({weight_kg:Math.round((a+1.25)*10)/10,reps:b,rationale:"Balanced: Steady progression in both strength and volume",progression_type:"balanced"}),c})(b.suggested_weight_kg,b.suggested_reps).map((a,c)=>(0,d.jsxs)("div",{className:"flex items-center justify-between rounded p-2",style:{backgroundColor:"var(--color-bg-surface)"},children:[(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsxs)("div",{className:"text-sm font-medium",children:[a.weight_kg,"kg \xd7 ",a.reps," reps"]}),(0,d.jsx)("div",{className:"text-muted text-xs",children:a.rationale})]}),(0,d.jsx)(g.Button,{size:"sm",variant:"secondary",onClick:()=>l(b.set_id,{weight:a.weight_kg,reps:a.reps},a.progression_type),className:"ml-2",children:"Use This"})]},c))})]}),(0,d.jsxs)("div",{className:"rounded p-2 text-sm",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 50%, var(--color-bg-app) 50%)",color:"var(--color-text-secondary)"},children:[(0,d.jsx)("div",{className:"text-muted mb-1 text-xs",children:"AI Rationale"}),b.rationale]})]},b.set_id)})]})]})}function K(...a){return a.filter(Boolean).join(" ")}function L({probability:a,title:b,subtitle:c}){let e=Math.round(100*a),f=a>=.8?{bg:"bg-green-500",text:"text-green-600",border:"border-green-200"}:a>=.6?{bg:"bg-blue-500",text:"text-blue-600",border:"border-blue-200"}:a>=.4?{bg:"bg-yellow-500",text:"text-yellow-600",border:"border-yellow-200"}:a>=.2?{bg:"bg-orange-500",text:"text-orange-600",border:"border-orange-200"}:{bg:"bg-red-500",text:"text-red-600",border:"border-red-200"},g=2*Math.PI*40;return(0,d.jsx)(C.Zp,{className:"p-4 text-center",children:(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold",children:b}),c&&(0,d.jsx)("p",{className:"text-sm text-gray-600",children:c}),(0,d.jsxs)("div",{className:"relative w-24 h-24 mx-auto",children:[(0,d.jsxs)("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 100 100",children:[(0,d.jsx)("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"none",className:"text-gray-200"}),(0,d.jsx)("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"none",strokeLinecap:"round",strokeDasharray:g,strokeDashoffset:g-a*g,className:K(f.bg.replace("bg-","text-"),"transition-all duration-1000 ease-out")})]}),(0,d.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,d.jsxs)("span",{className:K("text-2xl font-bold",f.text),children:[e,"%"]})})]}),(0,d.jsx)("div",{className:K("inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border",f.text,f.bg.replace("bg-","bg-").replace("-500","-50"),f.border),children:a>=.8?"\uD83D\uDD25 Excellent":a>=.6?"\uD83D\uDCAA Good":a>=.4?"⚖️ Moderate":a>=.2?"⚠️ Low":"\uD83D\uDEA8 Very Low"})]})})}function M({summary:a,warnings:b}){let[c,f]=(0,e.useState)(!0);return(0,d.jsxs)(C.Zp,{className:"p-4 space-y-4",children:[(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("button",{onClick:()=>f(!c),className:"w-full text-left",children:(0,d.jsxs)("h3",{className:"text-lg font-semibold flex items-center justify-between gap-2",children:[(0,d.jsx)("span",{className:"flex items-center gap-2",children:"\uD83E\uDD16 AI Coach Summary"}),(0,d.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:c?"▼":"▶"})]})}),c&&(0,d.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,d.jsx)("p",{className:"leading-relaxed text-current opacity-90",children:a})})]}),c&&b.length>0&&(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)("h4",{className:"text-sm font-medium text-amber-600 dark:text-amber-400 flex items-center gap-1",children:"⚠️ Important Notes"}),(0,d.jsx)("div",{className:"space-y-1",children:b.map((a,b)=>(0,d.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700/30 rounded-lg",children:[(0,d.jsx)("div",{className:"text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",children:"⚠️"}),(0,d.jsx)("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:a})]},b))})]}),c&&(0,d.jsx)("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:(0,d.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"\uD83D\uDCA1 This is not medical advice. These recommendations are based on your WHOOP data and workout history. Always listen to your body and consult healthcare professionals for medical concerns."})})]})}function N({isOpen:a,onClose:b,onSubmit:c,hasWhoopIntegration:f,isWhoopConnected:h,onConnectWhoop:i}){let[j,k]=(0,e.useState)(5),[l,m]=(0,e.useState)(5),[n,o]=(0,e.useState)(5),[p,q]=(0,e.useState)(5);return a?(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,d.jsx)(C.Zp,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",children:(0,d.jsxs)("div",{className:"p-6 space-y-6",children:[(0,d.jsxs)("div",{className:"text-center space-y-2",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Workout Intelligence"}),!f&&(0,d.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:"color-mix(in oklab, var(--color-warning) 10%, var(--color-bg-surface))",borderColor:"var(--color-warning)"},children:[(0,d.jsx)("p",{className:"text-sm text-secondary",children:"\uD83D\uDCA1 You don't have WHOOP connected, so we can't access your recovery metrics. Let us know how you're feeling today and we'll provide personalized workout recommendations."}),i&&(0,d.jsx)(g.Button,{variant:"secondary",size:"sm",onClick:i,className:"mt-2 w-full",children:"Connect WHOOP for Better Insights"})]}),f&&!h&&(0,d.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:"color-mix(in oklab, var(--color-danger) 10%, var(--color-bg-surface))",borderColor:"var(--color-danger)"},children:[(0,d.jsx)("p",{className:"text-sm text-secondary",children:"⚠️ Your WHOOP connection appears to be disconnected. Please reconnect to get the most accurate recommendations, or provide your current wellness status below."}),i&&(0,d.jsx)(g.Button,{variant:"secondary",size:"sm",onClick:i,className:"mt-2 w-full",children:"Reconnect WHOOP"})]})]}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Energy Level"}),(0,d.jsxs)("span",{className:"text-sm text-muted",children:[j<=2?"Very Low":j<=4?"Low":j<=6?"Moderate":j<=8?"Good":"Excellent"," (",j,"/10)"]})]}),(0,d.jsx)("input",{type:"range",min:"1",max:"10",value:j,onChange:a=>k(Number(a.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,d.jsx)("span",{children:"Very Low"}),(0,d.jsx)("span",{children:"Excellent"})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Sleep Quality"}),(0,d.jsxs)("span",{className:"text-sm text-muted",children:[l<=2?"Very Poor":l<=4?"Poor":l<=6?"Fair":l<=8?"Good":"Excellent"," (",l,"/10)"]})]}),(0,d.jsx)("input",{type:"range",min:"1",max:"10",value:l,onChange:a=>m(Number(a.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,d.jsx)("span",{children:"Very Poor"}),(0,d.jsx)("span",{children:"Excellent"})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Recovery Feeling"}),(0,d.jsxs)("span",{className:"text-sm text-muted",children:[n<=2?"Very Poor":n<=4?"Poor":n<=6?"Fair":n<=8?"Good":"Excellent"," (",n,"/10)"]})]}),(0,d.jsx)("input",{type:"range",min:"1",max:"10",value:n,onChange:a=>o(Number(a.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,d.jsx)("span",{children:"Very Poor"}),(0,d.jsx)("span",{children:"Excellent"})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Stress Level"}),(0,d.jsxs)("span",{className:"text-sm text-muted",children:[p<=2?"Very Low":p<=4?"Low":p<=6?"Moderate":p<=8?"High":"Very High"," (",p,"/10)"]})]}),(0,d.jsx)("input",{type:"range",min:"1",max:"10",value:p,onChange:a=>q(Number(a.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,d.jsx)("span",{children:"Very Low"}),(0,d.jsx)("span",{children:"Very High"})]})]})]}),(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)(g.Button,{variant:"secondary",onClick:b,className:"flex-1",children:"Cancel"}),(0,d.jsx)(g.Button,{onClick:()=>{c({energyLevel:j,sleepQuality:l,recoveryFeeling:n,stressLevel:p})},className:"flex-1 btn-primary",children:"Get Workout Intelligence"})]}),(0,d.jsx)("div",{className:"text-xs text-muted text-center pt-2 border-t",style:{borderColor:"var(--color-border)"},children:"\uD83D\uDCA1 This assessment helps us provide personalized workout recommendations. Not medical advice - always listen to your body."})]})})}):null}function O({isOpen:a,onClose:b,onSubmit:c,hasWhoopIntegration:f,isWhoopConnected:h,onConnectWhoop:i,isSubmitting:j=!1,submitError:k,sessionId:l}){let[m,n]=(0,e.useState)(5),[o,p]=(0,e.useState)(5),[q,r]=(0,e.useState)(""),[s,t]=(0,e.useState)(null),[u]=(0,e.useState)(Date.now()),[v]=(0,e.useState)({energy:5,sleep:5});return a?(0,d.jsx)("div",{className:"bg-opacity-50 fixed inset-0 z-50 flex items-center justify-center bg-black p-4",children:(0,d.jsx)(C.Zp,{className:"max-h-[90vh] w-full max-w-md overflow-y-auto",children:(0,d.jsxs)("div",{className:"space-y-6 p-6",children:[(0,d.jsxs)("div",{className:"space-y-2 text-center",children:[(0,d.jsx)("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Quick Wellness Check"}),(0,d.jsx)("p",{className:"text-muted text-sm",children:"Just 2 quick inputs for personalized workout recommendations"}),!f&&(0,d.jsxs)("div",{className:"rounded-lg p-3 text-left",style:{backgroundColor:"color-mix(in oklab, var(--color-warning) 10%, var(--color-bg-surface))",borderColor:"var(--color-warning)"},children:[(0,d.jsx)("p",{className:"text-secondary text-sm",children:"\uD83D\uDCA1 Quick 30-second wellness check to get personalized workout recommendations"}),i&&(0,d.jsx)(g.Button,{variant:"secondary",size:"sm",onClick:i,className:"mt-2 w-full",children:"Connect WHOOP for Better Insights"})]}),f&&!h&&(0,d.jsxs)("div",{className:"rounded-lg p-3 text-left",style:{backgroundColor:"color-mix(in oklab, var(--color-danger) 10%, var(--color-bg-surface))",borderColor:"var(--color-danger)"},children:[(0,d.jsx)("p",{className:"text-secondary text-sm",children:"⚠️ WHOOP disconnected. Quick wellness check will be used for recommendations."}),i&&(0,d.jsx)(g.Button,{variant:"secondary",size:"sm",onClick:i,className:"mt-2 w-full",children:"Reconnect WHOOP"})]}),f&&h&&(0,d.jsx)("div",{className:"rounded-lg p-3 text-left",style:{backgroundColor:"color-mix(in oklab, var(--color-success) 10%, var(--color-bg-surface))",borderColor:"var(--color-success)"},children:(0,d.jsx)("p",{className:"text-secondary text-sm",children:"✅ WHOOP connected! Your input will enhance the WHOOP data for even better recommendations."})})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Quick Presets"}),(0,d.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.values({greatDay:{energyLevel:8,sleepQuality:8,label:"\uD83C\uDF1F Great Day",description:"High energy, great sleep"},averageDay:{energyLevel:6,sleepQuality:6,label:"\uD83D\uDE10 Average Day",description:"Normal energy, decent sleep"},toughDay:{energyLevel:3,sleepQuality:4,label:"\uD83D\uDE34 Tough Day",description:"Low energy, poor sleep"}}).map(a=>(0,d.jsxs)("button",{onClick:()=>{n(a.energyLevel),p(a.sleepQuality),t(null),l?.toString(),a.label.toLowerCase().replace(/\s+/g,"_")},className:"hover:bg-opacity-80 rounded-lg border p-3 text-center text-xs transition-colors",style:{borderColor:"var(--color-border)",backgroundColor:"color-mix(in oklab, var(--color-primary) 5%, var(--color-bg-surface))"},children:[(0,d.jsx)("div",{className:"mb-1 text-lg",children:a.label.split(" ")[0]}),(0,d.jsx)("div",{className:"text-[10px] font-medium",children:a.label.split(" ").slice(1).join(" ")}),(0,d.jsx)("div",{className:"text-muted mt-1 text-[10px]",children:a.description})]},a.label))})]}),(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"How energetic do you feel?"}),(0,d.jsxs)("span",{className:"text-muted text-sm",children:[m<=2?"Very Low":m<=4?"Low":m<=6?"Moderate":m<=8?"Good":"Excellent"," (",m,"/10)"]})]}),(0,d.jsx)("input",{type:"range",min:"1",max:"10",value:m,onChange:a=>{n(Number(a.target.value)),t(null)},className:"slider-primary h-3 w-full cursor-pointer appearance-none rounded-lg",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsxs)("div",{className:"text-muted flex justify-between text-xs",children:[(0,d.jsx)("span",{children:"Drained"}),(0,d.jsx)("span",{children:"Peak Energy"})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"How well did you sleep?"}),(0,d.jsxs)("span",{className:"text-muted text-sm",children:[o<=2?"Very Poor":o<=4?"Poor":o<=6?"Fair":o<=8?"Good":"Excellent"," (",o,"/10)"]})]}),(0,d.jsx)("input",{type:"range",min:"1",max:"10",value:o,onChange:a=>{p(Number(a.target.value)),t(null)},className:"slider-primary h-3 w-full cursor-pointer appearance-none rounded-lg",style:{backgroundColor:"var(--color-border)"}}),(0,d.jsxs)("div",{className:"text-muted flex justify-between text-xs",children:[(0,d.jsx)("span",{children:"Terrible"}),(0,d.jsx)("span",{children:"Perfect"})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Additional Notes (Optional)"}),(0,d.jsx)("textarea",{value:q,onChange:a=>{a.target.value.length<=500&&(r(a.target.value),t(null))},placeholder:"Any other factors affecting your wellness today? (e.g., stress, illness, excitement)",className:"w-full resize-none rounded-lg border p-3 text-sm",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-surface)",color:"var(--color-text)"},rows:3,maxLength:500}),(0,d.jsxs)("div",{className:"text-muted text-right text-xs",children:[q.length,"/500 characters"]})]})]}),(s||k)&&(0,d.jsx)("div",{className:"rounded-lg p-3",style:{backgroundColor:"color-mix(in oklab, var(--color-danger) 10%, var(--color-bg-surface))",borderColor:"var(--color-danger)"},children:(0,d.jsx)("p",{className:"text-danger text-sm",children:s||k})}),(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)(g.Button,{variant:"secondary",onClick:b,className:"flex-1",disabled:j,children:"Cancel"}),(0,d.jsx)(g.Button,{onClick:()=>{t(null);let a={energyLevel:m,sleepQuality:o,deviceTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone,notes:q.trim()||void 0};if(!function(a){let{energyLevel:b,sleepQuality:c,deviceTimezone:d,notes:e}=a;return"number"==typeof b&&"number"==typeof c&&"string"==typeof d&&!(b<1)&&!(b>10)&&!(c<1)&&!(c>10)&&(void 0===e||"string"==typeof e&&!(e.length>500))&&!0}(a))return void t("Please ensure all values are between 1-10 and notes are under 500 characters");l?.toString(),Date.now(),c(a)},className:"btn-primary flex-1",disabled:j,children:j?"Getting Recommendations...":"Get Workout Intelligence"})]}),(0,d.jsx)("div",{className:"text-muted border-t pt-2 text-center text-xs",style:{borderColor:"var(--color-border)"},children:(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("div",{children:"\uD83D\uDCA1 Quick wellness check for personalized recommendations"}),(0,d.jsx)("div",{children:"Not medical advice - always listen to your body"}),l&&(0,d.jsxs)("div",{className:"text-[10px] opacity-75",children:["Session #",l]})]})})]})})}):null}var P=c(90088);function Q({sessionId:a,whoopData:b,userProfile:c,workoutPlan:h,priorBests:i}){let[j,k]=(0,e.useState)(!1),[l,n]=(0,e.useState)(!1),[o,p]=(0,e.useState)(!1),[,q]=(0,e.useState)(new Map),[r,s]=(0,e.useState)(null),[t,u]=(0,e.useState)(!1),{advice:v,loading:w,error:x,fetchAdvice:y,fetchAdviceWithSubjectiveData:z,fetchAdviceWithManualWellness:C,hasExistingAdvice:D,whoopStatus:I}=function(a){let[b,c]=(0,e.useState)(!1),[d,f]=(0,e.useState)(null),[g,h]=(0,e.useState)(null),[i,j]=(0,e.useState)(0),k=A.F.healthAdvice.save.useMutation(),l=A.F.healthAdvice.saveWithWellness.useMutation(),n=A.F.healthAdvice.updateAcceptedSuggestions.useMutation(),{data:o}=A.F.healthAdvice.getBySessionId.useQuery({sessionId:a},{enabled:!!a}),{data:p}=A.F.whoop.getIntegrationStatus.useQuery(),q=(0,e.useCallback)(async b=>{c(!0),f(null);let d=performance.now();try{let c=await fetch("/api/health-advice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),e=performance.now()-d;if(!c.ok){let a=await c.json();throw G({sessionId:b.session_id,errorType:400===c.status?"validation_error":"api_error",errorMessage:a.error||"Failed to fetch advice",modelUsed:"unknown",hasWhoopData:!!b.whoop&&Object.keys(b.whoop||{}).length>0,experienceLevel:b.user_profile.experience_level}),Error(a.error||"Failed to fetch advice")}let f=await c.json();if(h(f),a)try{await k.mutateAsync({sessionId:a,request:b,response:f,responseTimeMs:e,modelUsed:"health-model"})}catch(b){P.vF.error("Failed to save health advice to database",b,{sessionId:a})}let g=f.per_exercise.reduce((a,b)=>a+b.sets.length,0);F({sessionId:b.session_id,readiness:f.readiness.rho,overloadMultiplier:f.readiness.overload_multiplier,userAcceptedSuggestions:i,totalSuggestions:g,modelUsed:"health-model",responseTime:e,hasWhoopData:Object.keys(b.whoop||{}).length>0,experienceLevel:b.user_profile.experience_level,flags:f.readiness.flags,warnings:f.warnings}),H({sessionId:b.session_id,totalDuration:e,modelUsed:"health-model",inputSize:JSON.stringify(b).length,outputSize:JSON.stringify(f).length})}catch(c){let a=c.message.includes("fetch")?"network_error":"api_error";G({sessionId:b.session_id,errorType:a,errorMessage:c.message,hasWhoopData:Object.keys(b.whoop||{}).length>0,experienceLevel:b.user_profile.experience_level}),f(c.message)}finally{c(!1)}},[a,k,i]),r=(0,e.useCallback)(async(a,b)=>{let c=function(a){let b=function(a){let{energyLevel:b,sleepQuality:c,recoveryFeeling:d,stressLevel:e}=a,f=(c-1)/9*100;return{recovery_score:Math.max(0,Math.min(100,Math.round((b-1)/9*40+(d-1)/9*30+(10-e)/9*20+.1*f))),sleep_performance:Math.max(0,Math.min(100,f)),hrv_now_ms:void 0,hrv_baseline_ms:void 0,rhr_now_bpm:void 0,rhr_baseline_bpm:void 0,yesterday_strain:Math.max(5,Math.min(20,Math.round(20-(d-1)/9*15)))}}(a);return{recovery_score:b.recovery_score,sleep_performance:b.sleep_performance,hrv_now_ms:void 0,hrv_baseline_ms:void 0,rhr_now_bpm:void 0,rhr_baseline_bpm:void 0,yesterday_strain:b.yesterday_strain}}(b);return q({...a,whoop:c})},[q]),s=(0,e.useCallback)(async(b,d,e)=>{c(!0),f(null);let g=performance.now();try{let c=function(a){let{energyLevel:b,sleepQuality:c}=a,d=(c-1)/9*100;return{recovery_score:Math.max(0,Math.min(100,Math.round((b-1)/9*70+.3*d))),sleep_performance:Math.max(0,Math.min(100,d)),hrv_now_ms:void 0,hrv_baseline_ms:void 0,rhr_now_bpm:void 0,rhr_baseline_bpm:void 0,yesterday_strain:Math.max(5,Math.min(20,Math.round(20-(b-1)/9*15)))}}(d),f={...b,whoop:c,manual_wellness:{energy_level:d.energyLevel,sleep_quality:d.sleepQuality,has_whoop_data:!1,device_timezone:d.deviceTimezone,notes:d.notes}},j=await fetch("/api/health-advice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}),k=performance.now()-g;if(!j.ok){let a=await j.json();throw G({sessionId:b.session_id,errorType:400===j.status?"validation_error":"api_error",errorMessage:a.error||"Failed to fetch advice",modelUsed:"unknown",hasWhoopData:!1,experienceLevel:b.user_profile.experience_level}),Error(a.error||"Failed to fetch advice")}let n=await j.json();if(h(n),a)try{await l.mutateAsync({sessionId:a,request:f,response:n,responseTimeMs:k,modelUsed:"health-model",wellnessDataId:e})}catch(b){P.vF.error("Failed to save health advice to database",b,{sessionId:a})}let o=n.per_exercise.reduce((a,b)=>a+b.sets.length,0);!function({sessionId:a,energyLevel:b,sleepQuality:c,hasNotes:d,notesLength:e,deviceTimezone:f,submissionTime:g}){m.z.featureUsed("manual_wellness_submission",{sessionId:a,energyLevel:b,sleepQuality:c,hasNotes:d,deviceTimezone:f,submissionTime:g})}({sessionId:b.session_id,energyLevel:d.energyLevel,sleepQuality:d.sleepQuality,hasNotes:!!(d.notes&&d.notes.trim().length>0),notesLength:d.notes?.length||0,deviceTimezone:d.deviceTimezone,submissionTime:k}),F({sessionId:b.session_id,readiness:n.readiness.rho,overloadMultiplier:n.readiness.overload_multiplier,userAcceptedSuggestions:i,totalSuggestions:o,modelUsed:"health-model",responseTime:k,hasWhoopData:!1,experienceLevel:b.user_profile.experience_level,flags:n.readiness.flags,warnings:n.warnings,hasManualWellness:!0,manualWellnessData:{energyLevel:d.energyLevel,sleepQuality:d.sleepQuality,hasNotes:!!(d.notes&&d.notes.trim().length>0)}}),H({sessionId:b.session_id,totalDuration:k,modelUsed:"health-model",inputSize:JSON.stringify(f).length,outputSize:JSON.stringify(n).length})}catch(c){let a=c.message.includes("fetch")?"network_error":"api_error";G({sessionId:b.session_id,errorType:a,errorMessage:c.message,hasWhoopData:!1,experienceLevel:b.user_profile.experience_level}),f(c.message)}finally{c(!1)}},[a,l,i]),t=(0,e.useCallback)(()=>{h(null),f(null),j(0)},[]),u=(0,e.useCallback)(async()=>{let b=i+1;if(j(b),a)try{await n.mutateAsync({sessionId:a,acceptedCount:b})}catch(a){console.error("Failed to update accepted suggestions count:",a),j(i)}},[a,i,n]),v=(0,e.useCallback)(async()=>{if(i>0){let b=i-1;if(j(b),a)try{await n.mutateAsync({sessionId:a,acceptedCount:b})}catch(b){P.vF.error("Failed to update accepted suggestions count",b,{sessionId:a}),j(i)}}},[a,i,n]);return{advice:g,loading:b,error:d,acceptedSuggestions:i,fetchAdvice:q,fetchAdviceWithSubjectiveData:r,fetchAdviceWithManualWellness:s,clearAdvice:t,acceptSuggestion:u,rejectSuggestion:v,hasExistingAdvice:!!o,whoopStatus:{isConnected:p?.isConnected??!1,hasIntegration:!!p,connectedAt:p?.connectedAt??null}}}(a),{data:K,refetch:Q}=A.F.workouts.getById.useQuery({id:a},{enabled:!!a}),{data:R}=A.F.preferences.get.useQuery(),S=A.F.wellness.save.useMutation(),T=c||{experience_level:"intermediate",min_increment_kg:2.5,preferred_rpe:8},U=f().useMemo(()=>K?.template&&"object"==typeof K.template&&!Array.isArray(K.template)&&Array.isArray(K.template.exercises)?K.template.exercises:void 0,[K]),V=f().useMemo(()=>U?{exercises:U.map(a=>{let b=Array.isArray(K?.exercises)?K.exercises.filter(b=>b.exerciseName===a.exerciseName):[],c=Array.from({length:b.length>0?b.length:3},(c,d)=>{let e=b[d];return{set_id:`${a.id}_${d+1}`,target_reps:e?.reps||null,target_weight_kg:e?.weight?parseFloat(e.weight):null,target_rpe:e?.rpe||null}});return{exercise_id:a.id.toString(),name:a.exerciseName,tags:["strength"],sets:c}})}:h||{exercises:[]},[U,K,h]),W=i||{by_exercise_id:{}},X=async()=>{let c=R?.enable_manual_wellness??!1;if(I.isConnected){let c={session_id:a.toString(),user_profile:T,whoop:b,workout_plan:V,prior_bests:W};await y(c),k(!0)}else c?p(!0):n(!0)},Y=async b=>{n(!1);let c={session_id:a.toString(),user_profile:T,workout_plan:V,prior_bests:W};await z(c,b),k(!0)},Z=async b=>{u(!0),s(null);try{let c=await S.mutateAsync({sessionId:a,energyLevel:b.energyLevel,sleepQuality:b.sleepQuality,deviceTimezone:b.deviceTimezone,notes:b.notes,hasWhoopData:!1}),d={session_id:a.toString(),user_profile:T,workout_plan:V,prior_bests:W};c?.id?await C(d,b,c.id):(console.warn("Wellness data save returned no ID, proceeding without wellness tracking"),await C(d,b)),p(!1),k(!0)}catch(a){console.error("Failed to submit manual wellness:",a),s(a instanceof Error?a.message:"Failed to submit wellness data. Please try again.")}finally{u(!1)}},$=()=>{window.open("/connect-whoop","_blank")},_=A.F.workouts.updateSessionSets.useMutation({onSuccess:async()=>{console.log("Successfully updated session sets"),await Q()},onError:a=>{console.error("Failed to update session sets:",a)}}),aa=A.F.suggestions.trackInteraction.useMutation(),ab=async(b,c)=>{q(a=>new Map(a).set(b,c));let d=/^(\d+)_(\d+)$/.exec(b);if(!d)return void console.error("Invalid setId format:",b,"Expected format: templateExerciseId_setIndex");let e=parseInt(d[1]),f=parseInt(d[2])-1;if(!e)return void console.error("No template exercise ID captured from setId:",b);if(!U)return void console.error("Template exercises are unavailable when processing set:",b);let g=U.find(a=>a.id===e);if(!g)return void console.error("Could not find template exercise for ID:",e);let h=g.exerciseName;try{if(await _.mutateAsync({sessionId:a,updates:[{setId:b,exerciseName:h,setIndex:f,weight:c.weight,reps:c.reps,unit:"kg"}]}),v){let d=v.per_exercise.find(a=>a.exercise_id===e.toString()||a.name===h),g=d?.sets.find(a=>a.set_id===b);if(g)try{await aa.mutateAsync({sessionId:a,exerciseName:h,setId:b,setIndex:f,suggestedWeightKg:g.suggested_weight_kg,suggestedReps:g.suggested_reps,suggestedRestSeconds:g.suggested_rest_seconds,suggestionRationale:g.rationale,action:"accepted",acceptedWeightKg:c.weight,acceptedReps:c.reps,progressionType:R?.progression_type??"adaptive",readinessScore:v.readiness.rho,plateauDetected:g.rationale.includes("Plateau Alert")||g.rationale.includes("plateau detected")})}catch(a){console.warn("Failed to track suggestion interaction:",a)}}P.vF.info("suggestion_applied",{setId:b,suggestion:c,exerciseName:h,setIndex:f,sessionId:a})}catch(c){P.vF.error("Failed to apply suggestion",c,{setId:b,sessionId:a}),q(a=>{let c=new Map(a);return c.delete(b),c})}},ac=a=>{q(b=>{let c=new Map(b);return c.delete(a),c}),console.log("Overridden suggestion for set",a)};return(0,d.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,d.jsx)("div",{className:"flex justify-center",children:(0,d.jsx)(g.Button,{onClick:X,disabled:w||t,variant:"default",size:"lg",children:w||t?"Getting AI Advice...":D?"\uD83D\uDD04 Refresh Workout Intelligence":R?.enable_manual_wellness&&!I.isConnected?"\uD83C\uDFAF Quick Wellness Check":"\uD83E\uDD16 Get Workout Intelligence"})}),j&&v&&(0,d.jsxs)("div",{className:"glass-surface space-y-3 p-3 sm:space-y-4 sm:p-4",style:{backgroundColor:"var(--color-bg-surface)",color:"var(--color-text)",borderColor:"var(--color-border)"},children:[(0,d.jsx)("h2",{className:"text-center text-lg font-bold sm:text-xl md:text-2xl",style:{color:"var(--color-text)"},children:"\uD83C\uDFCB️ Today's Workout Intelligence"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:gap-4 lg:grid-cols-2",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)(E,{rho:v.readiness.rho,flags:v.readiness.flags,overloadMultiplier:v.readiness.overload_multiplier}),(0,d.jsx)(L,{probability:v.session_predicted_chance,title:"Session Success Chance",subtitle:"Probability to beat your previous bests"})]}),(0,d.jsx)(M,{summary:v.summary,warnings:v.warnings})]}),(0,d.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,d.jsx)("h3",{className:"text-lg font-semibold sm:text-xl",style:{color:"var(--color-text)"},children:"Exercise Recommendations"}),v.per_exercise.map(b=>(0,d.jsx)(J,{exercise:b,onAcceptSuggestion:ab,onOverrideSuggestion:ac,sessionId:a.toString()},b.exercise_id))]})]}),x&&(0,d.jsxs)("div",{className:"glass-surface rounded-lg p-4",style:{borderColor:"var(--color-danger)",color:"var(--color-danger)"},children:[(0,d.jsx)("h3",{className:"font-semibold",children:"Health Advice Error"}),(0,d.jsx)("p",{children:x})]}),(0,d.jsx)(N,{isOpen:l,onClose:()=>n(!1),onSubmit:Y,hasWhoopIntegration:I.hasIntegration,isWhoopConnected:I.isConnected,onConnectWhoop:$}),(0,d.jsx)(O,{isOpen:o,onClose:()=>{p(!1),s(null)},onSubmit:Z,hasWhoopIntegration:I.hasIntegration,isWhoopConnected:I.isConnected,onConnectWhoop:$,isSubmitting:t,submitError:r??void 0,sessionId:a}),(0,d.jsx)(B,{sessionId:a})]})}},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32382:(a,b,c)=>{"use strict";c.d(b,{GlassHeader:()=>e});var d=c(21124);function e({title:a,subtitle:b,actions:c,className:e=""}){return(0,d.jsx)("header",{className:`bg-card/95 border-border/50 sticky top-0 z-40 border-b backdrop-blur-sm ${e}`,children:(0,d.jsxs)("div",{className:"mx-auto max-w-7xl px-6 py-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)("span",{className:"text-2xl",children:"\uD83D\uDD25"}),(0,d.jsx)("h1",{className:"bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-2xl font-bold text-transparent",role:"heading","aria-level":1,children:"Swole Tracker"})]}),c&&(0,d.jsx)("div",{className:"flex flex-shrink-0 items-center gap-2",children:c})]}),b&&(0,d.jsx)("p",{className:"text-muted-foreground mt-1 ml-11 text-sm",role:"doc-subtitle",children:b})]})})}c(38301)},33873:a=>{"use strict";a.exports=require("path")},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},52446:(a,b,c)=>{"use strict";c.d(b,{Button:()=>e});var d=c(97954);let e=(0,d.registerClientReference)(function(){throw Error("Attempted to call Button() from the server but Button is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/steven/swole-tracker/src/components/ui/button.tsx","Button");(0,d.registerClientReference)(function(){throw Error("Attempted to call buttonVariants() from the server but buttonVariants is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/steven/swole-tracker/src/components/ui/button.tsx","buttonVariants")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76174:(a,b,c)=>{Promise.resolve().then(c.bind(c,69371)),Promise.resolve().then(c.bind(c,68496)),Promise.resolve().then(c.bind(c,96610)),Promise.resolve().then(c.bind(c,90295)),Promise.resolve().then(c.bind(c,86111)),Promise.resolve().then(c.bind(c,49787)),Promise.resolve().then(c.bind(c,72124)),Promise.resolve().then(c.bind(c,99043)),Promise.resolve().then(c.bind(c,98206)),Promise.resolve().then(c.bind(c,93415)),Promise.resolve().then(c.bind(c,64371)),Promise.resolve().then(c.bind(c,61855)),Promise.resolve().then(c.bind(c,41555)),Promise.resolve().then(c.t.bind(c,3991,23)),Promise.resolve().then(c.bind(c,17819)),Promise.resolve().then(c.bind(c,35284)),Promise.resolve().then(c.bind(c,32382))},85156:(a,b,c)=>{"use strict";c.d(b,{GlassHeader:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call GlassHeader() from the server but GlassHeader is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/steven/swole-tracker/src/components/ui/glass-header.tsx","GlassHeader")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},90086:(a,b,c)=>{Promise.resolve().then(c.bind(c,99258)),Promise.resolve().then(c.bind(c,26322)),Promise.resolve().then(c.bind(c,50468)),Promise.resolve().then(c.bind(c,29033)),Promise.resolve().then(c.bind(c,13085)),Promise.resolve().then(c.bind(c,67209)),Promise.resolve().then(c.bind(c,97510)),Promise.resolve().then(c.bind(c,95261)),Promise.resolve().then(c.bind(c,73617)),Promise.resolve().then(c.bind(c,40929)),Promise.resolve().then(c.bind(c,14321)),Promise.resolve().then(c.bind(c,87589)),Promise.resolve().then(c.bind(c,18893)),Promise.resolve().then(c.t.bind(c,65169,23)),Promise.resolve().then(c.bind(c,3241)),Promise.resolve().then(c.bind(c,52446)),Promise.resolve().then(c.bind(c,85156))},91850:(a,b,c)=>{"use strict";c.d(b,{z:()=>f});var d=c(77196);let e=(a,b)=>{try{if("undefined"==typeof navigator||!0!==navigator.onLine)return;d.Ay.capture(a,b??{})}catch{}},f={pageView:(a,b)=>{try{e("$pageview",{$current_url:void 0,page:a,...b})}catch{}},workoutStarted:(a,b)=>{e("workout_started",{templateId:a,templateName:b,timestamp:new Date().toISOString()})},workoutCompleted:(a,b,c)=>{e("workout_completed",{sessionId:a,duration:b,exerciseCount:c,timestamp:new Date().toISOString()})},exerciseLogged:(a,b,c,d)=>{e("exercise_logged",{exerciseId:a,exerciseName:b,sets:c,weight:d,timestamp:new Date().toISOString()})},templateCreated:(a,b)=>{e("template_created",{templateId:a,exerciseCount:b,timestamp:new Date().toISOString()})},templateDeleted:a=>{e("template_deleted",{templateId:a,timestamp:new Date().toISOString()})},templateEdited:(a,b)=>{e("template_edited",{templateId:a,exerciseCount:b,timestamp:new Date().toISOString()})},templateDuplicated:a=>{e("template_duplicated",{templateId:a,timestamp:new Date().toISOString()})},weightUnitChanged:a=>{e("weight_unit_changed",{unit:a,timestamp:new Date().toISOString()})},error:(a,b)=>{e("error",{error:a.message,stack:a.stack,context:b,timestamp:new Date().toISOString()})},featureUsed:(a,b)=>{e("feature_used",{feature:a,...b,timestamp:new Date().toISOString()})},aiDebriefViewed:(a,b,c)=>{e("ai_debrief.viewed",{sessionId:a,version:b,streakLength:c,timestamp:new Date().toISOString()})},aiDebriefRegenerated:(a,b,c)=>{e("ai_debrief.regenerated",{sessionId:a,version:b,reason:c,timestamp:new Date().toISOString()})},aiDebriefDismissed:(a,b,c)=>{e("ai_debrief.dismissed",{sessionId:a,version:b,pinned:c,timestamp:new Date().toISOString()})}}}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[5873,1428,3708,7639,1492,7372,9666,9245,1553,6263,2893,2979],()=>b(b.s=8642));module.exports=c})();