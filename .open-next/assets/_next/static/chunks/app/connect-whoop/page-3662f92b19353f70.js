(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3825],{29761:(e,s,t)=>{"use strict";t.d(s,{WhoopWorkouts:()=>b});var a=t(95155),r=t(12115),c=t(20063),n=t(80842),l=t(88661),i=t.n(l);function o(e){var s;let{workout:t,isOpen:c,onClose:n,clickOrigin:l}=e,o=(0,r.useRef)(null),d=(0,r.useRef)(null),m=(0,r.useRef)(null);(0,r.useEffect)(()=>(c?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[c]);let x=(e,s)=>s&&"object"==typeof s?(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h4",{className:"text-secondary mb-3 text-sm font-semibold",children:e}),(0,a.jsx)("div",{className:"space-y-2",children:Object.entries(s).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-muted capitalize",children:[s.replace(/_/g," "),":"]}),(0,a.jsx)("span",{className:"text-foreground",children:"number"==typeof t?t.toFixed(2):String(t)})]},s)})})]}):null;if(!c)return null;let h=l?{transformOrigin:"".concat(l.x,"px ").concat(l.y,"px")}:{};return(0,a.jsxs)("div",{ref:o,onClick:e=>{e.target===o.current&&n()},style:{animation:c?"fadeIn 0.3s ease-out":""},className:"jsx-fc5f05be72324b00 fixed inset-0 z-50 flex items-center justify-center bg-background/40 p-4 backdrop-blur-sm",children:[(0,a.jsxs)("div",{ref:d,onDoubleClick:()=>{n()},onTouchStart:e=>{let s=e.touches[0];s&&(m.current={x:s.clientX,y:s.clientY})},onTouchEnd:e=>{if(!m.current)return;let s=e.changedTouches[0];if(!s)return;let t=Math.abs(s.clientX-m.current.x),a=Math.abs(s.clientY-m.current.y);(t>50||a>50)&&n(),m.current=null},style:{animation:c?"scaleIn 0.3s ease-out":"",...h},className:"jsx-fc5f05be72324b00 card max-h-[90vh] w-full max-w-2xl overflow-y-auto rounded-xl shadow-2xl",children:[(0,a.jsx)("div",{className:"jsx-fc5f05be72324b00 sticky top-0 rounded-t-xl border-b border-border bg-background p-6",children:(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00",children:[(0,a.jsx)("h2",{className:"jsx-fc5f05be72324b00 mb-1 text-2xl font-bold text-foreground",children:null!=(s=t.sport_name)?s:"Unknown Sport"}),(0,a.jsx)("p",{className:"jsx-fc5f05be72324b00 text-secondary text-sm",children:((e,s)=>{let t=new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit",hour12:!0}).format(e),a=new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"2-digit",hour12:!0}).format(s);return"".concat(t," - ").concat(a)})(new Date(t.start),new Date(t.end))})]}),(0,a.jsx)("button",{onClick:n,className:"jsx-fc5f05be72324b00 p-2 text-secondary transition-colors hover:text-foreground",children:"✕"})]})}),(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 space-y-6 p-6",children:[(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 grid grid-cols-1 gap-4 sm:grid-cols-3",children:[(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 card p-4",children:[(0,a.jsx)("h4",{className:"jsx-fc5f05be72324b00 text-secondary mb-2 text-sm font-semibold",children:"Duration"}),(0,a.jsx)("p",{className:"jsx-fc5f05be72324b00 text-xl font-bold text-foreground",children:((e,s)=>{let t=Math.round((s.getTime()-e.getTime())/6e4),a=Math.floor(t/60),r=t%60;return a>0?"".concat(a,"h ").concat(r,"m"):"".concat(r,"m")})(new Date(t.start),new Date(t.end))})]}),(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 card p-4",children:[(0,a.jsx)("h4",{className:"jsx-fc5f05be72324b00 text-secondary mb-2 text-sm font-semibold",children:"Score"}),(0,a.jsx)("p",{className:"jsx-fc5f05be72324b00 text-xl font-bold text-foreground",children:((e,s)=>{var t,a,r;if(!e||"object"!=typeof e)return"-- (".concat(null!=(t=null==s?void 0:s.replace("_"," "))?t:"UNKNOWN",")");let c=e.strain;return c&&"number"==typeof c?"".concat(c.toFixed(1)," (").concat(null!=(a=null==s?void 0:s.replace("_"," "))?a:"UNKNOWN",")"):"-- (".concat(null!=(r=null==s?void 0:s.replace("_"," "))?r:"UNKNOWN",")")})(t.score,t.score_state)})]}),(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 card p-4",children:[(0,a.jsx)("h4",{className:"jsx-fc5f05be72324b00 text-secondary mb-2 text-sm font-semibold",children:"Whoop ID"}),(0,a.jsx)("p",{className:"jsx-fc5f05be72324b00 text-muted font-mono text-sm break-all",children:t.whoopWorkoutId})]})]}),x("Score Details",t.score),x("During Workout",t.during),x("Zone Duration",t.zone_duration),(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 card p-4",children:[(0,a.jsx)("h4",{className:"jsx-fc5f05be72324b00 text-secondary mb-3 text-sm font-semibold",children:"Timestamps"}),(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 flex justify-between",children:[(0,a.jsx)("span",{className:"jsx-fc5f05be72324b00 text-muted",children:"Started:"}),(0,a.jsx)("span",{className:"jsx-fc5f05be72324b00 text-foreground",children:new Date(t.start).toLocaleString()})]}),(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 flex justify-between",children:[(0,a.jsx)("span",{className:"jsx-fc5f05be72324b00 text-muted",children:"Ended:"}),(0,a.jsx)("span",{className:"jsx-fc5f05be72324b00 text-foreground",children:new Date(t.end).toLocaleString()})]}),(0,a.jsxs)("div",{className:"jsx-fc5f05be72324b00 flex justify-between",children:[(0,a.jsx)("span",{className:"jsx-fc5f05be72324b00 text-muted",children:"Synced:"}),(0,a.jsx)("span",{className:"jsx-fc5f05be72324b00 text-foreground",children:new Date(t.createdAt).toLocaleString()})]})]})]})]}),(0,a.jsx)("div",{className:"jsx-fc5f05be72324b00 rounded-b-xl border-t border-border bg-background p-4",children:(0,a.jsx)("p",{className:"jsx-fc5f05be72324b00 text-muted text-center text-xs",children:"Double-click, swipe any direction, or click outside to close"})})]}),(0,a.jsx)(i(),{id:"fc5f05be72324b00",children:"@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes scaleIn{from{opacity:0;transform:scale(.7)}to{opacity:1;transform:scale(1)}}"})]})}function d(e,s){let[t,a]=(0,r.useState)(s),[c,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{try{{let t=window.localStorage.getItem(e);if(null!==t)try{let s=JSON.parse(t);a(s),console.log("[localStorage] Loaded ".concat(e,":"),s)}catch(r){console.warn("[localStorage] Invalid JSON for ".concat(e,", clearing and using default:"),t),window.localStorage.removeItem(e),a(s)}}}catch(s){console.error("[localStorage] Error accessing localStorage for ".concat(e,":"),s)}finally{n(!0)}},[e,s]),[t,s=>{try{let r="function"==typeof s?s(t):s;a(r),window.localStorage.setItem(e,JSON.stringify(r)),console.log("[localStorage] Saved ".concat(e,":"),r)}catch(s){console.error("[localStorage] Error saving ".concat(e,":"),s)}},c]}var m=t(86948),x=t(20243),h=t(11647);function u(){let{data:e,isLoading:s}=n.F.whoop.getRecovery.useQuery(),t=e=>e?"".concat(e.toFixed(1),"ms"):"--";if(s)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Recovery Data"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Latest recovery scores from WHOOP"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:3}).map((e,s)=>(0,a.jsx)(m.Zp,{className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(x.EA,{className:"h-4 w-1/3"}),(0,a.jsx)(x.EA,{className:"h-8 w-2/3"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x.EA,{className:"h-3 w-full"}),(0,a.jsx)(x.EA,{className:"h-3 w-full"}),(0,a.jsx)(x.EA,{className:"h-3 w-full"})]})]})},s))})]});if(!e||0===e.length)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Recovery Data"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Latest recovery scores from WHOOP"})]}),(0,a.jsx)(m.Zp,{className:"py-8",children:(0,a.jsx)(m.Wu,{className:"text-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"No recovery data available. Try syncing your WHOOP data."})})})]});let r=e.slice(0,3);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Recovery Data"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Latest recovery scores from WHOOP"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:r.map(e=>{let s;return(0,a.jsx)(m.Zp,{className:"p-6",children:(0,a.jsx)(m.Wu,{className:"p-0",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-muted-foreground text-sm",children:(s=e.date.toISOString(),new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(new Date(s)))}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Recovery Score"}),(0,a.jsx)(h.E,{variant:e.recovery_score?e.recovery_score>=67?"default":e.recovery_score>=34?"secondary":"destructive":"outline",className:"text-base font-bold",children:e.recovery_score?"".concat(e.recovery_score,"%"):"--"})]}),(0,a.jsxs)("div",{className:"text-muted-foreground space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"HRV:"}),(0,a.jsx)("span",{children:t(e.hrv_rmssd_milli)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"HRV Baseline:"}),(0,a.jsx)("span",{children:t(e.hrv_rmssd_baseline)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"RHR:"}),(0,a.jsx)("span",{children:e.resting_heart_rate?"".concat(e.resting_heart_rate," bpm"):"--"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"RHR Baseline:"}),(0,a.jsx)("span",{children:e.resting_heart_rate_baseline?"".concat(e.resting_heart_rate_baseline," bpm"):"--"})]})]})]})]})})},e.id)})}),e.length>3&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("p",{className:"text-muted-foreground text-sm",children:["Showing 3 of ",e.length," recovery records"]})})]})}function f(){let{data:e,isLoading:s}=n.F.whoop.getSleep.useQuery(),t=e=>{if(!e)return"--";let s=Math.floor(e/36e5),t=Math.floor(e%36e5/6e4);return"".concat(s,"h ").concat(t,"m")};if(s)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Sleep Data"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Sleep performance and recovery metrics"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:3}).map((e,s)=>(0,a.jsx)(m.Zp,{className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(x.EA,{className:"h-4 w-1/3"}),(0,a.jsx)(x.EA,{className:"h-8 w-2/3"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(x.EA,{className:"h-3 w-full"}),(0,a.jsx)(x.EA,{className:"h-3 w-full"}),(0,a.jsx)(x.EA,{className:"h-3 w-full"})]})]})},s))})]});if(!e||0===e.length)return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Sleep Data"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Sleep performance and recovery metrics"})]}),(0,a.jsx)(m.Zp,{className:"py-8",children:(0,a.jsx)(m.Wu,{className:"text-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"No sleep data available. Try syncing your WHOOP data."})})})]});let r=e.slice(0,3);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Sleep Data"}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Sleep performance and recovery metrics"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:r.map(e=>{var s;return(0,a.jsx)(m.Zp,{className:"p-6",children:(0,a.jsx)(m.Wu,{className:"p-0",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-muted-foreground text-sm",children:((e,s)=>{let t=new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit",hour12:!0}).format(new Date(e)),a=new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"2-digit",hour12:!0}).format(new Date(s));return"".concat(t," - ").concat(a)})(e.start,e.end)}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Sleep Performance"}),(0,a.jsx)("span",{className:"text-lg font-bold",children:e.sleep_performance_percentage?"".concat(e.sleep_performance_percentage,"%"):"--"})]}),(0,a.jsxs)("div",{className:"text-muted-foreground space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Duration:"}),(0,a.jsx)("span",{children:t(e.total_sleep_time_milli)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Efficiency:"}),(0,a.jsx)("span",{children:(s=e.sleep_efficiency_percentage)?"".concat(s.toFixed(0),"%"):"--"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"REM Sleep:"}),(0,a.jsx)("span",{children:t(e.rem_sleep_time_milli)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Deep Sleep:"}),(0,a.jsx)("span",{children:t(e.slow_wave_sleep_time_milli)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Disturbances:"}),(0,a.jsx)("span",{children:e.disturbance_count||"--"})]})]})]})]})})},e.id)})}),e.length>3&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("p",{className:"text-muted-foreground text-sm",children:["Showing 3 of ",e.length," sleep records"]})})]})}function j(){let{data:e,isLoading:s}=n.F.whoop.getCycles.useQuery();if(s)return(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)("p",{className:"text-secondary",children:"Loading cycles data..."})});if(!e||0===e.length)return(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)("p",{className:"text-secondary",children:"No cycles data available. Try syncing your WHOOP data."})});let t=e.slice(0,3);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Daily Strain Cycles"}),(0,a.jsx)("p",{className:"text-secondary text-sm",children:"Daily strain and physiological load"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:t.map(e=>{var s,t;return(0,a.jsx)("div",{className:"card p-6",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-muted text-sm",children:((e,s)=>{let t=new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit",hour12:!0}).format(new Date(e)),a=new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"2-digit",hour12:!0}).format(new Date(s));return"".concat(t," - ").concat(a)})(e.start,e.end)}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Day Strain"}),(0,a.jsx)("span",{className:"text-lg font-bold",style:{color:e.day_strain?e.day_strain>=15?"var(--color-danger)":e.day_strain>=10?"var(--color-warning)":"var(--color-success)":"var(--color-text)"},children:(s=e.day_strain)?s.toFixed(1):"--"})]}),(0,a.jsxs)("div",{className:"text-secondary space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Avg HR:"}),(0,a.jsx)("span",{children:e.average_heart_rate?"".concat(e.average_heart_rate," bpm"):"--"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Max HR:"}),(0,a.jsx)("span",{children:e.max_heart_rate?"".concat(e.max_heart_rate," bpm"):"--"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Energy:"}),(0,a.jsx)("span",{children:(t=e.kilojoule)?"".concat(t.toFixed(0)," kJ"):"--"})]})]})]})]})},e.id)})}),e.length>3&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("p",{className:"text-secondary text-sm",children:["Showing 3 of ",e.length," cycle records"]})})]})}function p(){var e,s,t,r;let{data:c,isLoading:l}=n.F.whoop.getProfile.useQuery(),i=e=>e?new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"2-digit"}).format(new Date(e)):"--";return l?(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)("p",{className:"text-secondary",children:"Loading profile data..."})}):c?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"WHOOP Profile"}),(0,a.jsx)("p",{className:"text-secondary text-sm",children:"Your WHOOP account information"})]}),(0,a.jsx)("div",{className:"card p-6 max-w-md",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-3 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary)"},children:(0,a.jsxs)("span",{className:"text-2xl font-bold text-white",children:[(null==(s=c.first_name)||null==(e=s[0])?void 0:e.toUpperCase())||"W",(null==(r=c.last_name)||null==(t=r[0])?void 0:t.toUpperCase())||""]})}),(0,a.jsxs)("h4",{className:"text-lg font-semibold",children:[c.first_name," ",c.last_name]})]}),(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"Email:"}),(0,a.jsx)("span",{className:"font-medium",children:c.email})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"WHOOP User ID:"}),(0,a.jsx)("span",{className:"font-mono text-xs",children:c.whoop_user_id})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"Last Updated:"}),(0,a.jsx)("span",{children:i(c.last_updated)})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-secondary",children:"Synced:"}),(0,a.jsx)("span",{children:i(c.createdAt)})]})]})]})})]}):(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)("p",{className:"text-secondary",children:"No profile data available. Try syncing your WHOOP data."})})}function N(){let{data:e,isLoading:s}=n.F.whoop.getBodyMeasurements.useQuery();if(s)return(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)("p",{className:"text-secondary",children:"Loading body measurements..."})});if(!e||0===e.length)return(0,a.jsx)("div",{className:"py-8 text-center",children:(0,a.jsx)("p",{className:"text-secondary",children:"No body measurements available. Try syncing your WHOOP data."})});let t=e.slice(0,3);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Body Measurements"}),(0,a.jsx)("p",{className:"text-secondary text-sm",children:"Height, weight, and physiological metrics"})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:t.map(e=>{var s,t;return(0,a.jsx)("div",{className:"card p-6",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-muted text-sm",children:(t=(null==(s=e.measurement_date)?void 0:s.toISOString())||null)?new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(new Date(t)):"--"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-secondary mb-1 text-xs",children:"Height"}),(0,a.jsx)("div",{className:"text-sm font-medium",children:(e=>{if(!e||isNaN(e))return"--";let s=39.3701*e,t=Math.floor(s/12),a=Math.round(s%12);return"".concat(e.toFixed(2),"m (").concat(t,"′").concat(a,"″)")})(e.height_meter)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-secondary mb-1 text-xs",children:"Weight"}),(0,a.jsx)("div",{className:"text-sm font-medium",children:(e=>{if(!e||isNaN(e))return"--";let s=2.20462*e;return"".concat(e.toFixed(1)," kg (").concat(s.toFixed(1)," lbs)")})(e.weight_kilogram)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-secondary mb-1 text-xs",children:"Max Heart Rate"}),(0,a.jsx)("div",{className:"text-sm font-medium",children:e.max_heart_rate?"".concat(e.max_heart_rate," bpm"):"--"})]})]})]})},e.id)})}),e.length>3&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("p",{className:"text-secondary text-sm",children:["Showing 3 of ",e.length," measurement records"]})})]})}var y=t(3998),g=t(18332),v=t(11186);function b(){let e=(0,c.useSearchParams)(),[s,t]=(0,r.useState)(!1),[l,i]=(0,r.useState)(!1),[h,b]=(0,r.useState)(null),[w,_]=(0,r.useState)(null),[S,k]=(0,r.useState)(null),[O,D]=(0,r.useState)(),[W,P]=d("whoop-workouts-show-all",!1),[C,F]=d("whoop-workouts-sport-filter","all"),{data:T,refetch:E}=n.F.whoop.getIntegrationStatus.useQuery(),{data:I,refetch:R,isLoading:H}=n.F.whoop.getWorkouts.useQuery(),{startConnect:A,isConnecting:B,error:U,resetError:L}=function(){let[e,s]=(0,r.useState)(!1),[t,a]=(0,r.useState)(null);return{startConnect:(0,r.useCallback)(async()=>{a(null),s(!0);let e=!0;try{var t;let s=await fetch("/api/whoop/auth",{method:"POST"});if(s.ok){let t=await s.json().catch(()=>null);if(null==t?void 0:t.authorizeUrl){e=!1,window.location.assign(t.authorizeUrl);return}a("We received an unexpected response from WHOOP. Please try again.");return}let r=await s.json().catch(()=>null);if(401===s.status)return void a("You need to sign in before connecting WHOOP.");a(null!=(t=null==r?void 0:r.error)?t:"We couldn't start the WHOOP connection. Please try again soon.")}catch(e){console.error("Failed to initiate WHOOP connection",e),a("Network issue while contacting WHOOP. Please try again.")}finally{e&&s(!1)}},[]),isConnecting:e,error:t,resetError:(0,r.useCallback)(()=>{a(null)},[])}}();(0,r.useEffect)(()=>{let s=null==e?void 0:e.get("success"),t=null==e?void 0:e.get("error");if("true"===s)b({type:"success",text:"\uD83C\uDF89 Successfully connected to Whoop! You can now sync your workouts."});else if(t){let e="Failed to connect to Whoop. Please try again.";switch(t){case"whoop_not_configured":e="Whoop integration is not configured. Please contact support.";break;case"unauthorized":e="You must be logged in to connect Whoop.";break;case"invalid_state":e="Security validation failed. Please try connecting again.";break;case"no_code":e="Authorization was cancelled or failed. Please try again.";break;case"token_exchange_failed":e="Failed to complete Whoop connection. Please try again.";break;case"access_denied":e="You denied access to Whoop. Please grant access to sync workouts.";break;default:e="Connection failed: ".concat(t,". Please try again.")}b({type:"error",text:e})}if(s||t){let e=new URL(window.location.href);e.searchParams.delete("success"),e.searchParams.delete("error"),window.history.replaceState({},"",e.toString()),setTimeout(()=>{b(null),L()},1e4)}},[e,L]),(0,r.useEffect)(()=>{U&&b({type:"error",text:U})},[U]),function(e){let s=(0,r.useRef)(null),t=(0,r.useRef)(e);t.current=e,(0,r.useEffect)(()=>(s.current=setInterval(()=>{console.log("Polling for workout updates"),t.current()},3e4),()=>{s.current&&(clearInterval(s.current),s.current=null)}),[])}(()=>{R()});let M=async()=>{i(!0),b(null),L();try{let e=await fetch("/api/whoop/cleanup-duplicates",{method:"POST"}),s=await e.json();e.ok?(b({type:"success",text:s.message}),R()):b({type:"error",text:s.error||"Cleanup failed"})}catch(e){b({type:"error",text:"Network error during cleanup"})}finally{i(!1)}},z=async()=>{t(!0),b(null),L();try{let e=await fetch("/api/whoop/sync-all",{method:"POST"}),s=await e.json();if(e.ok){let{synced:e,totalNewRecords:t}=s,a="Comprehensive sync completed! ";if(t>0){let s=[];e.workouts>0&&s.push("".concat(e.workouts," workouts")),e.recovery>0&&s.push("".concat(e.recovery," recovery records")),e.cycles>0&&s.push("".concat(e.cycles," cycles")),e.sleep>0&&s.push("".concat(e.sleep," sleep records")),e.profile>0&&s.push("".concat(e.profile," profile update")),e.bodyMeasurements>0&&s.push("".concat(e.bodyMeasurements," measurements")),a+="New: ".concat(s.join(", "))}else a+="All data is up to date.";s.synced.errors&&s.synced.errors.length>0&&(a+=" (".concat(s.synced.errors.length," errors occurred)")),b({type:"success",text:a}),R()}else 401===e.status&&s.needsReauthorization?(b({type:"error",text:"\uD83D\uDD10 Your WHOOP connection has expired. Please reconnect your account to continue syncing."}),E()):429===e.status?(b({type:"error",text:s.message||"Rate limit exceeded. Please try again later."}),_({remaining:0,resetTime:s.resetTime})):b({type:"error",text:s.error||"Sync failed"})}catch(e){b({type:"error",text:"Network error during sync"})}finally{t(!1)}},Z=I?[...new Set(I.map(e=>e.sport_name).filter(e=>null!=e))]:[],G=[...I?I.filter(e=>"all"===C||e.sport_name===C):[]].sort((e,s)=>new Date(s.start).getTime()-new Date(e.start).getTime()),Y=W?G:G.slice(0,3);return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(m.Zp,{className:"max-w-md",children:(0,a.jsx)(m.Wu,{className:"pt-6 text-center",children:(null==T?void 0:T.isConnected)?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(g.Fc,{children:(0,a.jsx)(g.TN,{className:"text-center",children:"✅ Connected to Whoop"})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(y.Button,{onClick:z,disabled:s||l||(null==w?void 0:w.remaining)===0,className:"w-full",size:"lg",children:s?"Syncing All Data...":"Sync All WHOOP Data"}),(0,a.jsx)(y.Button,{onClick:M,disabled:s||l,variant:"secondary",className:"w-full",size:"sm",children:l?"Cleaning Up...":"\uD83E\uDDF9 Remove Duplicate Workouts"})]}),w&&(0,a.jsx)("div",{className:"text-muted-foreground text-center text-xs",children:w.remaining>0?"".concat(w.remaining," syncs remaining this hour"):"Rate limit reached. Resets at ".concat(new Date(w.resetTime).toLocaleTimeString())})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(g.Fc,{variant:"destructive",children:(0,a.jsx)(g.TN,{className:"text-center",children:"❌ Not connected to Whoop"})}),(0,a.jsx)(y.Button,{onClick:()=>{b(null),L(),A()},disabled:B||s||l,className:"w-full",size:"lg",children:B?"Redirecting to WHOOP…":"Connect Whoop Now"})]})})})}),h&&(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(g.Fc,{variant:"success"===h.type?"default":"destructive",className:"max-w-md",children:(0,a.jsxs)(g.TN,{className:"flex items-start justify-between",children:[(0,a.jsx)("span",{className:"text-sm",children:h.text}),(0,a.jsx)(y.Button,{variant:"ghost",size:"sm",onClick:()=>{b(null),L()},className:"ml-4 h-auto p-0 text-lg leading-none hover:bg-transparent","aria-label":"Dismiss message",children:"\xd7"})]})})}),(null==T?void 0:T.isConnected)&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:"Your Workouts"}),G.length>3&&(0,a.jsx)(y.Button,{variant:"link",size:"sm",onClick:()=>P(!W),className:"h-auto p-0 text-sm",children:W?"Show Less":"Show All (".concat(G.length,")")})]}),Z.length>0&&(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("label",{htmlFor:"sport-filter",className:"text-muted-foreground text-sm",children:"Filter by sport:"}),(0,a.jsxs)(v.l6,{value:C,onValueChange:F,children:[(0,a.jsx)(v.bq,{className:"w-48",id:"sport-filter",children:(0,a.jsx)(v.yv,{placeholder:"Select sport"})}),(0,a.jsxs)(v.gC,{children:[(0,a.jsx)(v.eb,{value:"all",children:"All Sports"}),Z.map(e=>(0,a.jsx)(v.eb,{value:e,children:e},e))]})]}),(0,a.jsx)(y.Button,{variant:"outline",size:"sm",onClick:()=>{localStorage.removeItem("whoop-workouts-sport-filter"),localStorage.removeItem("whoop-workouts-show-all"),window.location.reload()},className:"border-destructive text-destructive hover:bg-destructive hover:text-destructive-foreground",title:"Clear corrupted localStorage data",children:"Reset Prefs"})]})]}),H?(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:3}).map((e,s)=>(0,a.jsx)(m.Zp,{className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(x.EA,{className:"h-4 w-3/4"}),(0,a.jsx)(x.EA,{className:"h-6 w-1/2"}),(0,a.jsx)(x.EA,{className:"h-4 w-2/3"})]})},s))}):Y.length>0?(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Y.map(e=>(0,a.jsx)(m.Zp,{className:"cursor-pointer p-6 transition-all duration-200 hover:scale-105 hover:shadow-lg",onClick:s=>((e,s)=>{let t=s.currentTarget.getBoundingClientRect();D({x:t.left+t.width/2,y:t.top+t.height/2}),k(e)})(e,s),children:(0,a.jsx)(m.Wu,{className:"p-0",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-muted-foreground text-sm",children:((e,s)=>{let t=new Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",hour:"numeric",minute:"2-digit",hour12:!0}).format(e),a=new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"2-digit",hour12:!0}).format(s);return"".concat(t," - ").concat(a)})(new Date(e.start),new Date(e.end))}),(0,a.jsx)(m.ZB,{className:"text-lg",children:e.sport_name||"Unknown Sport"}),(0,a.jsxs)("div",{className:"text-muted-foreground text-sm",children:[(0,a.jsx)("span",{className:"font-medium",children:"Score:"})," ",((e,s)=>{if(!e||"object"!=typeof e)return"-- (".concat((null==s?void 0:s.replace("_"," "))||"UNKNOWN",")");let t=null==e?void 0:e.strain;return t&&"number"==typeof t?"".concat(t.toFixed(1)," (").concat((null==s?void 0:s.replace("_"," "))||"UNKNOWN",")"):"-- (".concat((null==s?void 0:s.replace("_"," "))||"UNKNOWN",")")})(e.score,e.score_state)]})]})})},e.id))}):(0,a.jsx)(m.Zp,{className:"py-8",children:(0,a.jsx)(m.Wu,{className:"text-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"all"!==C&&0===G.length?"No workouts from whoop":'No workouts found. Click "Sync with Whoop" to fetch your data.'})})})]}),(null==T?void 0:T.isConnected)&&(0,a.jsxs)("div",{className:"mt-12 space-y-12",children:[(0,a.jsx)(u,{}),(0,a.jsx)(f,{}),(0,a.jsx)(j,{}),(0,a.jsx)(p,{}),(0,a.jsx)(N,{})]}),(0,a.jsx)(o,{workout:S,isOpen:!!S,onClose:()=>k(null),clickOrigin:O})]})}},85007:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,52619,23)),Promise.resolve().then(t.bind(t,29761)),Promise.resolve().then(t.bind(t,3998))}},e=>{e.O(0,[274,8096,126,842,8441,7358],()=>e(e.s=85007)),_N_E=e.O()}]);