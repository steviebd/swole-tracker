(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8142],{17035:(e,s,i)=>{Promise.resolve().then(i.bind(i,87958)),Promise.resolve().then(i.bind(i,33742)),Promise.resolve().then(i.bind(i,99776)),Promise.resolve().then(i.bind(i,47785)),Promise.resolve().then(i.bind(i,25979)),Promise.resolve().then(i.bind(i,59441)),Promise.resolve().then(i.bind(i,80549)),Promise.resolve().then(i.bind(i,1043)),Promise.resolve().then(i.bind(i,11515)),Promise.resolve().then(i.bind(i,53455)),Promise.resolve().then(i.bind(i,45339)),Promise.resolve().then(i.bind(i,5947)),Promise.resolve().then(i.bind(i,86639)),Promise.resolve().then(i.t.bind(i,52619,23)),Promise.resolve().then(i.bind(i,27704)),Promise.resolve().then(i.bind(i,3998))},27704:(e,s,i)=>{"use strict";i.d(s,{ExerciseManager:()=>o});var n=i(95155),t=i(12115),a=i(80842),l=i(3998),r=i(65142),d=i(86948),c=i(87270),m=i(51834);function o(){var e;let[s,i]=(0,t.useState)(""),[m,o]=(0,t.useState)(!1),{data:h,isLoading:u,refetch:g}=a.F.exercises.getAllMaster.useQuery();(0,t.useEffect)(()=>{o(!0)},[]);let j=a.F.exercises.migrateExistingExercises.useMutation({onSuccess:e=>{alert("Migration completed! Created ".concat(e.createdMasterExercises," master exercises and ").concat(e.createdLinks," links for ").concat(e.migratedExercises," exercises.")),g()},onError:e=>{alert("Migration failed: ".concat(e.message))}}),b=null!=(e=null==h?void 0:h.filter(e=>e.name.toLowerCase().includes(s.toLowerCase())))?e:[];return!m||u?(0,n.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,n.jsx)(d.Zp,{className:"animate-pulse",children:(0,n.jsxs)(d.Wu,{className:"p-4",children:[(0,n.jsx)("div",{className:"bg-muted mb-2 h-4 w-1/4 rounded"}),(0,n.jsx)("div",{className:"bg-muted h-3 w-1/6 rounded"})]})},s))}):(null==h?void 0:h.length)?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(r.p,{type:"text",placeholder:"Search exercises...",value:s,onChange:e=>i(e.target.value),className:"w-full","aria-label":"Search exercises"}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(l.Button,{onClick:()=>j.mutate(),disabled:j.isPending,size:"sm","aria-label":"Migrate unlinked exercises to master exercises",children:j.isPending?"Migrating...":"Migrate Unlinked Exercises"})})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"text-muted-foreground text-sm",children:[b.length," exercise",1!==b.length?"s":""," found"]}),(0,n.jsx)("div",{className:"rounded-md border",children:(0,n.jsxs)(c.XI,{role:"table","aria-label":"Exercise management table",children:[(0,n.jsx)(c.A0,{children:(0,n.jsxs)(c.Hj,{children:[(0,n.jsx)(c.nd,{children:"Exercise Name"}),(0,n.jsx)(c.nd,{className:"hidden sm:table-cell",children:"Created"}),(0,n.jsx)(c.nd,{children:"Linked Templates"}),(0,n.jsx)(c.nd,{className:"text-right",children:"Actions"})]})}),(0,n.jsxs)(c.BF,{children:[b.map(e=>(0,n.jsx)(x,{exercise:e,onUpdate:g},e.id)),0===b.length&&(0,n.jsx)(c.Hj,{children:(0,n.jsx)(c.nA,{colSpan:4,className:"text-muted-foreground py-8 text-center",children:"No exercises found"})})]})]})})]})]}):(0,n.jsxs)("div",{className:"py-12 text-center",children:[(0,n.jsx)("div",{className:"mb-4 text-6xl",children:"\uD83D\uDCAA"}),(0,n.jsx)("h3",{className:"mb-2 text-xl font-semibold",children:"No exercises yet"}),(0,n.jsx)("p",{className:"text-secondary mb-6",children:"Exercises will appear here as you create workout templates and link them together."}),(0,n.jsx)(l.Button,{onClick:()=>j.mutate(),disabled:j.isPending,size:"lg","aria-label":"Migrate existing exercises to linkable master exercises",children:j.isPending?"Migrating...":"Migrate Existing Exercises"}),(0,n.jsx)("p",{className:"text-muted mt-2 text-xs",children:"This will convert your existing template exercises into linkable master exercises."})]})}function x(e){let{exercise:s,onUpdate:i}=e,[a,r]=(0,t.useState)(!1);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(c.Hj,{children:[(0,n.jsxs)(c.nA,{children:[(0,n.jsx)("div",{className:"font-medium",children:s.name}),(0,n.jsxs)("div",{className:"text-muted-foreground text-sm sm:hidden",children:["Created ",s.createdAt.toLocaleDateString()]})]}),(0,n.jsx)(c.nA,{className:"text-muted-foreground hidden text-sm sm:table-cell",children:s.createdAt.toLocaleDateString()}),(0,n.jsx)(c.nA,{children:(0,n.jsxs)("div",{className:"text-sm",children:[s.linkedCount," template",1!==s.linkedCount?"s":""]})}),(0,n.jsx)(c.nA,{className:"text-right",children:(0,n.jsx)(l.Button,{variant:"ghost",size:"sm",onClick:()=>r(!a),"aria-expanded":a,"aria-label":"".concat(a?"Hide":"Show"," details for ").concat(s.name),children:a?"Hide Details":"Show Details"})})]}),a&&(0,n.jsx)(c.Hj,{children:(0,n.jsx)(c.nA,{colSpan:4,className:"p-0",children:(0,n.jsx)("div",{className:"bg-muted/50 border-t p-4",children:(0,n.jsx)(h,{masterExerciseId:s.id,masterExerciseName:s.name,normalizedName:s.normalizedName,onUpdate:i})})})})]})}function h(e){let{masterExerciseId:s,masterExerciseName:i,normalizedName:r,onUpdate:c}=e,[o,x]=(0,t.useState)(!1),{data:h,isLoading:u,refetch:g}=a.F.exercises.getLinkingDetails.useQuery({masterExerciseId:s}),{data:j}=a.F.exercises.getLatestPerformance.useQuery({masterExerciseId:s}),b=a.F.exercises.unlink.useMutation({onSuccess:()=>{g(),c()}}),p=a.F.exercises.linkToMaster.useMutation({onSuccess:()=>{g(),c()}}),N=a.F.exercises.bulkLinkSimilar.useMutation({onSuccess:e=>{alert("Successfully linked ".concat(e.linkedCount," similar exercises!")),g(),c()}}),k=a.F.exercises.bulkUnlinkAll.useMutation({onSuccess:e=>{alert("Successfully unlinked ".concat(e.unlinkedCount," exercises!")),g(),c(),x(!1)}});if(u)return(0,n.jsx)("div",{className:"border-border mt-4 space-y-3 border-t pt-4",children:(0,n.jsx)("div",{className:"text-secondary animate-pulse text-sm",children:"Loading linking details..."})});if(!h)return(0,n.jsx)("div",{className:"border-border mt-4 space-y-3 border-t pt-4",children:(0,n.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400",children:"Failed to load linking details"})});let{linkedExercises:v,potentialLinks:f}=h,y=f.filter(e=>e.similarity>=.6&&!e.linkingRejected);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(d.Zp,{className:"bg-muted/30",children:(0,n.jsx)(d.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Normalized name:"}),(0,n.jsx)("span",{className:"bg-muted ml-2 rounded px-2 py-1 font-mono text-xs",children:r})]}),j&&(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-muted-foreground",children:"Latest performance:"}),(0,n.jsxs)("div",{className:"mt-1 ml-2",children:[(0,n.jsxs)("span",{className:"font-medium text-green-600 dark:text-green-400",children:[j.weight," ",j.unit," \xd7"," ",j.reps," reps \xd7 ",j.sets," ","sets"]}),(0,n.jsxs)("span",{className:"text-muted-foreground ml-2 text-xs",children:["(",new Date(j.workoutDate).toLocaleDateString(),")"]})]})]})]})})}),(0,n.jsxs)("div",{className:"flex gap-2",children:[y.length>0&&(0,n.jsx)(l.Button,{onClick:()=>N.mutate({masterExerciseId:s}),disabled:N.isPending,size:"sm","aria-label":"Link all ".concat(y.length," similar exercises to ").concat(i),children:N.isPending?"Linking...":"Link All Similar (".concat(y.length,")")}),v.length>0&&(0,n.jsxs)(l.Button,{onClick:()=>x(!0),variant:"destructive",size:"sm","aria-label":"Unlink all ".concat(v.length," linked exercises from ").concat(i),children:["Unlink All (",v.length,")"]})]}),(0,n.jsx)(m.lG,{open:o,onOpenChange:x,children:(0,n.jsxs)(m.Cf,{children:[(0,n.jsxs)(m.c7,{children:[(0,n.jsx)(m.L3,{children:"Confirm Unlink All"}),(0,n.jsxs)(m.rr,{children:["This will unlink all ",v.length,' exercises from "',i,'". Historical data will be separated and this action cannot be undone.']})]}),(0,n.jsxs)(m.Es,{children:[(0,n.jsx)(l.Button,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),(0,n.jsx)(l.Button,{variant:"destructive",onClick:()=>k.mutate({masterExerciseId:s}),disabled:k.isPending,children:k.isPending?"Unlinking...":"Confirm Unlink All"})]})]})}),v.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"mb-3 text-sm font-medium text-green-700 dark:text-green-400",children:["\uD83D\uDD17 Linked Template Exercises (",v.length,")"]}),(0,n.jsx)("div",{className:"space-y-2",children:v.map(e=>(0,n.jsx)(d.Zp,{className:"border-green-200 bg-green-50/50 dark:border-green-800 dark:bg-green-950/50",children:(0,n.jsx)(d.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:e.exerciseName}),(0,n.jsxs)("span",{className:"text-muted-foreground ml-2",children:["from ",e.templateName]})]}),(0,n.jsx)(l.Button,{variant:"destructive",size:"sm",onClick:()=>b.mutate({templateExerciseId:e.templateExerciseId}),disabled:b.isPending,className:"h-7 px-2 text-xs","aria-label":"Unlink ".concat(e.exerciseName," from ").concat(e.templateName),children:b.isPending?"...":"Unlink"})]})})},e.templateExerciseId))})]}),f.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"mb-3 text-sm font-medium text-blue-700 dark:text-blue-400",children:["\uD83D\uDD0D Potential Links (",f.length,")"]}),(0,n.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,n.jsx)(d.Zp,{className:e.linkingRejected?"border-orange-200 bg-orange-50/50 dark:border-orange-800 dark:bg-orange-950/50":e.similarity>=.7?"border-blue-200 bg-blue-50/50 dark:border-blue-800 dark:bg-blue-950/50":"border-border bg-muted/50",children:(0,n.jsx)(d.Wu,{className:"p-3",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsx)("span",{className:"font-medium",children:e.exerciseName}),(0,n.jsxs)("span",{className:"text-muted-foreground ml-2",children:["from ",e.templateName]}),(0,n.jsxs)("span",{className:"ml-2 inline-flex items-center rounded-full px-2 py-1 text-xs font-medium ".concat(e.similarity>=.7?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400"),children:[Math.round(100*e.similarity),"% match"]}),e.linkingRejected&&(0,n.jsx)("span",{className:"ml-2 inline-flex items-center rounded-full bg-orange-100 px-2 py-1 text-xs font-medium text-orange-700 dark:bg-orange-900/50 dark:text-orange-400",children:"rejected"})]}),!e.linkingRejected&&(0,n.jsx)(l.Button,{size:"sm",onClick:()=>p.mutate({templateExerciseId:e.templateExerciseId,masterExerciseId:s}),disabled:p.isPending,className:"h-7 px-2 text-xs","aria-label":"Link ".concat(e.exerciseName," from ").concat(e.templateName," to master exercise"),children:p.isPending?"...":"Link"})]})})},e.templateExerciseId))})]}),0===f.length&&(0,n.jsx)(d.Zp,{className:"bg-muted/30",children:(0,n.jsx)(d.Wu,{className:"p-4 text-center",children:(0,n.jsx)("div",{className:"text-muted-foreground text-sm",children:"No unlinked template exercises found"})})})]})}}},e=>{e.O(0,[274,8096,126,842,8441,7358],()=>e(e.s=17035)),_N_E=e.O()}]);