(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2877],{41444:(e,t,s)=>{"use strict";s.d(t,{vF:()=>n});class r{shouldLog(e){return!this.isTest&&(!!this.isDevelopment||"warn"===e||"error"===e)}sanitizeContext(e){let t={...e};return delete t.accessToken,delete t.refreshToken,delete t.password,delete t.secret,this.isDevelopment||Object.keys(t).forEach(e=>{let s=t[e];"string"==typeof s&&s.length>100&&(t[e]=s.substring(0,97)+"...")}),t}debug(e,t){if(!this.shouldLog("debug"))return;let s=t?this.sanitizeContext(t):{};console.log("[DEBUG] ".concat(e),s)}info(e,t){if(!this.shouldLog("info"))return;let s=t?this.sanitizeContext(t):{};console.log("[INFO] ".concat(e),s)}warn(e,t){if(!this.shouldLog("warn"))return;let s=t?this.sanitizeContext(t):{};console.warn("[WARN] ".concat(e),s)}error(e,t,s){if(!this.shouldLog("error"))return;let r=s?this.sanitizeContext(s):{};t instanceof Error?console.error("[ERROR] ".concat(e),{error:t.message,stack:this.isDevelopment?t.stack:void 0,...r}):console.error("[ERROR] ".concat(e),{error:t,...r})}webhook(e,t,s){if(this.isDevelopment){let r={...s,payload:t};this.debug("Webhook: ".concat(e),r)}else this.info("Webhook: ".concat(e),s)}timing(e,t,s){this.isDevelopment&&this.debug("".concat(e," took ").concat(t,"ms"),s)}security(e,t){var s;let r=t?this.sanitizeContext(t):{};(null!=(s=console.warn)?s:console.log)("[SECURITY] ".concat(e),r)}constructor(){this.isDevelopment=!1,this.isTest=!1}}let n=new r},60080:(e,t,s)=>{"use strict";s.d(t,{z:()=>l});var r=s(26614);let n=(e,t)=>{try{if("undefined"==typeof navigator||!0!==navigator.onLine)return;r.Ay.capture(e,null!=t?t:{})}catch(e){}},l={pageView:(e,t)=>{try{let s=window.location.href;n("$pageview",{$current_url:s,page:e,...t})}catch(e){}},workoutStarted:(e,t)=>{n("workout_started",{templateId:e,templateName:t,timestamp:new Date().toISOString()})},workoutCompleted:(e,t,s)=>{n("workout_completed",{sessionId:e,duration:t,exerciseCount:s,timestamp:new Date().toISOString()})},exerciseLogged:(e,t,s,r)=>{n("exercise_logged",{exerciseId:e,exerciseName:t,sets:s,weight:r,timestamp:new Date().toISOString()})},templateCreated:(e,t)=>{n("template_created",{templateId:e,exerciseCount:t,timestamp:new Date().toISOString()})},templateDeleted:e=>{n("template_deleted",{templateId:e,timestamp:new Date().toISOString()})},templateEdited:(e,t)=>{n("template_edited",{templateId:e,exerciseCount:t,timestamp:new Date().toISOString()})},templateDuplicated:e=>{n("template_duplicated",{templateId:e,timestamp:new Date().toISOString()})},weightUnitChanged:e=>{n("weight_unit_changed",{unit:e,timestamp:new Date().toISOString()})},error:(e,t)=>{n("error",{error:e.message,stack:e.stack,context:t,timestamp:new Date().toISOString()})},featureUsed:(e,t)=>{n("feature_used",{feature:e,...t,timestamp:new Date().toISOString()})},aiDebriefViewed:(e,t,s)=>{n("ai_debrief.viewed",{sessionId:e,version:t,streakLength:s,timestamp:new Date().toISOString()})},aiDebriefRegenerated:(e,t,s)=>{n("ai_debrief.regenerated",{sessionId:e,version:t,reason:s,timestamp:new Date().toISOString()})},aiDebriefDismissed:(e,t,s)=>{n("ai_debrief.dismissed",{sessionId:e,version:t,pinned:s,timestamp:new Date().toISOString()})}}},78730:(e,t,s)=>{"use strict";s.d(t,{Rf:()=>l,aF:()=>o});var r=s(12115),n=s(80842);function l(e){let{exerciseName:t,templateExerciseId:s,unit:l="kg",limitSessions:o=10,excludeSessionId:a}=e,i=n.F.insights.getExerciseInsights.useQuery({exerciseName:t,templateExerciseId:s,unit:l,limitSessions:o,excludeSessionId:a},{enabled:!!t,staleTime:3e4}),c=(0,r.useMemo)(()=>{var e;return null!=(e=i.data)?e:{unit:l,bestSet:void 0,best1RM:void 0,volumeSparkline:[],recommendation:void 0,suggestions:[]}},[i.data,l]);return{...i,data:c}}function o(e){var t;let s=null==e?void 0:e.since,r=null!=(t=null==e?void 0:e.limit)?t:50;return n.F.insights.exportWorkoutsCSV.useQuery({since:s,limit:r},{enabled:!0,staleTime:0,refetchOnWindowFocus:!1})}},83960:(e,t,s)=>{"use strict";s.d(t,{G:()=>a,s:()=>o});var r=s(95155),n=s(12115);function l(e){return e?Array.from(e.querySelectorAll("a[href],button:not([disabled]),textarea:not([disabled]),input:not([disabled]),select:not([disabled]),[tabindex]:not([tabindex='-1']),[contenteditable='true']")).filter(e=>{let t=window.getComputedStyle(e);return!("hidden"===t.visibility||"none"===t.display||e.hasAttribute("disabled"))}):[]}function o(e){let{children:t,onEscape:s,initialFocusRef:o,preventScroll:a}=e,i=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{var e;let t=i.current;if(!t)return;let s=null;a&&"undefined"!=typeof document&&(s=document.body.style.overflow,document.body.style.overflow="hidden");let r=null!=(e=null==o?void 0:o.current)?e:l(t)[0];if(r&&"function"==typeof r.focus)try{r.focus()}catch(e){}return()=>{a&&"undefined"!=typeof document&&null!==s&&(document.body.style.overflow=s)}},[o,a]),(0,n.useEffect)(()=>{let e=i.current;if(!e)return;let t=t=>{if("Escape"===t.key){s&&(t.stopPropagation(),t.preventDefault(),s());return}if("Tab"!==t.key)return;let r=l(e);if(0===r.length){var n;t.preventDefault(),null==(n=e.focus)||n.call(e);return}let o=document.activeElement,a=r[0],i=r[r.length-1];t.shiftKey?(!o||a&&o===a)&&(t.preventDefault(),i&&i.focus()):(!o||i&&o===i)&&(t.preventDefault(),a&&a.focus())};return e.addEventListener("keydown",t),()=>{e.removeEventListener("keydown",t)}},[s]),(0,r.jsx)("div",{ref:i,tabIndex:-1,children:t})}function a(){let e=(0,n.useRef)(null);return(0,n.useEffect)(()=>{try{let t=document.activeElement;t&&(e.current=t)}catch(e){}},[]),{triggerRef:e,restoreFocus:()=>{try{let t=e.current;t&&"function"==typeof t.focus&&t.focus()}catch(e){}}}}},89770:(e,t,s)=>{Promise.resolve().then(s.bind(s,87958)),Promise.resolve().then(s.bind(s,33742)),Promise.resolve().then(s.bind(s,99776)),Promise.resolve().then(s.bind(s,47785)),Promise.resolve().then(s.bind(s,25979)),Promise.resolve().then(s.bind(s,59441)),Promise.resolve().then(s.bind(s,80549)),Promise.resolve().then(s.bind(s,1043)),Promise.resolve().then(s.bind(s,11515)),Promise.resolve().then(s.bind(s,53455)),Promise.resolve().then(s.bind(s,45339)),Promise.resolve().then(s.bind(s,5947)),Promise.resolve().then(s.bind(s,86639)),Promise.resolve().then(s.t.bind(s,52619,23)),Promise.resolve().then(s.bind(s,93532)),Promise.resolve().then(s.bind(s,3998)),Promise.resolve().then(s.bind(s,36904))},93532:(e,t,s)=>{"use strict";s.d(t,{WorkoutSessionWithHealthAdvice:()=>q});var r=s(95155),n=s(12115),l=s(3998),o=s(20063),a=s(52619),i=s.n(a);let c={dismissThreshold:150,velocityThreshold:8,friction:.95,minimumVelocity:.5,framesPerSecond:60};function d(e){let{name:t,isExpanded:s,previousBest:n,onToggleExpansion:l,onSwipeToBottom:o,exerciseIndex:a}=e;return(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex min-w-0 flex-col",children:[(0,r.jsx)("div",{className:"truncate text-base font-semibold",style:{color:"var(--color-text)"},children:t}),n&&(0,r.jsxs)("div",{className:"text-xs",style:{color:"var(--color-text-muted)"},children:["Prev best:"," ",void 0!==n.weight?"".concat(n.weight).concat(n.unit):"-",void 0!==n.reps?" \xd7 ".concat(n.reps):"",void 0!==n.sets?" (".concat(n.sets," set").concat(n.sets>1?"s":"",")"):""]})]}),(0,r.jsx)("div",{className:"ml-3 flex shrink-0 items-center gap-2",children:(0,r.jsx)("button",{type:"button",className:"rounded border px-2 py-1 text-xs transition-colors",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-surface)",color:"var(--color-text)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-border)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-bg-surface)"},onClick:e=>{e.stopPropagation(),l(a)},"aria-expanded":s,"aria-label":s?"Collapse exercise":"Expand exercise",children:s?"Collapse":"Expand"})})]})}var u=s(60080);function m(e){var t,s,l;let{set:o,setIndex:a,exerciseIndex:i,exerciseName:c,templateExerciseId:d,onUpdate:m,onToggleUnit:p,onDelete:g,readOnly:x=!1,showDelete:h=!0,onMoveUp:v,onMoveDown:f,preferredUnit:y="kg"}=e,b=(0,n.useRef)(null),w=(0,n.useRef)(null),j=(0,n.useRef)(null),N=(0,n.useRef)(null);(0,n.useEffect)(()=>{"number"!=typeof o.weight||Number.isNaN(o.weight)||(N.current=o.weight)},[o.weight]);let _=e=>{m(i,a,"rest",e)};return(0,r.jsxs)("div",{className:"glass-card glass-hairline text-foreground card-interactive flex items-center gap-3 rounded-lg p-3 select-none",children:[(0,r.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full text-xs font-medium",style:{backgroundColor:"var(--color-primary)",color:"var(--btn-primary-fg)"},children:a+1}),(0,r.jsxs)("div",{className:"flex flex-1 flex-wrap gap-3",children:[(0,r.jsxs)("div",{className:"min-w-[120px] flex-1",children:[(0,r.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Weight"}),(0,r.jsxs)("div",{className:"relative flex items-center",children:[(0,r.jsx)("input",{ref:b,type:"number",step:"0.5",inputMode:"decimal",pattern:"[0-9]*",value:null!=(t=o.weight)?t:"",onChange:e=>{var t,s=e.target.value?parseFloat(e.target.value):void 0;m(i,a,"weight",s),s&&o.sets&&u.z.exerciseLogged(null!=(t=null==d?void 0:d.toString())?t:"custom",c,o.sets,s)},onFocus:e=>{e.target.select();try{e.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch(e){}},placeholder:"0",disabled:x,className:"input-primary w-full pr-12 ".concat(x?"cursor-not-allowed opacity-60":"")}),(0,r.jsx)("span",{className:"pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-xs select-none",style:{color:"var(--color-text-muted)"},children:y})]})]}),(0,r.jsxs)("div",{className:"min-w-[100px] flex-1",children:[(0,r.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Reps"}),(0,r.jsx)("input",{ref:w,type:"number",inputMode:"numeric",pattern:"[0-9]*",value:null!=(s=o.reps)?s:"",onChange:e=>{m(i,a,"reps",e.target.value?parseInt(e.target.value):void 0)},onFocus:e=>{e.target.select();try{e.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch(e){}},placeholder:"0",disabled:x,className:"input-primary w-full ".concat(x?"cursor-not-allowed opacity-60":"")})]}),(0,r.jsxs)("div",{className:"min-w-[100px] flex-1",children:[(0,r.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Sets"}),(0,r.jsx)("input",{type:"number",inputMode:"numeric",pattern:"[0-9]*",value:o.sets,onChange:e=>{var t;m(i,a,"sets",null!=(t=e.target.value?parseInt(e.target.value):1)?t:1)},onFocus:e=>{e.target.select();try{e.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch(e){}},placeholder:"1",min:"1",disabled:x,className:"input-primary w-full ".concat(x?"cursor-not-allowed opacity-60":"")})]}),(0,r.jsxs)("div",{className:"min-w-[160px]",children:[(0,r.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"RPE"}),(0,r.jsx)("div",{className:"flex items-center gap-1",children:[6,7,8,9,10].map(e=>{let t=o.rpe===e;return(0,r.jsx)("button",{type:"button",disabled:x,onClick:()=>!x&&void m(i,a,"rpe",e),className:"rounded-md px-2 py-1 text-xs ".concat(t?"btn-primary":"btn-secondary"," ").concat(x?"cursor-not-allowed opacity-60":""," "),children:e},e)})})]}),(0,r.jsxs)("div",{className:"min-w-[160px] flex-1",children:[(0,r.jsx)("label",{className:"mb-1 block text-xs",style:{color:"var(--color-text-secondary)"},children:"Rest (s)"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("input",{ref:j,type:"number",inputMode:"numeric",pattern:"[0-9]*",value:null!=(l=o.rest)?l:"",onChange:e=>{_(e.target.value?parseInt(e.target.value):void 0)},onFocus:e=>{e.target.select();try{e.currentTarget.scrollIntoView({block:"center",behavior:"smooth"})}catch(e){}},placeholder:"60",disabled:x,className:"input-primary w-full ".concat(x?"cursor-not-allowed opacity-60":"")}),[30,60,90].map(e=>(0,r.jsx)("button",{type:"button",disabled:x,onClick:()=>!x&&_(e),className:"btn-secondary rounded-md px-2 py-1 text-xs ".concat(x?"cursor-not-allowed opacity-60":""),children:e},e))]})]})]}),!x&&(v||f)&&(0,r.jsxs)("div",{className:"mr-1 ml-1 flex flex-col gap-1",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{console.log("[SetInput] Move Up button clicked",{exerciseIndex:i,setIndex:a}),null==v||v()},disabled:!v,className:"px-1 py-1 transition-colors disabled:cursor-not-allowed disabled:opacity-30",style:{color:"var(--color-text-secondary)"},onMouseEnter:e=>e.currentTarget.style.color="var(--color-text)",onMouseLeave:e=>e.currentTarget.style.color="var(--color-text-secondary)",title:"Move set up","aria-label":"Move set up",children:(0,r.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M7 14l5-5 5 5z"})})}),(0,r.jsx)("button",{type:"button",onClick:()=>{console.log("[SetInput] Move Down button clicked",{exerciseIndex:i,setIndex:a}),null==f||f()},disabled:!f,className:"px-1 py-1 transition-colors disabled:cursor-not-allowed disabled:opacity-30",style:{color:"var(--color-text-secondary)"},onMouseEnter:e=>e.currentTarget.style.color="var(--color-text)",onMouseLeave:e=>e.currentTarget.style.color="var(--color-text-secondary)",title:"Move set down","aria-label":"Move set down",children:(0,r.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"currentColor",children:(0,r.jsx)("path",{d:"M7 10l5 5 5-5z"})})})]}),!x&&h&&(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),g(i,a)},onPointerDown:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),className:"btn-destructive flex h-8 w-8 items-center justify-center rounded-full",title:"Delete set",children:"\xd7"})]})}function p(e){let{exerciseIndex:t,exerciseName:s,templateExerciseId:n,sets:l,readOnly:o,onUpdate:a,onToggleUnit:i,onAddSet:c,onDeleteSet:d,onMoveSet:u,preferredUnit:p="kg"}=e;return(0,r.jsxs)("div",{className:"space-y-2",children:[l.map((e,c)=>(0,r.jsx)(m,{set:e,setIndex:c,exerciseIndex:t,exerciseName:s,templateExerciseId:n,onUpdate:a,onToggleUnit:i,onDelete:d,readOnly:o,showDelete:l.length>1,preferredUnit:p,onMoveUp:c>0?()=>{console.log("[SetList] onMoveUp callback triggered",{exerciseIndex:t,setIndex:c}),u(t,c,"up")}:void 0,onMoveDown:c<l.length-1?()=>{console.log("[SetList] onMoveDown callback triggered",{exerciseIndex:t,setIndex:c}),u(t,c,"down")}:void 0},"".concat(t,"-").concat(e.id,"-").concat(c))),!o&&(0,r.jsx)("div",{children:(0,r.jsx)("button",{className:"w-full rounded-md border border-border bg-background py-2 text-sm text-foreground transition-colors hover:bg-muted",onClick:e=>{e.preventDefault(),e.stopPropagation(),c(t)},children:"Add Set"})})]})}var g=s(26614);let x=[];function h(e){try{"undefined"!=typeof navigator&&navigator.vibrate&&navigator.vibrate(e)}catch(e){}}function v(){let e=(0,n.useRef)(null);function t(t,s){e.current&&e.current(t,s)}return(0,n.useEffect)(()=>{},[]),t.__attach=t=>{e.current=t},t}function f(e){(0,n.useEffect)(()=>{let t=window.__liveRegionAnnounce;if(t&&"function"==typeof e){let s=e.__attach;"function"==typeof s&&s(t)}},[e])}var y=s(78730);function b(e){let{exercise:t,exerciseIndex:s,onUpdate:l,onToggleUnit:o,onAddSet:a,onDeleteSet:i,onMoveSet:u,isExpanded:m,onToggleExpansion:x,previousBest:b,previousSets:w,readOnly:j=!1,onSwipeToBottom:N,isDraggedOver:_=!1,isDragging:k=!1,dragOffset:S={x:0,y:0},swipeSettings:C,isSwiped:M=!1,draggable:I=!1,onPointerDown:E,setCardElement:D,preferredUnit:A="kg"}=e,R=v();f(R);let[W,T,P]=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"horizontal",r=(0,n.useMemo)(()=>({...c,...t}),[t]),[l,o]=(0,n.useState)(0),[a,i]=(0,n.useState)(0),[d,u]=(0,n.useState)(!1),[m,p]=(0,n.useState)(0),[g,x]=(0,n.useState)(!1),h=(0,n.useRef)(null),v=(0,n.useRef)(null),f=(0,n.useRef)(0),y=(0,n.useRef)(0),b=(0,n.useRef)(0),w=(0,n.useRef)(null),j=(0,n.useRef)(!1),N=(0,n.useCallback)(()=>{w.current&&cancelAnimationFrame(w.current);let t=()=>{p(n=>{let l=n*r.friction;return .1>Math.abs(l)?("horizontal"===s?o(0):i(0),0):("horizontal"===s?o(t=>{let s=t+l;return Math.abs(s)>r.dismissThreshold||Math.abs(m)>r.velocityThreshold?(x(!0),null==e||e(),0):s}):i(t=>{let s=t+l;return Math.abs(s)>r.dismissThreshold||Math.abs(m)>r.velocityThreshold?(x(!0),null==e||e(),0):s}),w.current=requestAnimationFrame(t),l)})};w.current=requestAnimationFrame(t)},[r,s,m,e]),_=(0,n.useCallback)(function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];h.current=e,v.current=t,f.current=e,y.current=t,b.current=Date.now(),u(!0),p(0),j.current=s,w.current&&cancelAnimationFrame(w.current)},[]),k=(0,n.useCallback)(function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2],!d||!h.current||!v.current)return;let n=e-h.current,l=t-v.current;if("horizontal"===s){if(Math.abs(n)>Math.abs(l)){o(n);let t=Date.now(),s=t-b.current,l=e-f.current;s>0&&p(l/s*(1e3/r.framesPerSecond)),f.current=e,b.current=t}}else if(Math.abs(l)>Math.abs(n)){i(l);let e=Date.now(),s=e-b.current,n=t-y.current;s>0&&p(n/s*(1e3/r.framesPerSecond)),y.current=t,b.current=e}},[d,s,r.framesPerSecond]),S=(0,n.useCallback)(()=>{d&&(u(!1),j.current=!1,Math.abs("horizontal"===s?l:a)>r.dismissThreshold||Math.abs(m)>r.velocityThreshold?(x(!0),null==e||e(),"horizontal"===s?o(0):i(0)):Math.abs(m)>r.minimumVelocity?N():"horizontal"===s?o(0):i(0))},[d,s,l,a,m,r,e,N]),C=(0,n.useCallback)(e=>{let t=e.touches[0];t&&_(t.clientX,t.clientY)},[_]),M=(0,n.useCallback)(e=>{let t=e.touches[0];t&&k(t.clientX,t.clientY,!1)},[k]),I=(0,n.useCallback)(()=>{S()},[S]),E=(0,n.useCallback)(e=>{e.preventDefault(),_(e.clientX,e.clientY,!0)},[_]),D=(0,n.useCallback)(e=>{j.current&&k(e.clientX,e.clientY)},[k]),A=(0,n.useCallback)(()=>{j.current&&S()},[S]),R=(0,n.useCallback)(()=>{j.current&&S()},[S]),W=(0,n.useCallback)(()=>{o(0),i(0),u(!1),p(0),x(!1),j.current=!1,w.current&&cancelAnimationFrame(w.current)},[]);return(0,n.useEffect)(()=>()=>{w.current&&cancelAnimationFrame(w.current)},[]),[{translateX:l,translateY:a,isDragging:d,velocity:m,isDismissed:g},{onTouchStart:C,onTouchMove:M,onTouchEnd:I,onMouseDown:E,onMouseMove:D,onMouseUp:A,onMouseLeave:R},W]}(()=>{if(N&&!j){try{h(10)}catch(e){}try{g.Ay.capture("haptic_action",{kind:"swipe"})}catch(e){}try{R("Moved ".concat(t.exerciseName," to end"),{assertive:!0})}catch(e){}N(s),setTimeout(()=>P(),50)}},C,"horizontal"),O=t.sets.some(e=>{var t;return null!=(t=e.weight)?t:e.reps}),L=(()=>{if(0===t.sets.length)return null;let e=Math.max(...t.sets.map(e=>{var t;return null!=(t=e.weight)?t:0})),s=t.sets.find(t=>t.weight===e);return(null==s?void 0:s.weight)?{weight:s.weight,reps:s.reps,sets:s.sets,unit:s.unit}:null})(),{data:F}=(0,y.Rf)({exerciseName:t.exerciseName,templateExerciseId:t.templateExerciseId,unit:t.unit,limitSessions:10}),z=W.isDragging&&Math.abs(W.translateX)>0,U=z&&W.translateX>0,B=z&&W.translateX<0,V=k&&Math.abs(S.y)>Math.abs(S.x),Q={transform:"translate(".concat(V||W.isDismissed?0:W.translateX,"px, ").concat(V?S.y:0,"px)"),opacity:V?.9:W.isDismissed?1:Math.max(.3,1-Math.abs(W.translateX)/300),scale:V?1.03:W.isDismissed?1:Math.max(.9,1-Math.abs(W.translateX)/600),zIndex:V?50:1,transition:W.isDragging&&z||V?"none":"transform var(--motion-duration-base) var(--motion-ease), opacity var(--motion-duration-base) var(--motion-ease), scale var(--motion-duration-base) var(--motion-ease)",touchAction:"pan-y pinch-zoom",willChange:V?"transform":void 0},H="\n    card glass-surface overflow-hidden select-none\n    ".concat(_?"glass-hairline":"","\n    ").concat(V?"shadow-xl cursor-grabbing":"","\n  ").trim(),G=e=>{let t=e.target;!t.closest('[data-drag-handle="true"]')&&(t.closest("input,textarea,select,button,label,[contenteditable='true'],[role='textbox'],[role='spinbutton'],[role='button']")||("touches"in e?T.onTouchStart(e):T.onMouseDown(e)))},q=T.onMouseMove,Y=T.onMouseUp,X=T.onMouseLeave,J=T.onTouchMove,Z=T.onTouchEnd;return(0,r.jsxs)("div",{ref:D,className:H,style:Q,role:"group","aria-roledescription":"Exercise card","aria-label":"".concat(t.exerciseName),onPointerDown:G,onMouseDown:G,onTouchStart:G,onMouseMove:q,onMouseUp:Y,onMouseLeave:X,onTouchMove:J,onTouchEnd:Z,children:[B&&!j&&(0,r.jsx)("div",{className:"glass-surface pointer-events-none absolute inset-y-0 right-2 my-auto flex h-6 items-center rounded px-2 text-xs",role:"status","aria-live":"polite",children:"Move to end →"}),U&&!j&&(0,r.jsxs)("div",{className:"glass-surface pointer-events-none absolute inset-y-0 left-2 my-auto flex h-6 items-center rounded px-2 text-xs",role:"status","aria-live":"polite",children:[m?"Collapse":"Expand"," ←"]}),(0,r.jsx)("div",{className:"hover:glass-hairline w-full cursor-pointer p-4 text-left transition-colors",role:"button","aria-expanded":m?"true":"false","aria-label":"".concat(m?"Collapse":"Expand"," ").concat(t.exerciseName),onClick:()=>x(s),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(d,{name:t.exerciseName,isExpanded:m,isSwiped:M,readOnly:null!=j&&j,previousBest:O&&L?L:b,onToggleExpansion:x,onSwipeToBottom:N,exerciseIndex:s})}),I&&!j&&(0,r.jsx)("button",{type:"button","aria-label":"Drag to reorder","data-drag-handle":"true",className:"group ml-2 cursor-grab touch-none px-1 py-2 text-gray-400 hover:text-gray-200 active:cursor-grabbing",onPointerDown:e=>null==E?void 0:E(e,{force:!0}),onMouseDown:e=>null==E?void 0:E(e,{force:!0}),onTouchStart:e=>null==E?void 0:E(e,{force:!0}),style:{touchAction:"none"},title:"Drag to reorder",children:(0,r.jsxs)("span",{className:"inline-flex flex-col gap-0.5",children:[(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"}),(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full bg-current"})]})})]})}),m&&(0,r.jsxs)("div",{className:"space-y-3 px-4 pb-4",children:[!j&&(0,r.jsxs)("div",{className:"glass-surface glass-hairline rounded-lg p-3",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-secondary text-xs font-medium",children:"INSIGHTS"}),(null==F?void 0:F.bestSet)?(0,r.jsxs)("span",{className:"text-sm",children:["Best:"," ",(0,r.jsxs)("strong",{children:[F.bestSet.weight,F.bestSet.unit]}),F.bestSet.reps?(0,r.jsxs)(r.Fragment,{children:[" \xd7 ",F.bestSet.reps]}):null,"number"==typeof F.best1RM?(0,r.jsxs)("span",{className:"text-muted ml-2 text-xs",children:["1RM≈ ",F.best1RM.toFixed(1),t.unit]}):null]}):(0,r.jsx)("span",{className:"text-muted text-sm",children:"No history yet"})]}),(null==F?void 0:F.recommendation)?(0,r.jsx)("button",{type:"button",className:"glass-surface hover:glass-hairline ml-auto shrink-0 rounded-full px-3 py-1 text-xs transition-colors","aria-label":"Apply auto-progression recommendation",onClick:()=>{try{h(5)}catch(e){}try{let e=F.recommendation;g.Ay.capture("insights_apply_recommendation",{exerciseName:t.exerciseName,type:null==e?void 0:e.type,nextWeight:(null==e?void 0:e.type)==="weight"?e.nextWeight:void 0,nextReps:(null==e?void 0:e.type)==="reps"?e.nextReps:void 0,unit:null==e?void 0:e.unit})}catch(e){}let e=F.recommendation;if(e&&"weight"===e.type&&Object.prototype.hasOwnProperty.call(e,"nextWeight")&&"number"==typeof e.nextWeight)l(s,Math.max(0,t.sets.length-1),"weight",e.nextWeight);else if(e&&"reps"===e.type&&Object.prototype.hasOwnProperty.call(e,"nextReps")&&"number"==typeof e.nextReps){var r,n,o;let a=t.sets.length-1,i=null!=(n=null==(r=t.sets[Math.max(0,a)])?void 0:r.reps)?n:0;l(s,Math.max(0,a),"reps",i+(null!=(o=e.nextReps)?o:0))}},title:F.recommendation.rationale,children:"weight"===F.recommendation.type?"Suggest: ".concat(F.recommendation.nextWeight).concat(F.recommendation.unit):"Suggest: +".concat(F.recommendation.nextReps," rep")}):null]}),(null==F?void 0:F.volumeSparkline)&&F.volumeSparkline.length>=2&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("div",{className:"flex h-8 items-end gap-1","aria-hidden":"true",children:(()=>{let e=F.volumeSparkline.map(e=>e.volume),t=Math.max(...e),s=Math.min(...e),n=Math.max(1,t-s);return F.volumeSparkline.map((e,t)=>{let l=Math.round((e.volume-s)/n*100);return(0,r.jsx)("span",{className:"w-1.5 rounded-sm bg-emerald-500/70 dark:bg-emerald-400/70",style:{height:"".concat(Math.max(8,l),"%")},title:"".concat(new Date(e.date).toLocaleDateString(),": Vol ").concat(e.volume.toFixed(0))},t)})})()})}),(null==F?void 0:F.suggestions)&&F.suggestions.length>0&&(0,r.jsx)("ul",{className:"text-muted mt-2 list-disc space-y-1 pl-5 text-xs",children:F.suggestions.slice(0,2).map((e,t)=>(0,r.jsx)("li",{children:e.message},t))})]}),w&&w.length>0&&!j&&(0,r.jsxs)("div",{className:"glass-surface glass-hairline rounded-lg p-3",children:[(0,r.jsx)("h4",{className:"text-secondary mb-2 text-xs font-medium",children:"LAST WORKOUT"}),(0,r.jsx)("div",{className:"space-y-2",children:[...w].sort((e,t)=>{var s,r;let n=null!=(s=e.weight)?s:0,l=null!=(r=t.weight)?r:0;return n!==l?l-n:w.indexOf(e)-w.indexOf(t)}).map((e,t)=>{let s=w.indexOf(e),n=0===t&&e.weight&&e.weight>0;return(0,r.jsxs)("div",{className:"flex items-center gap-3 text-sm ".concat(n?"text-green-700 dark:text-green-300":"text-gray-700 dark:text-gray-300"),children:[(0,r.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded-full text-xs ".concat(n?"bg-green-600 text-background":"bg-muted text-muted-foreground"),children:s+1}),(0,r.jsxs)("div",{className:"flex gap-4",children:[e.weight&&(0,r.jsxs)("span",{className:n?"font-medium":"",children:[e.weight,e.unit]}),e.reps&&(0,r.jsxs)("span",{children:[e.reps," reps"]}),e.sets>1&&(0,r.jsxs)("span",{children:[e.sets," sets"]}),n&&(0,r.jsx)("span",{className:"text-xs text-green-700 dark:text-green-400",children:"← Best"})]})]},s)})})]}),(0,r.jsx)(p,{exerciseIndex:s,exerciseName:t.exerciseName,templateExerciseId:t.templateExerciseId,sets:t.sets,readOnly:null!=j&&j,onUpdate:l,onToggleUnit:o,onAddSet:a,onDeleteSet:i,onMoveSet:u,preferredUnit:A})]})]})}var w=s(83960),j=s(99776),N=s(29623);let _="offline.queue.v1";function k(){return Date.now()}function S(){try{let e=window.localStorage.getItem(_);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];return t}catch(e){return[]}}function C(e){try{window.localStorage.setItem(_,JSON.stringify(e))}catch(e){console.warn("Failed to write to localStorage:",e)}}function M(){return S().length}var I=s(80842);function E(e){let{sessionId:t}=e,s=(0,o.useRouter)(),{invalidateWorkouts:l}=function(){let e=(0,j.useQueryClient)();return{invalidateWorkouts:()=>N.WG.workouts(e),invalidateTemplates:()=>N.WG.templates(e),invalidatePreferences:()=>N.WG.preferences(e),invalidateJokes:()=>N.WG.jokes(e),invalidateAll:()=>N.WG.all(e),onWorkoutStart:()=>{e.invalidateQueries({queryKey:["workouts","getRecent"]}),e.invalidateQueries({queryKey:["workouts","getLastExerciseData"]})},onWorkoutSave:()=>{N.WG.workouts(e)},optimisticWorkoutUpdate:(t,s)=>{e.setQueryData(["workouts","getRecent"],e=>e)}}}(),{exercises:a,expandedExercises:c,loading:d,isReadOnly:m,showDeleteConfirm:p,setShowDeleteConfirm:y,previousExerciseData:_,collapsedIndexes:E,saveWorkout:D,deleteWorkout:A,enqueue:R,swipeSettings:W,dragState:T,dragHandlers:P,getDisplayOrder:O,toggleExpansion:L,handleSwipeToBottom:F,updateSet:z,toggleUnit:U,addSet:B,deleteSet:V,moveSet:Q,buildSavePayload:H,session:G,preferences:q,setLastAction:Y}=function(e){let{sessionId:t}=e,[s,r]=(0,n.useState)([]),[l,o]=(0,n.useState)([0]),[a,i]=(0,n.useState)(!0),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[p,g]=(0,n.useState)(new Map),[x,h]=(0,n.useState)(!1),[v,f]=(0,n.useState)([]),[y,b]=(0,n.useState)(null),[w,j]=(0,n.useState)([]),N=I.F.useUtils(),{data:_}=I.F.workouts.getById.useQuery({id:t},{enabled:t>0}),{data:E}=I.F.preferences.get.useQuery(),D=I.F.preferences.update.useMutation(),A=e=>{D.mutate(e)},{enqueue:R}=function(){let[e,t]=(0,n.useState)(()=>M()),[s,r]=(0,n.useState)("idle"),[l,o]=(0,n.useState)(null),a=(0,n.useRef)(!1),i=I.F.useUtils(),c=I.F.workouts.save.useMutation(),d=(0,n.useCallback)(()=>{t(M())},[]),u=(0,n.useCallback)(e=>{let s=function(e){let t=S(),s={id:"q_".concat(Math.random().toString(36).slice(2),"_").concat(k().toString(36)),type:"workout_save",payload:e,attempts:0,createdAt:k(),updatedAt:k()};return t.push(s),C(t),s.id}(e);return t(e=>e+1),s},[]),m=(0,n.useCallback)(async()=>{if(!a.current){a.current=!0,r("flushing"),o(null);try{for(C(S().filter(e=>e.attempts<8));;){let r=function(){let e=S(),t=e.shift();return t&&C(e),t}();if(!r)break;if("workout_save"===r.type)try{await c.mutateAsync({sessionId:r.payload.sessionId,exercises:r.payload.exercises}),await i.workouts.getRecent.invalidate(),t(e=>Math.max(0,e-1))}catch(l){let t=l&&"object"==typeof l&&"message"in l?String(l.message):"Network or server error",n=r.attempts+1;if(!function(e,t){let s=S(),r=s.findIndex(t=>t.id===e);-1!==r&&(s[r]={...s[r],...t,updatedAt:k()},C(s))}(r.id,{attempts:n,lastError:t}),n>=8)o("Some items failed to sync after multiple attempts. See Sync Indicator for details.");else{await function(e){return new Promise(t=>setTimeout(t,e))}((e=r.attempts,Math.min(500*Math.pow(2,e),8e3)));var e,s={...r,attempts:n};let t=S();t.unshift(s),C(t)}break}}r("done")}catch(e){r("error"),o("Unexpected error while flushing queue.")}finally{a.current=!1,setTimeout(()=>r("idle"),500)}}},[c,i.workouts.getRecent]);return(0,n.useEffect)(()=>{let e=()=>{M()>0&&m()},s=e=>{"offline.queue.v1"===e.key&&t(M())};return window.addEventListener("online",e),window.addEventListener("storage",s),()=>{window.removeEventListener("online",e),window.removeEventListener("storage",s)}},[m]),{queueSize:e,status:s,lastError:l,items:(0,n.useMemo)(()=>S(),[]),enqueue:u,flush:m,refreshCount:d,isFlushing:"flushing"===s}}(),W=(0,n.useMemo)(()=>{if(!_)return;let e=_.template;if(e&&"object"==typeof e&&!Array.isArray(e))return e},[_]),T=(0,n.useMemo)(()=>{if(!W)return;let e=W.exercises;if(Array.isArray(e))return e.filter(e=>!(!e||"object"!=typeof e||Array.isArray(e))&&"number"==typeof e.id&&"string"==typeof e.exerciseName)},[W]),P=(0,n.useRef)(0),O=()=>{let e=++P.current;return"set-".concat(Date.now(),"-").concat(e,"-").concat(Math.random().toString(36).substr(2,9))},L=(0,n.useCallback)(()=>s.map((e,t)=>({exercise:e,originalIndex:t})),[s]),F=(0,n.useMemo)(()=>L(),[L]),[z,U]=function(e,t,s,r){let[l,o]=(0,n.useState)(null),[a,i]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)({x:0,y:0}),[p,g]=(0,n.useState)({x:0,y:0}),x=(0,n.useRef)(!1),h=(0,n.useRef)(0),v=(0,n.useRef)(!1),f=(0,n.useRef)(null),y=(0,n.useRef)([]),b=(0,n.useRef)(void 0),w=(0,n.useRef)(void 0),j=(0,n.useRef)(0),N=(0,n.useRef)(0),_=(0,n.useRef)(0),k=e=>{if("touches"in e){let t=e.touches;if(t&&t.length>0)return{x:t[0].clientX,y:t[0].clientY}}return"clientX"in e&&"clientY"in e?{x:e.clientX,y:e.clientY}:{x:0,y:0}},S=(0,n.useCallback)((e,t,s)=>{let r=0,n=1/0,l=0;for(let o=0;o<y.current.length;o++){let a=y.current[o];if(!a||o===s)continue;let i=a.getBoundingClientRect(),c=i.top+i.height/2,d=Math.abs(t-c);if(e>=i.left&&e<=i.right&&d<n&&(n=d,l=o),e>=i.left&&e<=i.right&&t<c)return o;e>=i.left&&e<=i.right&&(r=o+1)}if(n<1/0){let e=y.current[l];if(e){let s=e.getBoundingClientRect();return t>=s.top+s.height/2?l+1:l}}return r},[]),C=(0,n.useCallback)(e=>{let t=window.innerHeight,s=0;if(e<50?s=-Math.max(0,Math.round(6*Math.pow(Math.max(0,Math.min(1,(50-e)/50)),1.2))):e>t-50&&(s=Math.max(0,Math.round(6*Math.pow(Math.max(0,Math.min(1,(e-(t-50))/50)),1.2)))),j.current=s,0===s||w.current)0===s&&w.current&&(cancelAnimationFrame(w.current),w.current=void 0);else{let e=()=>{0!==j.current?(window.scrollBy(0,j.current),_.current=window.scrollY,w.current=requestAnimationFrame(e)):w.current=void 0};w.current=requestAnimationFrame(e)}},[]),M=(0,n.useCallback)(()=>{j.current=0,w.current&&(cancelAnimationFrame(w.current),w.current=void 0)},[]),I=(0,n.useCallback)((e,t)=>r=>{let n=r.target,l=!!n.closest('[data-drag-handle="true"]');console.log("[useUniversalDragReorder] onPointerDown called",{index:e,isHandle:l,targetTag:n.tagName,opts:t});let a=r.currentTarget;if(a){let e=e=>{try{e.preventDefault()}catch(e){}};a.addEventListener("touchmove",e,{passive:!1,once:!0}),a.addEventListener("pointermove",e,{passive:!1,once:!0}),a.addEventListener("mousemove",e,{passive:!1,once:!0})}if(!l&&(n.closest("button")||n.closest("input")||n.closest("select")))return;let i=r.currentTarget;if("pointerId"in r&&i&&"function"==typeof i.setPointerCapture)try{i.setPointerCapture(r.pointerId)}catch(e){}g(k(r)),o(e),h.current=Date.now(),v.current=!1,f.current=null,l||(null==t?void 0:t.force)?(x.current=!0,v.current=!0,d(!0),null==s||s(e)):x.current=!1,N.current=window.scrollY,_.current=window.scrollY},[s]),E=(0,n.useCallback)(e=>{if(null===l)return;let t=k(e),r=t.x-p.x,n=t.y-p.y,o=Math.abs(r),c=Math.abs(n),u=Math.sqrt(r*r+n*n);if(!x.current){if(u<14||!(c>=.75*o))return;v.current=!0,x.current=!0,d(!0),null==s||s(l)}x.current&&v.current&&(console.log("[useUniversalDragReorder] onPointerMove - drag active",{draggedIndex:l,deltaX:r,deltaY:n,distance:u,dragOverIndex:a}),b.current&&cancelAnimationFrame(b.current),b.current=requestAnimationFrame(()=>{_.current=window.scrollY;let e=n+(_.current-N.current);if(m({x:0,y:e}),C(t.y),Math.abs(e)%8<4){let e=S(t.x,t.y,l);if(null===f.current||e!==f.current){let s=!0;if(null!==f.current){let e=y.current[Math.min(Math.max(f.current,0),y.current.length-1)];if(e){let r=e.getBoundingClientRect(),n=r.top+r.height/2;14>Math.abs(t.y-n)&&(s=!1)}}s&&(f.current=e,i(e))}}}))},[l,p,a,S,s,C]),D=(0,n.useCallback)(s=>{if(null!==l){if(x.current&&null!==a&&a!==l){console.log("[useUniversalDragReorder] onPointerUp - performing reorder",{draggedIndex:l,dragOverIndex:a});let s=[...e],r=s[l];if(r){s.splice(l,1);let e=a>l?a-1:a;s.splice(e,0,r),console.log("[useUniversalDragReorder] onReorder called with newItems",s.map(e=>{var t;return null!=(t=e.identity)?t:e.originalIndex})),t(s)}}console.log("[useUniversalDragReorder] onPointerUp - resetting state"),o(null),i(null),d(!1),m({x:0,y:0}),g({x:0,y:0}),x.current=!1,b.current&&(cancelAnimationFrame(b.current),b.current=void 0),M()}},[l,a,e,t,void 0,M]);return(0,n.useEffect)(()=>{if(null===l)return;let e=e=>{E(e)},t=e=>{D(e)};return document.addEventListener("pointermove",e,{passive:!1}),document.addEventListener("pointerup",t,{passive:!1}),document.addEventListener("mousemove",e,{passive:!1}),document.addEventListener("mouseup",t,{passive:!1}),document.addEventListener("touchmove",e,{passive:!1}),document.addEventListener("touchend",t,{passive:!1}),()=>{document.removeEventListener("pointermove",e),document.removeEventListener("pointerup",t),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.removeEventListener("touchmove",e),document.removeEventListener("touchend",t)}},[l,E,D]),[{draggedIndex:l,dragOverIndex:a,isDragging:c,dragOffset:u,dragStartPos:p},{onPointerDown:I,onPointerMove:E,onPointerUp:D,setCardElement:(0,n.useCallback)((e,t)=>{y.current[e]=t},[])}]}(F,e=>{let t=s.map(e=>({name:e.exerciseName,templateExerciseId:e.templateExerciseId})),n=e.map(e=>e.exercise);r(n),b({type:"dragReorder",previousOrder:t});let a=e=>{var t;return null!=(t=e.templateExerciseId)?t:"name:".concat(e.exerciseName)},i=new Set(v.map(e=>s[e]).filter(Boolean).map(e=>a(e))),c=[];n.forEach((e,t)=>{i.has(a(e))&&c.push(t)}),f(c),o(l.map(e=>{var t;let r=null==(t=s[e])?void 0:t.templateExerciseId;return n.findIndex(e=>e.templateExerciseId===r)}).filter(e=>-1!==e))},e=>{var t;let s=null==(t=F[e])?void 0:t.originalIndex;void 0!==s&&o(e=>e.filter(e=>e!==s))}),B=I.F.workouts.save.useMutation({onMutate:async e=>{await N.workouts.getRecent.cancel();let s=N.workouts.getRecent.getData({limit:5});if(_&&W){var r,n,l;let s={id:t,user_id:_.user_id,templateId:_.templateId,workoutDate:_.workoutDate,theme_used:null!=(r=_.theme_used)?r:null,device_type:null!=(n=_.device_type)?n:null,perf_metrics:null!=(l=_.perf_metrics)?l:null,createdAt:new Date,updatedAt:new Date,template:W,exercises:e.exercises.flatMap((e,s)=>e.sets.map((r,n)=>{var l,o,a,i;return{id:-(100*s+n),user_id:_.user_id,sessionId:t,templateExerciseId:null!=(l=e.templateExerciseId)?l:null,exerciseName:e.exerciseName,setOrder:n,weight:null!=(o=r.weight)?o:null,reps:null!=(a=r.reps)?a:null,sets:null!=(i=r.sets)?i:null,unit:r.unit,rpe:null,rest_seconds:null,is_estimate:!1,is_default_applied:!1,one_rm_estimate:null,volume_load:null,createdAt:new Date}}))};N.workouts.getRecent.setData({limit:5},e=>e?[s,...e.slice(0,4)]:[s])}return{previousWorkouts:s}},onError:(e,t,s)=>{(null==s?void 0:s.previousWorkouts)&&N.workouts.getRecent.setData({limit:5},s.previousWorkouts)},onSettled:()=>{N.workouts.getRecent.invalidate()}}),V=I.F.workouts.delete.useMutation({retry:!1,onMutate:async e=>{await N.workouts.getRecent.cancel();let t=N.workouts.getRecent.getData({limit:5}),s=e.id;return N.workouts.getRecent.setData({limit:5},e=>e?e.filter(e=>e.id!==s):[]),{previousWorkouts:t}},onSuccess:()=>{console.log("Workout deleted successfully")},onError:(e,t,s)=>{if(console.error("Failed to delete workout:",e.message),"Workout session not found"===e.message)return void console.log("Workout not found in database - likely an unsaved session, treating as successful deletion");(null==s?void 0:s.previousWorkouts)&&N.workouts.getRecent.setData({limit:5},s.previousWorkouts)},onSettled:()=>{N.workouts.getRecent.invalidate()}});(0,n.useEffect)(()=>{if(!T||c)return void h(!0);(async()=>{let e=new Map;for(let s of T)try{let r=await N.workouts.getLastExerciseData.fetch({exerciseName:s.exerciseName,excludeSessionId:t,templateExerciseId:s.id});r&&e.set(s.exerciseName,r)}catch(e){}g(e),h(!0)})()},[T,c,N.workouts.getLastExerciseData,t]),(0,n.useEffect)(()=>{if(T&&x){if(Array.isArray(null==_?void 0:_.exercises)&&_.exercises.length>0){let e=new Map;_.exercises.forEach(t=>{let s=t.exerciseName;e.has(s)||e.set(s,[]),e.get(s).push(t)});let t=Array.from(e.entries()).map(e=>{var t,s,r,n;let[l,o]=e;return o.sort((e,t)=>{var s,r;return(null!=(s=e.setOrder)?s:0)-(null!=(r=t.setOrder)?r:0)}),{templateExerciseId:null!=(r=null==(t=o[0])?void 0:t.templateExerciseId)?r:void 0,exerciseName:l,sets:o.map(e=>{var t,s,r;return{id:"existing-".concat(e.id),weight:e.weight?Number(e.weight):void 0,reps:null!=(t=e.reps)?t:void 0,sets:null!=(s=e.sets)?s:1,unit:null!=(r=e.unit)?r:"kg"}}),unit:null!=(n=null==(s=o[0])?void 0:s.unit)?n:"kg"}});r(t),d(!0),o(t.map((e,t)=>t))}else r(T.map(e=>{var t;let s=p.get(e.exerciseName),r=null!=(t=null==E?void 0:E.defaultWeightUnit)?t:"kg",n=[];return n=(null==s?void 0:s.sets)?s.sets.map(e=>({id:O(),weight:e.weight,reps:e.reps,sets:e.sets,unit:e.unit})):[{id:O(),weight:void 0,reps:void 0,sets:1,unit:r}],{templateExerciseId:e.id,exerciseName:e.exerciseName,sets:n,unit:r}})),d(!1);i(!1)}},[T,null==_?void 0:_.exercises,null==E?void 0:E.defaultWeightUnit,p,x,_]);let Q=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];console.log("[WorkoutSessionState]",...t)},H=(0,n.useRef)(!1),G=(0,n.useRef)(!1),q=(0,n.useRef)(!1),Y=(0,n.useRef)(null),X=(0,n.useRef)(null),J=(e,t,n,l)=>{var o,a;Q("updateSet:start",{exerciseIndex:e,setIndex:t,field:n,value:l,len:null==(o=s[e])?void 0:o.sets.length});let i=[...s],c=null==(a=i[e])?void 0:a.sets[t];if(c){let s={[n]:c[n]};c[n]=l;let o={[n]:l};r(i),Q("updateSet:applied",{exerciseIndex:e,setIndex:t,field:n,before:s,after:o}),b({type:"editSetFields",exerciseIndex:e,setIndex:t,before:s,after:o}),j([])}};return{exercises:s,setExercises:r,expandedExercises:l,setExpandedExercises:o,loading:a,isReadOnly:c,showDeleteConfirm:u,setShowDeleteConfirm:m,previousExerciseData:p,collapsedIndexes:v,utils:N,preferences:E,saveWorkout:B,deleteWorkout:V,enqueue:R,swipeSettings:{dismissThreshold:140,velocityThreshold:4,friction:.88,minimumVelocity:.15},dragState:z,dragHandlers:U,getDisplayOrder:L,toggleExpansion:e=>{var t;let r=s[e];if(!r)return;let n=l.includes(e);o(t=>n?t.filter(t=>t!==e):[...t,e]),b({type:"toggleCollapse",exerciseId:(null!=(t=r.templateExerciseId)?t:"name:".concat(r.exerciseName)).toString(),previousExpanded:n})},handleSwipeToBottom:e=>{r(t=>{var s;if(e<0||e>=t.length)return t;let r=[...t],[n]=r.splice(e,1);if(!n)return t;let l=r.length;return r.push(n),b({type:"swipeToEnd",exerciseId:(null!=(s=n.templateExerciseId)?s:"name:".concat(n.exerciseName)).toString(),fromIndex:e,toIndex:l}),r}),f(t=>[...t.filter(t=>t!==e),-1]),o(t=>t.filter(t=>t!==e))},updateSet:J,toggleUnit:(e,t)=>{var r,n,l;let o=null!=(l=null==(n=s[e])||null==(r=n.sets[t])?void 0:r.unit)?l:"kg",a="kg"===o?"lbs":"kg";b({type:"toggleUnit",exerciseIndex:e,setIndex:t,previousUnit:o}),j([]),J(e,t,"unit",a),A({defaultWeightUnit:a})},addSet:e=>{if(H.current)return void Q("addSet:suppressedDuplicate",{exerciseIndex:e});H.current=!0,Q("addSet:start",{exerciseIndex:e});let t=O();r(s=>{var r,n;let l,o;if(Y.current===t)return Q("addSet:suppressedDuplicateId",{exerciseIndex:e,newId:t}),s;let a=[...s],i=a[e];if(!i)return H.current=!1,s;if(i.sets.some(e=>e.id===t))return Q("addSet:suppressedExistingId",{exerciseIndex:e,newId:t}),s;let c=i.sets[i.sets.length-1],d=(null==E?void 0:E.predictive_defaults_enabled)===!0,u=1,m=null!=(r=null==c?void 0:c.unit)?r:i.unit;if(d){let e=[...i.sets].reverse().find(e=>{var t,s;return(null!=(s=null!=(t=e.weight)?t:e.reps)?s:e.sets)!==void 0});e&&(l=e.weight,o=e.reps,u=null!=(n=e.sets)?n:1)}let p={id:t,weight:l,reps:o,sets:u,unit:m},g=i.sets.map(e=>e.id);i.sets=[...i.sets,p];let x=i.sets.map(e=>e.id);return Y.current=t,Q("addSet:added",{exerciseIndex:e,newId:t,beforeIds:g,afterIds:x,totalSets:i.sets.length}),a}),b({type:"addSet",exerciseIndex:e,newSetId:t}),j([]),H.current=!1},deleteSet:(e,t)=>{var n;if(G.current)return void Q("deleteSet:suppressedDuplicate",{exerciseIndex:e,setIndex:t});G.current=!0,Q("deleteSet:click",{exerciseIndex:e,setIndex:t,lenBefore:null==(n=s[e])?void 0:n.sets.length});let l="delete-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),o=null,a=-1;r(s=>{if(X.current===l)return Q("deleteSet:suppressedDuplicateOperation",{exerciseIndex:e,setIndex:t,operationId:l}),s;let r=[...s],n=r[e];if(!n)return Q("deleteSet:exerciseNotFound",{exerciseIndex:e}),G.current=!1,s;if(0===n.sets.length)return Q("deleteSet:noSets",{exerciseIndex:e}),G.current=!1,s;a=Math.max(0,Math.min(t,n.sets.length-1));let i=n.sets[a];if(!i)return Q("deleteSet:setNotFound",{exerciseIndex:e,setIndex:t}),G.current=!1,s;X.current=l,o=i;let c=n.sets.map(e=>e.id);n.sets=n.sets.filter((e,t)=>t!==a);let d=n.sets.map(e=>e.id);return Q("deleteSet:removed",{exerciseIndex:e,setIndex:a,removedId:i.id,beforeIds:c,afterIds:d,lenAfter:n.sets.length}),r}),o&&-1!==a&&(b({type:"deleteSet",exerciseIndex:e,deletedSet:{index:a,data:o}}),j([])),G.current=!1},moveSet:(e,t,s)=>{let n="".concat(e,"-").concat(t,"-").concat(s);if(console.log("[moveSet] Called with:",{exerciseIndex:e,setIndex:t,direction:s,operationKey:n}),q.current)return void console.log("[moveSet] Operation already in progress, skipping");q.current=!0,console.log("[moveSet] Starting move operation",{exerciseIndex:e,setIndex:t,direction:s}),setTimeout(()=>{q.current=!1},100),r(r=>{var n;let l=[...r],o=l[e];if(!(null==o||null==(n=o.sets)?void 0:n[t]))return q.current=!1,r;let a="up"===s?t-1:t+1;if(a<0||a>=o.sets.length)return console.log("[moveSet] Move out of bounds, skipping"),q.current=!1,r;let i=[...o.sets],c=i[t],d=i[a];if(!c||!d)return console.log("[moveSet] Invalid sets for swap, skipping"),q.current=!1,r;i[t]={...d},i[a]={...c},l[e]={...o,sets:i},console.log("[moveSet] Successfully moved set",s,{from:t,to:a}),b({type:"editSetFields",exerciseIndex:e,setIndex:a,before:{},after:{}}),j([]);let u={sessionId:(null==_?void 0:_.id)||0,exercises:l.map(e=>({...e,sets:e.sets.filter(e=>void 0!==e.weight||void 0!==e.reps||void 0!==e.sets).map(e=>({...e,unit:e.unit||"kg"}))})).filter(e=>e.sets.length>0)};return console.log("[moveSet] Enqueuing save after move"),R(u),Q("moveSet:applied",{exerciseIndex:e,setIndex:t,direction:s,newIndex:a}),l})},buildSavePayload:()=>({sessionId:t,exercises:s.map(e=>({...e,sets:e.sets.filter(e=>void 0!==e.weight||void 0!==e.reps||e.sets&&e.sets>0).map(e=>{var t;return{...e,id:null!=(t=e.id)?t:"offline-".concat(Math.random().toString(36).slice(2)),weight:null===e.weight?void 0:e.weight,reps:null===e.reps?void 0:e.reps,sets:null===e.sets?1:e.sets}})})).filter(e=>e.sets.length>0)}),updatePreferences:A,session:_,lastAction:y,setLastAction:b,redoLastUndo:()=>{let e=w[0];e&&(j(w.slice(1)),"swipeToEnd"===e.type?r(t=>{let s=t.findIndex(t=>{var s;return(null!=(s=t.templateExerciseId)?s:"name:".concat(t.exerciseName)).toString()===e.exerciseId});if(-1===s)return t;let r=[...t],[n]=r.splice(s,1);return r.push(n),r}):"toggleCollapse"===e.type?o(t=>{let r=s.findIndex(t=>{var s;return(null!=(s=t.templateExerciseId)?s:"name:".concat(t.exerciseName)).toString()===e.exerciseId});if(-1===r)return t;let n=t.includes(r);return e.previousExpanded?t.filter(e=>e!==r):n?t:[...t,r]}):"dragReorder"===e.type||("addSet"===e.type?r(t=>{let s=[...t],r=s[e.exerciseIndex];return r?(r.sets.find(t=>t.id===e.newSetId)||r.sets.push({id:e.newSetId,unit:r.unit,sets:1}),s):t}):"deleteSet"===e.type?r(t=>{let s=[...t],r=s[e.exerciseIndex];if(!r)return t;let n=r.sets.findIndex(t=>t.id===e.deletedSet.data.id);return -1!==n&&r.sets.splice(n,1),s}):"toggleUnit"===e.type?r(t=>{let s=[...t];if("toggleUnit"!==e.type)return t;let r=s[e.exerciseIndex];if(!r)return t;let n=r.sets[e.setIndex];return n?(n.unit="kg"===e.previousUnit?"lbs":"kg",s):t}):"editSetFields"===e.type&&r(t=>{let s=[...t];if("editSetFields"!==e.type)return t;let r=s[e.exerciseIndex];if(!r)return t;let n=r.sets[e.setIndex];return n?(Object.assign(n,e.after),s):t})))},redoStack:w,undoLastAction:()=>{y&&(j(e=>[y,...e].slice(0,30)),"swipeToEnd"===y.type?(r(e=>{let t=e.findIndex(e=>{var t;return(null!=(t=e.templateExerciseId)?t:"name:".concat(e.exerciseName)).toString()===y.exerciseId});if(-1===t)return e;let s=[...e],[r]=s.splice(t,1);return s.splice(y.fromIndex,0,r),s}),f(e=>e.filter(e=>-1!==e))):"toggleCollapse"===y.type?o(e=>{let t=s.findIndex(e=>{var t;return(null!=(t=e.templateExerciseId)?t:"name:".concat(e.exerciseName)).toString()===y.exerciseId});if(-1===t)return e;let r=e.includes(t);return y.previousExpanded&&!r?[...e,t]:!y.previousExpanded&&r?e.filter(e=>e!==t):e}):"dragReorder"===y.type?r(e=>{let t=e=>{var t;return(null!=(t=e.templateExerciseId)?t:"name:".concat(e.exerciseName)).toString()},s=new Map(e.map(e=>[t(e),e])),r=[];for(let e of y.previousOrder){var n;let t=(null!=(n=e.templateExerciseId)?n:"name:".concat(e.name)).toString(),l=s.get(t);l&&r.push(l)}for(let s of e){let e=t(s);r.find(s=>t(s)===e)||r.push(s)}return r}):"addSet"===y.type?r(e=>{let t=[...e],s=t[y.exerciseIndex];if(!s)return e;let r=s.sets.findIndex(e=>e.id===y.newSetId);return -1!==r&&s.sets.splice(r,1),t}):"deleteSet"===y.type?r(e=>{let t=[...e],s=t[y.exerciseIndex];if(!s)return e;let r=Math.min(Math.max(0,y.deletedSet.index),s.sets.length);return s.sets.splice(r,0,y.deletedSet.data),t}):"toggleUnit"===y.type?r(e=>{let t=[...e];if("toggleUnit"!==y.type)return e;let s=t[y.exerciseIndex];if(!s)return e;let r=s.sets[y.setIndex];return r?(r.unit=y.previousUnit,t):e}):"editSetFields"===y.type&&r(e=>{let t=[...e],s=t[y.exerciseIndex];if(!s)return e;let r=s.sets[y.setIndex];return r?(Object.assign(r,y.before),t):e}),b(null))}}}({sessionId:t}),[X,J]=(0,n.useState)(0),[Z,K]=(0,n.useState)(!1),$=v();f($);let{restoreFocus:ee}=(0,w.G)();(0,n.useEffect)(()=>{let e=()=>J(window.scrollY||0);return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[]);let et=O(),es=et.length,er=es>=20,en=window.innerHeight,el=er?Math.max(0,Math.floor(X/120)-6):0,eo=er?Math.min(es-1,Math.ceil((X+en)/120)+6):es-1,ea=()=>{K(!1)},ei=e=>{try{h(e)}catch(e){}},ec=async()=>{let e=[];if(a.forEach((t,s)=>{t.sets.forEach((s,r)=>{(void 0!==s.weight||void 0!==s.reps||s.sets&&s.sets>0)&&(void 0!==s.weight&&(null===s.weight||isNaN(s.weight))&&e.push("".concat(t.exerciseName,", Set ").concat(r+1,": Weight must be a valid number")),void 0!==s.reps&&(null===s.reps||isNaN(s.reps)||s.reps<=0)&&e.push("".concat(t.exerciseName,", Set ").concat(r+1,": Reps must be a valid positive number")),void 0!==s.sets&&(null===s.sets||isNaN(s.sets)||s.sets<=0)&&e.push("".concat(t.exerciseName,", Set ").concat(r+1,": Sets must be a valid positive number")))})}),e.length>0)return void console.error("Validation errors:",e);try{let e=H();if("undefined"!=typeof navigator&&!1===navigator.onLine)return void R(e);await D.mutateAsync(e)}catch(s){console.error("Error saving workout:",s),u.z.error(s,{context:"workout_save",sessionId:(null==t?void 0:t.toString())||"unknown"});let e=s&&"object"==typeof s&&"message"in s?String(s.message):"";if(e.includes("Failed to fetch")||e.includes("NetworkError")||e.includes("TypeError"))return void R(H());e.includes("Expected number, received null")||e.includes("invalid_type")?console.error("Validation error:",e):console.error("Error saving workout:",e||"Unknown error")}},ed=async()=>{if(A.isPending)return void console.log("Delete already in progress, ignoring duplicate call");if(!t||"number"!=typeof t){console.error("Invalid sessionId for workout deletion:",t),alert("Cannot delete workout: invalid session ID");return}try{console.log("Attempting to delete workout session:",t),await A.mutateAsync({id:t}),console.log("Workout deletion completed successfully"),y(!1),s.push("/")}catch(e){console.error("Unexpected error during workout deletion:",e),u.z.error(e,{context:"workout_delete",sessionId:(null==t?void 0:t.toString())||"unknown"}),y(!1),s.push("/")}};return d||!G?(0,r.jsx)("div",{className:"space-y-3 sm:space-y-4",children:[void 0,void 0,void 0].map((e,t)=>(0,r.jsxs)("div",{className:"animate-pulse rounded-lg p-3 sm:p-4",style:{backgroundColor:"var(--color-bg-surface)"},children:[(0,r.jsx)("div",{className:"mb-3 h-3 w-1/2 rounded sm:mb-4 sm:h-4",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[(0,r.jsx)("div",{className:"h-8 rounded sm:h-10",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsx)("div",{className:"h-8 rounded sm:h-10",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsx)("div",{className:"h-8 rounded sm:h-10",style:{backgroundColor:"var(--color-border)"}})]})]},t))}):(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[!m&&a.length>0&&(0,r.jsxs)("div",{className:"text-muted mb-2 px-2 text-center text-xs sm:text-sm",children:["\uD83D\uDCA1 ",(0,r.jsx)("strong",{children:"Tip:"})," Swipe ← → to move to bottom • Drag ↕ to reorder & move between sections • Works on mobile & desktop"]}),(er?et.slice(el,eo+1).map((e,t)=>({...e,windowIndex:el+t})):et.map((e,t)=>({...e,windowIndex:t}))).map(e=>{var t,s,n,l;let{exercise:o,originalIndex:a,windowIndex:i}=e,d=E.includes(i),u=!d&&c.includes(a);return(0,r.jsx)("div",{style:er?{minHeight:0}:void 0,children:(0,r.jsx)(b,{exercise:o,exerciseIndex:a,onUpdate:z,onToggleUnit:U,onAddSet:B,onDeleteSet:V,onMoveSet:Q,isExpanded:u,onToggleExpansion:L,previousBest:null==(t=_.get(o.exerciseName))?void 0:t.best,previousSets:null==(s=_.get(o.exerciseName))?void 0:s.sets,readOnly:m,onSwipeToBottom:F,swipeSettings:W,isSwiped:d,draggable:!m,isDraggedOver:T.dragOverIndex===i||T.dragOverIndex===i+1,isDragging:T.isDragging&&T.draggedIndex===i,dragOffset:T.dragOffset,onPointerDown:P.onPointerDown(i),setCardElement:e=>{var t;return null==(t=P.setCardElement)?void 0:t.call(P,i,e)},preferredUnit:null!=(n=null==q?void 0:q.defaultWeightUnit)?n:"kg"})},null!=(l=o.templateExerciseId)?l:a)}),0===a.length&&(0,r.jsx)("div",{className:"py-6 text-center sm:py-8",children:(0,r.jsx)("p",{className:"text-secondary text-sm sm:text-base",children:"No exercises in this template"})}),!m&&(0,r.jsx)("div",{className:"sticky bottom-2 z-50 pt-4 sm:bottom-4 sm:pt-6",role:"region","aria-label":"Workout actions",children:(0,r.jsxs)("div",{className:"glass-surface glass-hairline rounded-xl p-2 shadow-lg sm:p-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-1 sm:gap-2",children:[(0,r.jsx)("button",{onClick:e=>{var t;if(e.preventDefault(),e.stopPropagation(),null==(t=e.nativeEvent)?void 0:t._addSetHandled)return;e.nativeEvent._addSetHandled=!0;let s=void 0!==c[0]?c[0]:0;if("number"==typeof s){B(s),Y(null),ei(10);try{g.Ay.capture("haptic_action",{kind:"add_set"})}catch(e){}try{$("Set added",{assertive:!1})}catch(e){}try{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})}catch(e){}}},onPointerDown:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),onTouchStart:e=>e.stopPropagation(),className:"btn-secondary py-2 text-sm sm:py-3 sm:text-base","aria-label":"Add set to current exercise",children:"Add Set"}),(0,r.jsx)("button",{onClick:async()=>{try{var e,t;let s=function(){if("undefined"==typeof document)return null;try{return document.documentElement.dataset.theme||null}catch(e){return null}}(),r=function(){if("undefined"==typeof navigator)return"unknown";if(window.opera)return"other";let e=navigator.userAgent||navigator.vendor||"";return"undefined"!=typeof document&&/Macintosh/i.test(e)&&document.ontouchend||/iPad/i.test(e)?"ipad":/iPod|iPhone/i.test(e)?"ios":/Android/i.test(e)?"android":/Windows|Macintosh|Linux/i.test(e)||/CrOS/i.test(e)||/X11/i.test(e)?"desktop":navigator.vendor&&/(Apple|Google|Microsoft|Opera)/i.test(navigator.vendor)?"other":"unknown"}(),n=function(){try{let{tti:e,tbt:t}=function(){if("undefined"==typeof performance)return{};try{let e,t,s=performance.getEntriesByType("navigation"),r=performance.getEntriesByType("paint"),n=s[0],l=r.find(e=>"first-contentful-paint"===e.name);if(e=n&&l?l.startTime+100:n?n.domContentLoadedEventEnd:performance.now(),n){let e=n.loadEventEnd-n.loadEventStart;t=Math.max(0,e-50)}else t=0;return{tti:e,tbt:t}}catch(e){return{}}}(),s=function(){let e=[...x];if(0===e.length)return{samples:[]};let t=e.reduce((e,t)=>e+t,0)/e.length,s=function(e){if(0===e.length)return;let t=[...e].sort((e,t)=>e-t),s=Math.floor(.95*t.length);return t[s]}(e);return{samples:e,avg:t,p95:s}}();return{tti:e,tbt:t,inputLatency:{avg:s.avg,p95:s.p95},ts:Date.now()}}catch(e){return{ts:Date.now()}}}();g.Ay.capture("workout_save",{theme_used:s,device_type:r,tti:n.tti,tbt:n.tbt,input_latency_avg:null==(e=n.inputLatency)?void 0:e.avg,input_latency_p95:null==(t=n.inputLatency)?void 0:t.p95})}catch(e){}await ec(),ei([10,30,10]);try{g.Ay.capture("haptic_action",{kind:"save"})}catch(e){}try{$("Workout saved",{assertive:!0})}catch(e){}},disabled:D.isPending,className:"btn-secondary py-2 text-sm disabled:opacity-50 sm:py-3 sm:text-base","aria-busy":D.isPending?"true":"false","aria-label":"Save workout",children:D.isPending?"Saving…":"Save"}),(0,r.jsx)("button",{onClick:()=>{K(!0),ei(10);try{g.Ay.capture("haptic_action",{kind:"save"})}catch(e){}},className:"btn-primary py-2 text-sm sm:py-3 sm:text-base",children:"Complete"})]}),(0,r.jsxs)("div",{className:"mt-1.5 text-center sm:mt-2",children:[(0,r.jsx)("button",{onClick:()=>{y(!0),Y(null),ei(10)},disabled:A.isPending,className:"btn-destructive px-3 py-1.5 text-xs font-semibold disabled:opacity-50 sm:px-4 sm:py-2 sm:text-sm","aria-describedby":"delete-workout-help",children:A.isPending?"Deleting…":"Delete Workout"}),(0,r.jsx)("span",{id:"delete-workout-help",className:"sr-only",children:"Opens a confirmation dialog"})]})]})}),m&&(0,r.jsxs)("div",{className:"sticky bottom-4 space-y-2 pt-6 sm:space-y-3",children:[(0,r.jsx)(i(),{href:"/workout/start?templateId=".concat(null==G?void 0:G.templateId),className:"btn-primary block w-full py-2.5 text-center text-base font-medium sm:py-3 sm:text-lg",children:"Repeat This Workout"}),(0,r.jsx)("button",{onClick:()=>y(!0),disabled:A.isPending,className:"btn-destructive w-full py-2.5 text-base font-medium disabled:opacity-50 sm:py-3 sm:text-lg",children:A.isPending?"Deleting...":"Delete Workout"}),(0,r.jsx)("button",{onClick:()=>s.back(),className:"btn-secondary w-full py-2.5 text-base font-medium sm:py-3 sm:text-lg",children:"Back to History"})]}),p&&(0,r.jsx)("div",{className:"bg-opacity-75 bg-background fixed inset-0 z-[9999] flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"delete-workout-title","aria-describedby":"delete-workout-desc",onClick:()=>{ee(),y(!1)},children:(0,r.jsx)(w.s,{onEscape:()=>{ee(),y(!1)},preventScroll:!0,children:(0,r.jsxs)("div",{className:"card w-full max-w-md p-4 shadow-2xl sm:p-6",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h3",{id:"delete-workout-title",className:"mb-3 text-lg font-bold sm:mb-4 sm:text-xl",style:{color:"var(--color-danger)"},children:"Delete Workout"}),(0,r.jsxs)("p",{id:"delete-workout-desc",className:"text-secondary mb-4 text-sm leading-relaxed sm:mb-6 sm:text-base",children:["Are you sure you want to delete this workout?",(0,r.jsx)("br",{}),(0,r.jsx)("strong",{style:{color:"var(--color-danger)"},children:"This action cannot be undone."})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:()=>{ee(),y(!1)},className:"btn-secondary flex-1 py-2.5 text-sm font-medium sm:py-3 sm:text-base",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{ee(),y(!1),ed()},disabled:A.isPending,className:"btn-destructive flex-1 py-2.5 text-sm font-medium disabled:opacity-50 sm:py-3 sm:text-base",children:A.isPending?"Deleting...":"Yes, Delete"})]})]})})}),Z&&(0,r.jsx)("div",{className:"bg-opacity-75 bg-background fixed inset-0 z-[9999] flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"complete-workout-title","aria-describedby":"complete-workout-desc",onClick:()=>{ee(),ea()},children:(0,r.jsx)(w.s,{onEscape:()=>{ee(),ea()},preventScroll:!0,children:(0,r.jsxs)("div",{className:"card w-full max-w-lg p-4 shadow-2xl sm:p-6",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("h3",{id:"complete-workout-title",className:"mb-1 text-lg font-bold sm:text-xl",style:{color:"var(--color-primary)"},children:"Complete Workout"}),(0,r.jsx)("p",{id:"complete-workout-desc",className:"text-secondary mb-3 text-xs sm:mb-4 sm:text-sm",children:"Review your performance compared to your previous best for each exercise."}),(0,r.jsx)("div",{className:"max-h-[50vh] overflow-y-auto pr-1",children:(0,r.jsx)("div",{className:"space-y-3",children:a.map((e,t)=>{var s,n,l,o,a,i,c,d,u,m,p,g,x,h,v,f;let y=(e=>{if(!e.sets||0===e.sets.length)return{};let t=Math.max(...e.sets.map(e=>{var t;return null!=(t=e.weight)?t:0})),s=e.sets.filter(e=>{var s;return(null!=(s=e.weight)?s:0)===t}).sort((e,t)=>{var s,r;return(null!=(s=t.reps)?s:0)-(null!=(r=e.reps)?r:0)})[0],r=e.sets.map(e=>{var t,s;return{...e,volume:(null!=(t=e.weight)?t:0)*(null!=(s=e.reps)?s:0)}}).filter(e=>e.volume&&e.volume>0).sort((e,t)=>t.volume-e.volume)[0];return{bestWeight:(null==s?void 0:s.weight)?{weight:s.weight,reps:s.reps,sets:s.sets,unit:s.unit}:void 0,bestVolume:r?{volume:r.volume,weight:r.weight,reps:r.reps,unit:r.unit}:void 0}})(e),b=null==(s=_.get(e.exerciseName))?void 0:s.best,w=(null!=(u=null==(n=y.bestWeight)?void 0:n.weight)?u:0)-(null!=(m=null==b?void 0:b.weight)?m:0),j=y.bestWeight&&b?w>0?{color:"var(--color-success)"}:w<0?{color:"var(--color-danger)"}:{color:"var(--color-text-muted)"}:{color:"var(--color-text-muted)"},N=null!=(p=null==(l=y.bestVolume)?void 0:l.volume)?p:0,k=N-(null!=(g=null==b?void 0:b.weight)?g:0)*(null!=(x=null==b?void 0:b.reps)?x:0),S=N&&b?k>0?{color:"var(--color-success)"}:k<0?{color:"var(--color-danger)"}:{color:"var(--color-text-muted)"}:{color:"var(--color-text-muted)"},C=(e,t,s)=>e?"".concat(e).concat(null!=s?s:"kg").concat(t?" \xd7 ".concat(t):""):"N/A";return(0,r.jsxs)("div",{className:"card p-3",children:[(0,r.jsx)("div",{className:"mb-2 text-sm font-semibold",children:e.exerciseName}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-muted mb-1 text-xs",children:"Previous Best"}),(0,r.jsxs)("div",{children:["Weight:"," ",C(null==b?void 0:b.weight,null==b?void 0:b.reps,null==b?void 0:b.unit)]}),(0,r.jsxs)("div",{children:["Volume:"," ",b?(null!=(h=b.weight)?h:0)*(null!=(v=b.reps)?v:0):"N/A"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-muted mb-1 text-xs",children:"Current Best"}),(0,r.jsxs)("div",{style:j,children:["Weight:"," ",C(null==(o=y.bestWeight)?void 0:o.weight,null==(a=y.bestWeight)?void 0:a.reps,null==(i=y.bestWeight)?void 0:i.unit),b&&(null==(c=y.bestWeight)?void 0:c.weight)!==void 0?(0,r.jsx)("span",{className:"ml-2 text-xs opacity-80",children:w>0?"(+".concat(w,")"):w<0?"(".concat(w,")"):"(=)"}):null]}),(0,r.jsxs)("div",{style:S,children:["Volume: ",null!=(f=null==(d=y.bestVolume)?void 0:d.volume)?f:"N/A",b?(0,r.jsx)("span",{className:"ml-2 text-xs opacity-80",children:k>0?"(+".concat(k,")"):k<0?"(".concat(k,")"):"(=)"}):null]})]})]})]},"".concat(e.exerciseName,"-").concat(t))})})}),(0,r.jsxs)("div",{className:"mt-4 flex items-center gap-3 sm:mt-5",children:[(0,r.jsx)("button",{onClick:async()=>{ea(),await ec(),s.push("/")},className:"btn-primary flex-1 py-2.5 text-base font-semibold sm:py-3 sm:text-lg",children:"Complete Workout"}),(0,r.jsx)("button",{onClick:ea,className:"btn-secondary flex-1 py-2.5 text-base font-medium sm:py-3 sm:text-lg",children:"Continue Workout"})]})]})})})]})}var D=s(86948);function A(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}function R(e){let{rho:t,flags:s,overloadMultiplier:n}=e,l=Math.round(100*t),o=t>=.8?"high":t>=.6?"medium":t>=.35?"low":"very-low";return(0,r.jsxs)(D.Zp,{className:"p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Readiness Score"}),(0,r.jsxs)("span",{className:A("text-2xl font-bold",({"very-low":"text-red-600 bg-red-50 border-red-200",low:"text-orange-600 bg-orange-50 border-orange-200",medium:"text-yellow-600 bg-yellow-50 border-yellow-200",high:"text-green-600 bg-green-50 border-green-200"})[o].split(" ")[0]),children:[l,"%"]})]}),(0,r.jsx)("div",{className:"w-full rounded-full h-3",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 50%, var(--color-border) 50%)"},children:(0,r.jsx)("div",{className:A("h-3 rounded-full transition-all duration-300",{"very-low":"bg-red-500",low:"bg-orange-500",medium:"bg-yellow-500",high:"bg-green-500"}[o]),style:{width:"".concat(l,"%")}})}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-muted",children:"Load Adjustment:"}),(0,r.jsxs)("span",{className:A("font-semibold",n>1?"text-blue-600":n<1?"text-orange-600":"text-gray-600"),children:[n>1?"+":"",Math.round((n-1)*100),"%"]})]}),s.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-secondary",children:"Status Flags:"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:s.map((e,t)=>(0,r.jsx)("span",{className:A("px-2 py-1 text-xs rounded-full border",e.includes("good")||e.includes("high")?"text-green-700 bg-green-50 border-green-200":e.includes("low")||e.includes("poor")||e.includes("missing")?"text-orange-700 bg-orange-50 border-orange-200":"text-gray-700 bg-gray-50 border-gray-200"),children:e.replace("_"," ")},t))})]})]})}function W(e){let{sessionId:t,readiness:s,overloadMultiplier:r,userAcceptedSuggestions:n,totalSuggestions:l,modelUsed:o,responseTime:a,hasWhoopData:i,experienceLevel:c,flags:d=[],warnings:m=[],hasManualWellness:p=!1,manualWellnessData:x}=e,h=l>0?n/l:0;g.Ay.capture("health_advice_used",{session_id:t,readiness_score:s,overload_multiplier:r,accepted_suggestions:n,total_suggestions:l,acceptance_rate:h,model_used:o,response_time_ms:a,has_whoop_data:i,experience_level:c,readiness_flags:d,warnings_count:m.length,has_warnings:m.length>0,has_manual_wellness:p,wellness_input_type:p?"manual":i?"whoop":"none",manual_energy_level:null==x?void 0:x.energyLevel,manual_sleep_quality:null==x?void 0:x.sleepQuality,manual_wellness_has_notes:(null==x?void 0:x.hasNotes)||!1}),u.z.featureUsed("health_advice",{sessionId:t,readiness:s,overloadMultiplier:r,acceptanceRate:h,modelUsed:o,hasWhoopData:i,experienceLevel:c,flagsCount:d.length,warningsCount:m.length})}function T(e){let{sessionId:t,errorType:s,errorMessage:r,modelUsed:n,hasWhoopData:l,experienceLevel:o}=e;g.Ay.capture("health_advice_error",{session_id:t,error_type:s,error_message:r,model_used:n,has_whoop_data:l,experience_level:o}),u.z.error(Error(r),{context:"health_advice",sessionId:t,errorType:s,modelUsed:n,hasWhoopData:l,experienceLevel:o})}function P(e){let{sessionId:t,exerciseId:s,setId:r,action:n,suggestionType:l,originalValue:o,suggestedValue:a,acceptedValue:i}=e;g.Ay.capture("health_advice_suggestion_interaction",{session_id:t,exercise_id:s,set_id:r,action:n,suggestion_type:l,original_value:o,suggested_value:a,accepted_value:i,suggestion_change_percent:o&&a?(a-o)/o*100:null})}function O(e){let{sessionId:t,totalDuration:s,aiGenerationTime:r,serverProcessingTime:n,modelUsed:l,inputSize:o,outputSize:a}=e;g.Ay.capture("health_advice_performance",{session_id:t,total_duration_ms:s,ai_generation_time_ms:r,server_processing_time_ms:n,model_used:l,input_size_bytes:o,output_size_bytes:a,performance_rating:s<300?"excellent":s<1e3?"good":s<3e3?"acceptable":"poor"}),s>3e3&&u.z.featureUsed("health_advice_slow_response",{sessionId:t,totalDuration:s,modelUsed:l,aiGenerationTime:r,serverProcessingTime:n,performance_issue:"slow_response"})}function L(e){let{sessionId:t,action:s,presetUsed:r,timeSpent:n,initialValues:l,finalValues:o}=e;g.Ay.capture("wellness_modal_interaction",{session_id:t,action:s,preset_used:r,time_spent_ms:n,initial_energy:null==l?void 0:l.energy,initial_sleep:null==l?void 0:l.sleep,final_energy:null==o?void 0:o.energy,final_sleep:null==o?void 0:o.sleep,values_changed:!!l&&!!o&&(l.energy!==o.energy||l.sleep!==o.sleep),used_presets:!!r})}function F(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}function z(e){let{exercise:t,onAcceptSuggestion:s,onOverrideSuggestion:o,sessionId:a}=e,[i,c]=(0,n.useState)(new Set),[d,u]=(0,n.useState)({}),m=function(e,r){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2],c(t=>new Set(t).add(e)),s(e,r),a){let s=t.sets.find(t=>t.set_id===e);if(s){var n,l;void 0!==r.weight&&void 0!==s.suggested_weight_kg&&P({sessionId:a,exerciseId:t.exercise_id,setId:e,action:"accepted",suggestionType:"weight",suggestedValue:null!=(n=s.suggested_weight_kg)?n:void 0,acceptedValue:r.weight}),void 0!==r.reps&&void 0!==s.suggested_reps&&P({sessionId:a,exerciseId:t.exercise_id,setId:e,action:"accepted",suggestionType:"reps",suggestedValue:null!=(l=s.suggested_reps)?l:void 0,acceptedValue:r.reps})}}},p=Math.round(100*t.predicted_chance_to_beat_best),g=t.predicted_chance_to_beat_best>=.7?"text-success":t.predicted_chance_to_beat_best>=.5?"text-warning":"text-danger";return(0,r.jsxs)(D.Zp,{className:"space-y-4 p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:t.name||t.exercise_id}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-muted text-sm",children:"Beat Best Chance"}),(0,r.jsxs)("div",{className:F("text-lg font-bold",g),children:[p,"%"]})]})]}),(t.planned_volume_kg||t.best_volume_kg)&&(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 rounded-lg p-3",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 50%, var(--color-bg-app) 50%)"},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-muted text-xs",children:"Planned Volume"}),(0,r.jsx)("div",{className:"font-semibold",children:t.planned_volume_kg?"".concat(t.planned_volume_kg,"kg"):"N/A"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-muted text-xs",children:"Best Volume"}),(0,r.jsx)("div",{className:"font-semibold",children:t.best_volume_kg?"".concat(t.best_volume_kg,"kg"):"N/A"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h4",{className:"text-md font-medium",style:{color:"var(--color-text)"},children:"Set Suggestions"}),t.sets.map((e,s)=>{let n=i.has(e.set_id);return(0,r.jsxs)("div",{className:F("rounded-lg border p-3 transition-all",n?"border-green-200 dark:border-green-700":""),style:{backgroundColor:n?"color-mix(in oklab, var(--color-success) 10%, var(--color-bg-surface))":"var(--color-bg-surface)",borderColor:n?"var(--color-success)":"var(--color-border)"},children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"text-sm font-medium",children:["Set ",s+1]}),(0,r.jsx)("div",{className:"flex gap-2",children:n?(0,r.jsx)(l.Button,{size:"sm",variant:"secondary",onClick:()=>(e=>{if(c(t=>{let s=new Set(t);return s.delete(e),s}),o(e),a){let n=t.sets.find(t=>t.set_id===e);if(n){var s,r;void 0!==n.suggested_weight_kg&&P({sessionId:a,exerciseId:t.exercise_id,setId:e,action:"overridden",suggestionType:"weight",suggestedValue:null!=(s=n.suggested_weight_kg)?s:void 0}),void 0!==n.suggested_reps&&P({sessionId:a,exerciseId:t.exercise_id,setId:e,action:"overridden",suggestionType:"reps",suggestedValue:null!=(r=n.suggested_reps)?r:void 0})}}})(e.set_id),children:"Override"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.Button,{size:"sm",variant:"default",onClick:()=>m(e.set_id,{weight:e.suggested_weight_kg||void 0,reps:e.suggested_reps||void 0},"ai_recommended"),children:"Accept AI"}),(0,r.jsx)(l.Button,{size:"sm",variant:"secondary",onClick:()=>u(t=>({...t,[e.set_id]:!t[e.set_id]})),children:d[e.set_id]?"Hide":"Options"})]})})]}),(0,r.jsxs)("div",{className:"mb-2 grid grid-cols-2 gap-3",children:[e.suggested_weight_kg&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-muted text-xs",children:"Suggested Weight"}),(0,r.jsxs)("div",{className:"font-semibold",children:[e.suggested_weight_kg,"kg"]})]}),e.suggested_reps&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-muted text-xs",children:"Suggested Reps"}),(0,r.jsx)("div",{className:"font-semibold",children:e.suggested_reps})]})]}),e.suggested_rest_seconds&&(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("div",{className:"text-muted text-xs",children:"Suggested Rest"}),(0,r.jsxs)("div",{className:"font-semibold",children:[Math.round(e.suggested_rest_seconds/60)," ","minutes"]})]}),d[e.set_id]&&!n&&e.suggested_weight_kg&&e.suggested_reps&&(0,r.jsxs)("div",{className:"mt-3 rounded-lg p-3",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 70%, var(--color-bg-app) 30%)",borderColor:"var(--color-border)"},children:[(0,r.jsx)("div",{className:"text-muted mb-2 text-xs",children:"Alternative Progressions"}),(0,r.jsx)("div",{className:"space-y-2",children:((e,t)=>{let s=[];return s.push({weight_kg:Math.round((e+2.5)*10)/10,reps:Math.max(t-1,t),rationale:"Weight-focused: Prioritize strength gains through load increases",progression_type:"weight_focus"}),s.push({weight_kg:e,reps:t+1,rationale:"Reps-focused: Build endurance and volume tolerance",progression_type:"reps_focus"}),s.push({weight_kg:Math.round((e+1.25)*10)/10,reps:t,rationale:"Balanced: Steady progression in both strength and volume",progression_type:"balanced"}),s})(e.suggested_weight_kg,e.suggested_reps).map((t,s)=>(0,r.jsxs)("div",{className:"flex items-center justify-between rounded p-2",style:{backgroundColor:"var(--color-bg-surface)"},children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"text-sm font-medium",children:[t.weight_kg,"kg \xd7 ",t.reps," reps"]}),(0,r.jsx)("div",{className:"text-muted text-xs",children:t.rationale})]}),(0,r.jsx)(l.Button,{size:"sm",variant:"secondary",onClick:()=>m(e.set_id,{weight:t.weight_kg,reps:t.reps},t.progression_type),className:"ml-2",children:"Use This"})]},s))})]}),(0,r.jsxs)("div",{className:"rounded p-2 text-sm",style:{backgroundColor:"color-mix(in oklab, var(--color-bg-surface) 50%, var(--color-bg-app) 50%)",color:"var(--color-text-secondary)"},children:[(0,r.jsx)("div",{className:"text-muted mb-1 text-xs",children:"AI Rationale"}),e.rationale]})]},e.set_id)})]})]})}function U(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter(Boolean).join(" ")}function B(e){let{probability:t,title:s,subtitle:n}=e,l=Math.round(100*t),o=t>=.8?{bg:"bg-green-500",text:"text-green-600",border:"border-green-200"}:t>=.6?{bg:"bg-blue-500",text:"text-blue-600",border:"border-blue-200"}:t>=.4?{bg:"bg-yellow-500",text:"text-yellow-600",border:"border-yellow-200"}:t>=.2?{bg:"bg-orange-500",text:"text-orange-600",border:"border-orange-200"}:{bg:"bg-red-500",text:"text-red-600",border:"border-red-200"},a=2*Math.PI*40;return(0,r.jsx)(D.Zp,{className:"p-4 text-center",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:s}),n&&(0,r.jsx)("p",{className:"text-sm text-gray-600",children:n}),(0,r.jsxs)("div",{className:"relative w-24 h-24 mx-auto",children:[(0,r.jsxs)("svg",{className:"w-24 h-24 transform -rotate-90",viewBox:"0 0 100 100",children:[(0,r.jsx)("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"none",className:"text-gray-200"}),(0,r.jsx)("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"none",strokeLinecap:"round",strokeDasharray:a,strokeDashoffset:a-t*a,className:U(o.bg.replace("bg-","text-"),"transition-all duration-1000 ease-out")})]}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsxs)("span",{className:U("text-2xl font-bold",o.text),children:[l,"%"]})})]}),(0,r.jsx)("div",{className:U("inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border",o.text,o.bg.replace("bg-","bg-").replace("-500","-50"),o.border),children:t>=.8?"\uD83D\uDD25 Excellent":t>=.6?"\uD83D\uDCAA Good":t>=.4?"⚖️ Moderate":t>=.2?"⚠️ Low":"\uD83D\uDEA8 Very Low"})]})})}function V(e){let{summary:t,warnings:s}=e,[l,o]=(0,n.useState)(!0);return(0,r.jsxs)(D.Zp,{className:"p-4 space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("button",{onClick:()=>o(!l),className:"w-full text-left",children:(0,r.jsxs)("h3",{className:"text-lg font-semibold flex items-center justify-between gap-2",children:[(0,r.jsx)("span",{className:"flex items-center gap-2",children:"\uD83E\uDD16 AI Coach Summary"}),(0,r.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:l?"▼":"▶"})]})}),l&&(0,r.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,r.jsx)("p",{className:"leading-relaxed text-current opacity-90",children:t})})]}),l&&s.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-amber-600 dark:text-amber-400 flex items-center gap-1",children:"⚠️ Important Notes"}),(0,r.jsx)("div",{className:"space-y-1",children:s.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700/30 rounded-lg",children:[(0,r.jsx)("div",{className:"text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5",children:"⚠️"}),(0,r.jsx)("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:e})]},t))})]}),l&&(0,r.jsx)("div",{className:"pt-3 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"\uD83D\uDCA1 This is not medical advice. These recommendations are based on your WHOOP data and workout history. Always listen to your body and consult healthcare professionals for medical concerns."})})]})}function Q(e){let{isOpen:t,onClose:s,onSubmit:o,hasWhoopIntegration:a,isWhoopConnected:i,onConnectWhoop:c}=e,[d,u]=(0,n.useState)(5),[m,p]=(0,n.useState)(5),[g,x]=(0,n.useState)(5),[h,v]=(0,n.useState)(5);return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsx)(D.Zp,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Workout Intelligence"}),!a&&(0,r.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:"color-mix(in oklab, var(--color-warning) 10%, var(--color-bg-surface))",borderColor:"var(--color-warning)"},children:[(0,r.jsx)("p",{className:"text-sm text-secondary",children:"\uD83D\uDCA1 You don't have WHOOP connected, so we can't access your recovery metrics. Let us know how you're feeling today and we'll provide personalized workout recommendations."}),c&&(0,r.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:c,className:"mt-2 w-full",children:"Connect WHOOP for Better Insights"})]}),a&&!i&&(0,r.jsxs)("div",{className:"p-3 rounded-lg",style:{backgroundColor:"color-mix(in oklab, var(--color-danger) 10%, var(--color-bg-surface))",borderColor:"var(--color-danger)"},children:[(0,r.jsx)("p",{className:"text-sm text-secondary",children:"⚠️ Your WHOOP connection appears to be disconnected. Please reconnect to get the most accurate recommendations, or provide your current wellness status below."}),c&&(0,r.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:c,className:"mt-2 w-full",children:"Reconnect WHOOP"})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Energy Level"}),(0,r.jsxs)("span",{className:"text-sm text-muted",children:[d<=2?"Very Low":d<=4?"Low":d<=6?"Moderate":d<=8?"Good":"Excellent"," (",d,"/10)"]})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"10",value:d,onChange:e=>u(Number(e.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,r.jsx)("span",{children:"Very Low"}),(0,r.jsx)("span",{children:"Excellent"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Sleep Quality"}),(0,r.jsxs)("span",{className:"text-sm text-muted",children:[m<=2?"Very Poor":m<=4?"Poor":m<=6?"Fair":m<=8?"Good":"Excellent"," (",m,"/10)"]})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"10",value:m,onChange:e=>p(Number(e.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,r.jsx)("span",{children:"Very Poor"}),(0,r.jsx)("span",{children:"Excellent"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Recovery Feeling"}),(0,r.jsxs)("span",{className:"text-sm text-muted",children:[g<=2?"Very Poor":g<=4?"Poor":g<=6?"Fair":g<=8?"Good":"Excellent"," (",g,"/10)"]})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"10",value:g,onChange:e=>x(Number(e.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,r.jsx)("span",{children:"Very Poor"}),(0,r.jsx)("span",{children:"Excellent"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Stress Level"}),(0,r.jsxs)("span",{className:"text-sm text-muted",children:[h<=2?"Very Low":h<=4?"Low":h<=6?"Moderate":h<=8?"High":"Very High"," (",h,"/10)"]})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"10",value:h,onChange:e=>v(Number(e.target.value)),className:"w-full h-2 rounded-lg appearance-none cursor-pointer",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsxs)("div",{className:"flex justify-between text-xs text-muted",children:[(0,r.jsx)("span",{children:"Very Low"}),(0,r.jsx)("span",{children:"Very High"})]})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(l.Button,{variant:"secondary",onClick:s,className:"flex-1",children:"Cancel"}),(0,r.jsx)(l.Button,{onClick:()=>{o({energyLevel:d,sleepQuality:m,recoveryFeeling:g,stressLevel:h})},className:"flex-1 btn-primary",children:"Get Workout Intelligence"})]}),(0,r.jsx)("div",{className:"text-xs text-muted text-center pt-2 border-t",style:{borderColor:"var(--color-border)"},children:"\uD83D\uDCA1 This assessment helps us provide personalized workout recommendations. Not medical advice - always listen to your body."})]})})}):null}function H(e){let{isOpen:t,onClose:s,onSubmit:o,hasWhoopIntegration:a,isWhoopConnected:i,onConnectWhoop:c,isSubmitting:d=!1,submitError:u,sessionId:m}=e,[p,g]=(0,n.useState)(5),[x,h]=(0,n.useState)(5),[v,f]=(0,n.useState)(""),[y,b]=(0,n.useState)(null),[w]=(0,n.useState)(Date.now()),[j]=(0,n.useState)({energy:5,sleep:5});return t?(0,r.jsx)("div",{className:"bg-opacity-50 fixed inset-0 z-50 flex items-center justify-center bg-black p-4",children:(0,r.jsx)(D.Zp,{className:"max-h-[90vh] w-full max-w-md overflow-y-auto",children:(0,r.jsxs)("div",{className:"space-y-6 p-6",children:[(0,r.jsxs)("div",{className:"space-y-2 text-center",children:[(0,r.jsx)("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Quick Wellness Check"}),(0,r.jsx)("p",{className:"text-muted text-sm",children:"Just 2 quick inputs for personalized workout recommendations"}),!a&&(0,r.jsxs)("div",{className:"rounded-lg p-3 text-left",style:{backgroundColor:"color-mix(in oklab, var(--color-warning) 10%, var(--color-bg-surface))",borderColor:"var(--color-warning)"},children:[(0,r.jsx)("p",{className:"text-secondary text-sm",children:"\uD83D\uDCA1 Quick 30-second wellness check to get personalized workout recommendations"}),c&&(0,r.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:c,className:"mt-2 w-full",children:"Connect WHOOP for Better Insights"})]}),a&&!i&&(0,r.jsxs)("div",{className:"rounded-lg p-3 text-left",style:{backgroundColor:"color-mix(in oklab, var(--color-danger) 10%, var(--color-bg-surface))",borderColor:"var(--color-danger)"},children:[(0,r.jsx)("p",{className:"text-secondary text-sm",children:"⚠️ WHOOP disconnected. Quick wellness check will be used for recommendations."}),c&&(0,r.jsx)(l.Button,{variant:"secondary",size:"sm",onClick:c,className:"mt-2 w-full",children:"Reconnect WHOOP"})]}),a&&i&&(0,r.jsx)("div",{className:"rounded-lg p-3 text-left",style:{backgroundColor:"color-mix(in oklab, var(--color-success) 10%, var(--color-bg-surface))",borderColor:"var(--color-success)"},children:(0,r.jsx)("p",{className:"text-secondary text-sm",children:"✅ WHOOP connected! Your input will enhance the WHOOP data for even better recommendations."})})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Quick Presets"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.values({greatDay:{energyLevel:8,sleepQuality:8,label:"\uD83C\uDF1F Great Day",description:"High energy, great sleep"},averageDay:{energyLevel:6,sleepQuality:6,label:"\uD83D\uDE10 Average Day",description:"Normal energy, decent sleep"},toughDay:{energyLevel:3,sleepQuality:4,label:"\uD83D\uDE34 Tough Day",description:"Low energy, poor sleep"}}).map(e=>(0,r.jsxs)("button",{onClick:()=>{g(e.energyLevel),h(e.sleepQuality),b(null),L({sessionId:(null==m?void 0:m.toString())||"unknown",action:"preset_selected",presetUsed:e.label.toLowerCase().replace(/\s+/g,"_")})},className:"hover:bg-opacity-80 rounded-lg border p-3 text-center text-xs transition-colors",style:{borderColor:"var(--color-border)",backgroundColor:"color-mix(in oklab, var(--color-primary) 5%, var(--color-bg-surface))"},children:[(0,r.jsx)("div",{className:"mb-1 text-lg",children:e.label.split(" ")[0]}),(0,r.jsx)("div",{className:"text-[10px] font-medium",children:e.label.split(" ").slice(1).join(" ")}),(0,r.jsx)("div",{className:"text-muted mt-1 text-[10px]",children:e.description})]},e.label))})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"How energetic do you feel?"}),(0,r.jsxs)("span",{className:"text-muted text-sm",children:[p<=2?"Very Low":p<=4?"Low":p<=6?"Moderate":p<=8?"Good":"Excellent"," (",p,"/10)"]})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"10",value:p,onChange:e=>{g(Number(e.target.value)),b(null)},className:"slider-primary h-3 w-full cursor-pointer appearance-none rounded-lg",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsxs)("div",{className:"text-muted flex justify-between text-xs",children:[(0,r.jsx)("span",{children:"Drained"}),(0,r.jsx)("span",{children:"Peak Energy"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"How well did you sleep?"}),(0,r.jsxs)("span",{className:"text-muted text-sm",children:[x<=2?"Very Poor":x<=4?"Poor":x<=6?"Fair":x<=8?"Good":"Excellent"," (",x,"/10)"]})]}),(0,r.jsx)("input",{type:"range",min:"1",max:"10",value:x,onChange:e=>{h(Number(e.target.value)),b(null)},className:"slider-primary h-3 w-full cursor-pointer appearance-none rounded-lg",style:{backgroundColor:"var(--color-border)"}}),(0,r.jsxs)("div",{className:"text-muted flex justify-between text-xs",children:[(0,r.jsx)("span",{children:"Terrible"}),(0,r.jsx)("span",{children:"Perfect"})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("label",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Additional Notes (Optional)"}),(0,r.jsx)("textarea",{value:v,onChange:e=>{e.target.value.length<=500&&(f(e.target.value),b(null))},placeholder:"Any other factors affecting your wellness today? (e.g., stress, illness, excitement)",className:"w-full resize-none rounded-lg border p-3 text-sm",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-surface)",color:"var(--color-text)"},rows:3,maxLength:500}),(0,r.jsxs)("div",{className:"text-muted text-right text-xs",children:[v.length,"/500 characters"]})]})]}),(y||u)&&(0,r.jsx)("div",{className:"rounded-lg p-3",style:{backgroundColor:"color-mix(in oklab, var(--color-danger) 10%, var(--color-bg-surface))",borderColor:"var(--color-danger)"},children:(0,r.jsx)("p",{className:"text-danger text-sm",children:y||u})}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(l.Button,{variant:"secondary",onClick:s,className:"flex-1",disabled:d,children:"Cancel"}),(0,r.jsx)(l.Button,{onClick:()=>{b(null);let e={energyLevel:p,sleepQuality:x,deviceTimezone:Intl.DateTimeFormat().resolvedOptions().timeZone,notes:v.trim()||void 0};if(!function(e){let{energyLevel:t,sleepQuality:s,deviceTimezone:r,notes:n}=e;return"number"==typeof t&&"number"==typeof s&&"string"==typeof r&&!(t<1)&&!(t>10)&&!(s<1)&&!(s>10)&&(void 0===n||"string"==typeof n&&!(n.length>500))&&!0}(e))return void b("Please ensure all values are between 1-10 and notes are under 500 characters");L({sessionId:(null==m?void 0:m.toString())||"unknown",action:"submitted",timeSpent:Date.now()-w,initialValues:j,finalValues:{energy:p,sleep:x}}),o(e)},className:"btn-primary flex-1",disabled:d,children:d?"Getting Recommendations...":"Get Workout Intelligence"})]}),(0,r.jsx)("div",{className:"text-muted border-t pt-2 text-center text-xs",style:{borderColor:"var(--color-border)"},children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{children:"\uD83D\uDCA1 Quick wellness check for personalized recommendations"}),(0,r.jsx)("div",{children:"Not medical advice - always listen to your body"}),m&&(0,r.jsxs)("div",{className:"text-[10px] opacity-75",children:["Session #",m]})]})})]})})}):null}var G=s(41444);function q(e){let{sessionId:t,whoopData:s,userProfile:o,workoutPlan:a,priorBests:i}=e,[c,d]=(0,n.useState)(!1),[m,p]=(0,n.useState)(!1),[x,h]=(0,n.useState)(!1),[,v]=(0,n.useState)(new Map),[f,y]=(0,n.useState)(null),[b,w]=(0,n.useState)(!1),{advice:j,loading:N,error:_,fetchAdvice:k,fetchAdviceWithSubjectiveData:S,fetchAdviceWithManualWellness:C,hasExistingAdvice:M,whoopStatus:D}=function(e){var t,s;let[r,l]=(0,n.useState)(!1),[o,a]=(0,n.useState)(null),[i,c]=(0,n.useState)(null),[d,m]=(0,n.useState)(0),p=I.F.healthAdvice.save.useMutation(),x=I.F.healthAdvice.saveWithWellness.useMutation(),h=I.F.healthAdvice.updateAcceptedSuggestions.useMutation(),{data:v}=I.F.healthAdvice.getBySessionId.useQuery({sessionId:e},{enabled:!!e}),{data:f}=I.F.whoop.getIntegrationStatus.useQuery();(0,n.useEffect)(()=>{v&&!i&&(c(JSON.parse(v.response)),m(v.user_accepted_suggestions))},[v,i]);let y=(0,n.useCallback)(async t=>{l(!0),a(null);let s=performance.now();try{let r=await fetch("/api/health-advice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=performance.now()-s;if(!r.ok){let e=await r.json();throw T({sessionId:t.session_id,errorType:400===r.status?"validation_error":"api_error",errorMessage:e.error||"Failed to fetch advice",modelUsed:"unknown",hasWhoopData:!!t.whoop&&Object.keys(t.whoop||{}).length>0,experienceLevel:t.user_profile.experience_level}),Error(e.error||"Failed to fetch advice")}let l=await r.json();if(c(l),e)try{await p.mutateAsync({sessionId:e,request:t,response:l,responseTimeMs:n,modelUsed:"health-model"})}catch(t){G.vF.error("Failed to save health advice to database",t,{sessionId:e})}let o=l.per_exercise.reduce((e,t)=>e+t.sets.length,0);W({sessionId:t.session_id,readiness:l.readiness.rho,overloadMultiplier:l.readiness.overload_multiplier,userAcceptedSuggestions:d,totalSuggestions:o,modelUsed:"health-model",responseTime:n,hasWhoopData:Object.keys(t.whoop||{}).length>0,experienceLevel:t.user_profile.experience_level,flags:l.readiness.flags,warnings:l.warnings}),O({sessionId:t.session_id,totalDuration:n,modelUsed:"health-model",inputSize:JSON.stringify(t).length,outputSize:JSON.stringify(l).length})}catch(s){let e=s.message.includes("fetch")?"network_error":"api_error";T({sessionId:t.session_id,errorType:e,errorMessage:s.message,hasWhoopData:Object.keys(t.whoop||{}).length>0,experienceLevel:t.user_profile.experience_level}),a(s.message)}finally{l(!1)}},[e,p,d]),b=(0,n.useCallback)(async(e,t)=>{let s=function(e){let t=function(e){let{energyLevel:t,sleepQuality:s,recoveryFeeling:r,stressLevel:n}=e,l=(s-1)/9*100;return{recovery_score:Math.max(0,Math.min(100,Math.round((t-1)/9*40+(r-1)/9*30+(10-n)/9*20+.1*l))),sleep_performance:Math.max(0,Math.min(100,l)),hrv_now_ms:void 0,hrv_baseline_ms:void 0,rhr_now_bpm:void 0,rhr_baseline_bpm:void 0,yesterday_strain:Math.max(5,Math.min(20,Math.round(20-(r-1)/9*15)))}}(e);return{recovery_score:t.recovery_score,sleep_performance:t.sleep_performance,hrv_now_ms:void 0,hrv_baseline_ms:void 0,rhr_now_bpm:void 0,rhr_baseline_bpm:void 0,yesterday_strain:t.yesterday_strain}}(t);return y({...e,whoop:s})},[y]),w=(0,n.useCallback)(async(t,s,r)=>{l(!0),a(null);let n=performance.now();try{var o;let l=function(e){let{energyLevel:t,sleepQuality:s}=e,r=(s-1)/9*100;return{recovery_score:Math.max(0,Math.min(100,Math.round((t-1)/9*70+.3*r))),sleep_performance:Math.max(0,Math.min(100,r)),hrv_now_ms:void 0,hrv_baseline_ms:void 0,rhr_now_bpm:void 0,rhr_baseline_bpm:void 0,yesterday_strain:Math.max(5,Math.min(20,Math.round(20-(t-1)/9*15)))}}(s),a={...t,whoop:l,manual_wellness:{energy_level:s.energyLevel,sleep_quality:s.sleepQuality,has_whoop_data:!1,device_timezone:s.deviceTimezone,notes:s.notes}},i=await fetch("/api/health-advice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),m=performance.now()-n;if(!i.ok){let e=await i.json();throw T({sessionId:t.session_id,errorType:400===i.status?"validation_error":"api_error",errorMessage:e.error||"Failed to fetch advice",modelUsed:"unknown",hasWhoopData:!1,experienceLevel:t.user_profile.experience_level}),Error(e.error||"Failed to fetch advice")}let p=await i.json();if(c(p),e)try{await x.mutateAsync({sessionId:e,request:a,response:p,responseTimeMs:m,modelUsed:"health-model",wellnessDataId:r})}catch(t){G.vF.error("Failed to save health advice to database",t,{sessionId:e})}let h=p.per_exercise.reduce((e,t)=>e+t.sets.length,0);!function(e){let{sessionId:t,energyLevel:s,sleepQuality:r,hasNotes:n,notesLength:l,deviceTimezone:o,submissionTime:a}=e;g.Ay.capture("manual_wellness_submitted",{session_id:t,energy_level:s,sleep_quality:r,wellness_average:(s+r)/2,has_notes:n,notes_length:l||0,device_timezone:o,submission_time_ms:a,energy_category:s>=8?"high":s>=6?"good":s>=4?"moderate":"low",sleep_category:r>=8?"excellent":r>=6?"good":r>=4?"fair":"poor",overall_wellness:s>=7&&r>=7?"excellent":s>=5&&r>=5?"good":s>=3&&r>=3?"moderate":"poor"}),u.z.featureUsed("manual_wellness_submission",{sessionId:t,energyLevel:s,sleepQuality:r,hasNotes:n,deviceTimezone:o,submissionTime:a})}({sessionId:t.session_id,energyLevel:s.energyLevel,sleepQuality:s.sleepQuality,hasNotes:!!(s.notes&&s.notes.trim().length>0),notesLength:(null==(o=s.notes)?void 0:o.length)||0,deviceTimezone:s.deviceTimezone,submissionTime:m}),W({sessionId:t.session_id,readiness:p.readiness.rho,overloadMultiplier:p.readiness.overload_multiplier,userAcceptedSuggestions:d,totalSuggestions:h,modelUsed:"health-model",responseTime:m,hasWhoopData:!1,experienceLevel:t.user_profile.experience_level,flags:p.readiness.flags,warnings:p.warnings,hasManualWellness:!0,manualWellnessData:{energyLevel:s.energyLevel,sleepQuality:s.sleepQuality,hasNotes:!!(s.notes&&s.notes.trim().length>0)}}),O({sessionId:t.session_id,totalDuration:m,modelUsed:"health-model",inputSize:JSON.stringify(a).length,outputSize:JSON.stringify(p).length})}catch(s){let e=s.message.includes("fetch")?"network_error":"api_error";T({sessionId:t.session_id,errorType:e,errorMessage:s.message,hasWhoopData:!1,experienceLevel:t.user_profile.experience_level}),a(s.message)}finally{l(!1)}},[e,x,d]),j=(0,n.useCallback)(()=>{c(null),a(null),m(0)},[]),N=(0,n.useCallback)(async()=>{let t=d+1;if(m(t),e)try{await h.mutateAsync({sessionId:e,acceptedCount:t})}catch(e){console.error("Failed to update accepted suggestions count:",e),m(d)}},[e,d,h]),_=(0,n.useCallback)(async()=>{if(d>0){let t=d-1;if(m(t),e)try{await h.mutateAsync({sessionId:e,acceptedCount:t})}catch(t){G.vF.error("Failed to update accepted suggestions count",t,{sessionId:e}),m(d)}}},[e,d,h]);return{advice:i,loading:r,error:o,acceptedSuggestions:d,fetchAdvice:y,fetchAdviceWithSubjectiveData:b,fetchAdviceWithManualWellness:w,clearAdvice:j,acceptSuggestion:N,rejectSuggestion:_,hasExistingAdvice:!!v,whoopStatus:{isConnected:null!=(t=null==f?void 0:f.isConnected)&&t,hasIntegration:!!f,connectedAt:null!=(s=null==f?void 0:f.connectedAt)?s:null}}}(t),{data:A,refetch:P}=I.F.workouts.getById.useQuery({id:t},{enabled:!!t}),{data:L}=I.F.preferences.get.useQuery(),F=I.F.wellness.save.useMutation(),U=o||{experience_level:"intermediate",min_increment_kg:2.5,preferred_rpe:8},q=n.useMemo(()=>(null==A?void 0:A.template)&&"object"==typeof A.template&&!Array.isArray(A.template)&&Array.isArray(A.template.exercises)?A.template.exercises:void 0,[A]),Y=n.useMemo(()=>q?{exercises:q.map(e=>{let t=Array.isArray(null==A?void 0:A.exercises)?A.exercises.filter(t=>t.exerciseName===e.exerciseName):[],s=Array.from({length:t.length>0?t.length:3},(s,r)=>{let n=t[r];return{set_id:"".concat(e.id,"_").concat(r+1),target_reps:(null==n?void 0:n.reps)||null,target_weight_kg:(null==n?void 0:n.weight)?parseFloat(n.weight):null,target_rpe:(null==n?void 0:n.rpe)||null}});return{exercise_id:e.id.toString(),name:e.exerciseName,tags:["strength"],sets:s}})}:a||{exercises:[]},[q,A,a]),X=i||{by_exercise_id:{}};n.useEffect(()=>{M&&j&&d(!0)},[M,j]);let J=async()=>{var e;let r=null!=(e=null==L?void 0:L.enable_manual_wellness)&&e;if(D.isConnected){let e={session_id:t.toString(),user_profile:U,whoop:s,workout_plan:Y,prior_bests:X};await k(e),d(!0)}else r?h(!0):p(!0)},Z=async e=>{p(!1);let s={session_id:t.toString(),user_profile:U,workout_plan:Y,prior_bests:X};await S(s,e),d(!0)},K=async e=>{w(!0),y(null);try{let s=await F.mutateAsync({sessionId:t,energyLevel:e.energyLevel,sleepQuality:e.sleepQuality,deviceTimezone:e.deviceTimezone,notes:e.notes,hasWhoopData:!1}),r={session_id:t.toString(),user_profile:U,workout_plan:Y,prior_bests:X};(null==s?void 0:s.id)?await C(r,e,s.id):(console.warn("Wellness data save returned no ID, proceeding without wellness tracking"),await C(r,e)),h(!1),d(!0)}catch(e){console.error("Failed to submit manual wellness:",e),y(e instanceof Error?e.message:"Failed to submit wellness data. Please try again.")}finally{w(!1)}},$=()=>{window.open("/connect-whoop","_blank")},ee=I.F.workouts.updateSessionSets.useMutation({onSuccess:async()=>{console.log("Successfully updated session sets"),await P()},onError:e=>{console.error("Failed to update session sets:",e)}}),et=I.F.suggestions.trackInteraction.useMutation(),es=async(e,s)=>{v(t=>new Map(t).set(e,s));let r=/^(\d+)_(\d+)$/.exec(e);if(!r)return void console.error("Invalid setId format:",e,"Expected format: templateExerciseId_setIndex");let n=parseInt(r[1]),l=parseInt(r[2])-1;if(!n)return void console.error("No template exercise ID captured from setId:",e);if(!q)return void console.error("Template exercises are unavailable when processing set:",e);let o=q.find(e=>e.id===n);if(!o)return void console.error("Could not find template exercise for ID:",n);let a=o.exerciseName;try{if(await ee.mutateAsync({sessionId:t,updates:[{setId:e,exerciseName:a,setIndex:l,weight:s.weight,reps:s.reps,unit:"kg"}]}),j){let r=j.per_exercise.find(e=>e.exercise_id===n.toString()||e.name===a),o=null==r?void 0:r.sets.find(t=>t.set_id===e);if(o)try{var i;await et.mutateAsync({sessionId:t,exerciseName:a,setId:e,setIndex:l,suggestedWeightKg:o.suggested_weight_kg,suggestedReps:o.suggested_reps,suggestedRestSeconds:o.suggested_rest_seconds,suggestionRationale:o.rationale,action:"accepted",acceptedWeightKg:s.weight,acceptedReps:s.reps,progressionType:null!=(i=null==L?void 0:L.progression_type)?i:"adaptive",readinessScore:j.readiness.rho,plateauDetected:o.rationale.includes("Plateau Alert")||o.rationale.includes("plateau detected")})}catch(e){console.warn("Failed to track suggestion interaction:",e)}}G.vF.info("suggestion_applied",{setId:e,suggestion:s,exerciseName:a,setIndex:l,sessionId:t})}catch(s){G.vF.error("Failed to apply suggestion",s,{setId:e,sessionId:t}),v(t=>{let s=new Map(t);return s.delete(e),s})}},er=e=>{v(t=>{let s=new Map(t);return s.delete(e),s}),console.log("Overridden suggestion for set",e)};return(0,r.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)(l.Button,{onClick:J,disabled:N||b,variant:"default",size:"lg",children:N||b?"Getting AI Advice...":M?"\uD83D\uDD04 Refresh Workout Intelligence":(null==L?void 0:L.enable_manual_wellness)&&!D.isConnected?"\uD83C\uDFAF Quick Wellness Check":"\uD83E\uDD16 Get Workout Intelligence"})}),c&&j&&(0,r.jsxs)("div",{className:"glass-surface space-y-3 p-3 sm:space-y-4 sm:p-4",style:{backgroundColor:"var(--color-bg-surface)",color:"var(--color-text)",borderColor:"var(--color-border)"},children:[(0,r.jsx)("h2",{className:"text-center text-lg font-bold sm:text-xl md:text-2xl",style:{color:"var(--color-text)"},children:"\uD83C\uDFCB️ Today's Workout Intelligence"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-3 sm:gap-4 lg:grid-cols-2",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(R,{rho:j.readiness.rho,flags:j.readiness.flags,overloadMultiplier:j.readiness.overload_multiplier}),(0,r.jsx)(B,{probability:j.session_predicted_chance,title:"Session Success Chance",subtitle:"Probability to beat your previous bests"})]}),(0,r.jsx)(V,{summary:j.summary,warnings:j.warnings})]}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold sm:text-xl",style:{color:"var(--color-text)"},children:"Exercise Recommendations"}),j.per_exercise.map(e=>(0,r.jsx)(z,{exercise:e,onAcceptSuggestion:es,onOverrideSuggestion:er,sessionId:t.toString()},e.exercise_id))]})]}),_&&(0,r.jsxs)("div",{className:"glass-surface rounded-lg p-4",style:{borderColor:"var(--color-danger)",color:"var(--color-danger)"},children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Health Advice Error"}),(0,r.jsx)("p",{children:_})]}),(0,r.jsx)(Q,{isOpen:m,onClose:()=>p(!1),onSubmit:Z,hasWhoopIntegration:D.hasIntegration,isWhoopConnected:D.isConnected,onConnectWhoop:$}),(0,r.jsx)(H,{isOpen:x,onClose:()=>{h(!1),y(null)},onSubmit:K,hasWhoopIntegration:D.hasIntegration,isWhoopConnected:D.isConnected,onConnectWhoop:$,isSubmitting:b,submitError:null!=f?f:void 0,sessionId:t}),(0,r.jsx)(E,{sessionId:t})]})}}},e=>{e.O(0,[8229,274,8096,126,842,8441,7358],()=>e(e.s=89770)),_N_E=e.O()}]);