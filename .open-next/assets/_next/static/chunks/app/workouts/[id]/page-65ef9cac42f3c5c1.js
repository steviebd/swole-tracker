(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2043],{28605:(e,t,s)=>{"use strict";s.d(t,{SessionDebriefPanel:()=>f});var i=s(95155),n=s(12115),r=s(80842),a=s(2651);let l=a.Ik({exerciseName:a.Yj(),metric:a.k5(["weight","volume","reps","streak","consistency","readiness","other"]).default("other"),summary:a.Yj(),delta:a.ai().optional(),unit:a.Yj().optional(),currentValue:a.KC([a.ai(),a.Yj()]).optional(),previousValue:a.KC([a.ai(),a.Yj()]).optional(),emoji:a.Yj().optional()}),o=a.Ik({title:a.Yj(),description:a.Yj(),priority:a.k5(["today","upcoming","longTerm"]).default("upcoming").optional(),actions:a.YO(a.Yj()).default([]).optional()}),d=a.Ik({current:a.ai().int().nonnegative(),longest:a.ai().int().nonnegative().optional(),message:a.Yj(),status:a.k5(["building","hot","cooling","reset"]).default("building").optional()}),c=a.Ik({readiness:a.ai().min(0).max(1).optional(),recommendation:a.Yj().optional(),nextSteps:a.YO(a.Yj()).default([]).optional(),cautionFlags:a.YO(a.Yj()).default([]).optional()}),u=a.Ik({summary:a.Yj(),prHighlights:a.YO(l).default([]),adherenceScore:a.ai().min(0).max(100).nullable().optional(),focusAreas:a.YO(o).default([]),streakContext:d.nullable().optional(),overloadDigest:c.nullable().optional(),metadata:a.g1(a.Yj(),a.bz()).optional()});u.extend({id:a.ai().int(),user_id:a.Yj(),sessionId:a.ai().int(),version:a.ai().int().positive(),parentDebriefId:a.ai().int().nullable(),isActive:a.zM(),regenerationCount:a.ai().int().nonnegative(),viewedAt:a.p6().nullable(),dismissedAt:a.p6().nullable(),pinnedAt:a.p6().nullable(),createdAt:a.p6(),updatedAt:a.p6().nullable()}),a.Ik({sessionId:a.ai().int(),debriefId:a.ai().int().optional()});var m=s(60080),p=s(3998),g=s(86948),h=s(11647),v=s(20243);function f(e){var t,s,a;let{sessionId:l,templateName:o,sessionDate:d}=e,c=r.F.useUtils(),f=function(){let[e,t]=(0,n.useState)("undefined"==typeof navigator||navigator.onLine);return(0,n.useEffect)(()=>{let e=()=>t(!0),s=()=>t(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]),e}(),x=(0,n.useRef)(null),[b,j]=(0,n.useState)(null),D=(0,n.useMemo)(()=>({sessionId:l,includeInactive:!1,limit:10}),[l]),{data:S,isLoading:w,refetch:y}=r.F.sessionDebriefs.listBySession.useQuery(D),N=(0,n.useMemo)(()=>S?S.map(e=>{var t,s,i,n,r,a,l;let o=u.safeParse({summary:e.summary,prHighlights:null!=(t=e.prHighlights)?t:void 0,adherenceScore:null!=(s=e.adherenceScore)?s:void 0,focusAreas:null!=(i=e.focusAreas)?i:void 0,streakContext:null!=(n=e.streakContext)?n:void 0,overloadDigest:null!=(r=e.overloadDigest)?r:void 0,metadata:null!=(a=e.metadata)?a:void 0}),d=o.success?o.data:{summary:null!=(l=e.summary)?l:"",prHighlights:[],focusAreas:[],metadata:{}};return{record:e,content:d}}):[],[S]),k=N[0],I=r.F.sessionDebriefs.markViewed.useMutation({onMutate:async e=>{await c.sessionDebriefs.listBySession.cancel(D);let t=c.sessionDebriefs.listBySession.getData(D);return t&&c.sessionDebriefs.listBySession.setData(D,t=>null==t?void 0:t.map(t=>{var s;return t.id===(null!=(s=e.debriefId)?s:t.id)?{...t,viewedAt:new Date}:t})),{previous:t}},onError:(e,t,s)=>{(null==s?void 0:s.previous)&&c.sessionDebriefs.listBySession.setData(D,s.previous)},onSettled:()=>{c.sessionDebriefs.listBySession.invalidate(D)}}),A=r.F.sessionDebriefs.togglePinned.useMutation({onMutate:async e=>{await c.sessionDebriefs.listBySession.cancel(D),j(null);let t=c.sessionDebriefs.listBySession.getData(D);return t&&c.sessionDebriefs.listBySession.setData(D,t=>null==t?void 0:t.map(t=>{var s;return t.id===(null!=(s=e.debriefId)?s:t.id)?{...t,pinnedAt:t.pinnedAt?null:new Date}:t})),{previous:t}},onError:(e,t,s)=>{var i;(null==s?void 0:s.previous)&&c.sessionDebriefs.listBySession.setData(D,s.previous),j(null!=(i=e.message)?i:"Failed to update pin state.")},onSettled:()=>{c.sessionDebriefs.listBySession.invalidate(D)}}),P=r.F.sessionDebriefs.dismiss.useMutation({onMutate:async e=>{await c.sessionDebriefs.listBySession.cancel(D),j(null);let t=c.sessionDebriefs.listBySession.getData(D);return t&&c.sessionDebriefs.listBySession.setData(D,t=>null==t?void 0:t.filter(t=>{var s;return t.id!==(null!=(s=e.debriefId)?s:t.id)})),{previous:t}},onError:(e,t,s)=>{var i;(null==s?void 0:s.previous)&&c.sessionDebriefs.listBySession.setData(D,s.previous),j(null!=(i=e.message)?i:"Failed to dismiss debrief.")},onSuccess:e=>{e&&(m.z.aiDebriefDismissed(l.toString(),e.version,!!e.pinnedAt),j(null))},onSettled:()=>{c.sessionDebriefs.listBySession.invalidate(D)}}),B=r.F.sessionDebriefs.regenerate.useMutation({onMutate:async()=>{await c.sessionDebriefs.listBySession.cancel(D),j(null)},onSuccess:e=>{let{debrief:t}=e;t&&m.z.aiDebriefRegenerated(l.toString(),t.version)},onError:e=>{var t;j(null!=(t=e.message)?t:"Failed to regenerate debrief.")},onSettled:async()=>{await c.sessionDebriefs.listBySession.invalidate(D),y()}}),E=r.F.sessionDebriefs.generateAndSave.useMutation({onMutate:()=>{j(null)},onSuccess:e=>{let{debrief:t}=e;t&&m.z.aiDebriefRegenerated(l.toString(),t.version,"initial"),j(null)},onError:e=>{var t;j(null!=(t=e.message)?t:"Failed to generate debrief.")},onSettled:async()=>{await c.sessionDebriefs.listBySession.invalidate(D),y()}});(0,n.useEffect)(()=>{var e;if(k){if(k.record.viewedAt){x.current=k.record.version;return}x.current!==k.record.version&&(x.current=k.record.version,I.mutate({sessionId:l,debriefId:k.record.id}),m.z.aiDebriefViewed(l.toString(),k.record.version,null==(e=k.content.streakContext)?void 0:e.current))}},[k,I,l]);let O=!f;if(w)return(0,i.jsxs)(g.Zp,{children:[(0,i.jsx)(g.aR,{children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(v.EA,{className:"h-6 w-1/3"}),(0,i.jsx)(v.EA,{className:"h-4 w-1/2"})]})}),(0,i.jsxs)(g.Wu,{className:"space-y-3",children:[(0,i.jsx)(v.EA,{className:"h-20 w-full"}),(0,i.jsx)(v.EA,{className:"h-20 w-full"})]})]});if(!k)return(0,i.jsxs)(g.Zp,{children:[(0,i.jsxs)(g.aR,{children:[(0,i.jsx)(g.ZB,{children:"AI Session Debrief"}),(0,i.jsx)(g.BT,{children:"No AI debrief is available for this session yet."})]}),(0,i.jsxs)(g.Wu,{className:"space-y-3",children:[b?(0,i.jsx)("div",{className:"border-destructive/40 bg-destructive/10 text-destructive rounded-md border p-3 text-sm",children:b}):null,(0,i.jsx)("p",{className:"text-muted-foreground text-sm",children:"Generate a post-workout recap that highlights personal records, adherence trends, and focus areas for your next training block."})]}),(0,i.jsx)(g.wL,{children:(0,i.jsx)(p.Button,{disabled:E.isPending||O,onClick:()=>E.mutate({sessionId:l,skipIfActive:!1}),children:E.isPending?"Generating…":"Generate Debrief"})})]});let Y=N.slice(1);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)(g.Zp,{children:[(0,i.jsxs)(g.aR,{children:[(0,i.jsx)(g.ZB,{children:"AI Session Debrief"}),(0,i.jsxs)(g.BT,{children:[o," \xb7 ",new Date(d).toLocaleString()]})]}),(0,i.jsxs)(g.Wu,{className:"space-y-4",children:[b?(0,i.jsx)("div",{className:"border-destructive/40 bg-destructive/10 text-destructive rounded-md border p-3 text-sm",children:b}):null,(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Summary"}),(0,i.jsx)("p",{className:"text-muted-foreground text-sm leading-relaxed",children:k.content.summary})]}),(null==(t=k.content.prHighlights)?void 0:t.length)?(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-muted-foreground text-sm font-semibold tracking-wide uppercase",children:"Highlights"}),(0,i.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:k.content.prHighlights.map((e,t)=>{var s;return(0,i.jsxs)(h.E,{children:[e.emoji?"".concat(e.emoji," "):"",e.exerciseName,void 0!==e.delta?" (".concat(e.delta>0?"+":"").concat(e.delta).concat(null!=(s=e.unit)?s:"",")"):""]},"".concat(e.exerciseName,"-").concat(t))})})]}):null,(null==(s=k.content.focusAreas)?void 0:s.length)?(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("h4",{className:"text-muted-foreground text-sm font-semibold tracking-wide uppercase",children:"Focus Areas"}),(0,i.jsx)("div",{className:"grid gap-3 md:grid-cols-2",children:k.content.focusAreas.map((e,t)=>{var s;return(0,i.jsxs)("div",{className:"border-border/60 bg-muted/20 rounded-lg border p-3",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,i.jsx)("span",{className:"font-medium",children:e.title}),e.priority?(0,i.jsx)(h.E,{variant:"outline",children:e.priority}):null]}),(0,i.jsx)("p",{className:"text-muted-foreground mt-1 text-sm",children:e.description}),(null==(s=e.actions)?void 0:s.length)?(0,i.jsx)("ul",{className:"text-muted-foreground mt-2 list-disc pl-4 text-xs",children:e.actions.map((e,t)=>(0,i.jsx)("li",{children:e},t))}):null]},"".concat(e.title,"-").concat(t))})})]}):null,k.content.overloadDigest?(0,i.jsxs)("div",{className:"border-border/60 bg-background/40 rounded-lg border p-3",children:[(0,i.jsx)("h4",{className:"text-muted-foreground text-sm font-semibold tracking-wide uppercase",children:"Overload & Readiness"}),k.content.overloadDigest.recommendation?(0,i.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:k.content.overloadDigest.recommendation}):null,(null==(a=k.content.overloadDigest.cautionFlags)?void 0:a.length)?(0,i.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:k.content.overloadDigest.cautionFlags.map((e,t)=>(0,i.jsx)(h.E,{variant:"destructive",children:e},"".concat(e,"-").concat(t)))}):null]}):null]}),(0,i.jsxs)(g.wL,{className:"flex flex-wrap gap-2",children:[(0,i.jsx)(p.Button,{variant:"default",disabled:B.isPending||O,onClick:()=>B.mutate({sessionId:l}),children:B.isPending?"Regenerating…":"Regenerate"}),(0,i.jsx)(p.Button,{variant:k.record.pinnedAt?"secondary":"outline",disabled:A.isPending||O,onClick:()=>A.mutate({sessionId:l,debriefId:k.record.id}),children:A.isPending?"Updating…":k.record.pinnedAt?"Unpin":"Pin"}),(0,i.jsx)(p.Button,{variant:"ghost",disabled:P.isPending||O,onClick:()=>P.mutate({sessionId:l,debriefId:k.record.id}),children:P.isPending?"Dismissing…":"Dismiss"}),f?null:(0,i.jsx)("span",{className:"text-muted-foreground text-xs",children:"Offline mode – actions disabled"})]})]}),Y.length?(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,i.jsx)("h3",{className:"text-muted-foreground text-sm font-semibold tracking-wide uppercase",children:"Previous Snapshots"}),(0,i.jsx)(p.Button,{variant:"ghost",size:"sm",onClick:()=>void y(),children:"Refresh"})]}),(0,i.jsx)("div",{className:"grid gap-3 md:grid-cols-2",children:Y.map(e=>{var t;let{record:s,content:n}=e;return(0,i.jsxs)(g.Zp,{className:"border-border/70",children:[(0,i.jsxs)(g.aR,{className:"pb-2",children:[(0,i.jsxs)(g.ZB,{className:"text-sm font-semibold",children:["Version ",s.version]}),(0,i.jsxs)(g.BT,{children:[s.pinnedAt?"Pinned \xb7 ":"",function(e){try{return new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}).format(new Date(e))}catch(t){return e}}(s.createdAt)]})]}),(0,i.jsxs)(g.Wu,{className:"space-y-2 pb-2",children:[(0,i.jsx)("p",{className:"text-muted-foreground line-clamp-4 text-sm",children:n.summary}),(null==(t=n.prHighlights)?void 0:t.length)?(0,i.jsx)("div",{className:"flex flex-wrap gap-1",children:n.prHighlights.slice(0,3).map((e,t)=>(0,i.jsx)(h.E,{variant:"outline",children:e.exerciseName},"".concat(e.exerciseName,"-").concat(t)))}):null]}),(0,i.jsx)(g.wL,{className:"flex justify-end gap-2",children:(0,i.jsx)(p.Button,{variant:"ghost",size:"sm",disabled:A.isPending||O,onClick:()=>A.mutate({sessionId:l,debriefId:s.id}),children:s.pinnedAt?"Unpin":"Pin"})})]},s.id)})})]}):null,f?null:(0,i.jsx)("div",{className:"border-border/60 text-muted-foreground rounded-lg border border-dashed px-4 py-3 text-sm",children:"You appear to be offline. Debrief actions will sync once your connection returns."})]})}},60080:(e,t,s)=>{"use strict";s.d(t,{z:()=>r});var i=s(26614);let n=(e,t)=>{try{if("undefined"==typeof navigator||!0!==navigator.onLine)return;i.Ay.capture(e,null!=t?t:{})}catch(e){}},r={pageView:(e,t)=>{try{let s=window.location.href;n("$pageview",{$current_url:s,page:e,...t})}catch(e){}},workoutStarted:(e,t)=>{n("workout_started",{templateId:e,templateName:t,timestamp:new Date().toISOString()})},workoutCompleted:(e,t,s)=>{n("workout_completed",{sessionId:e,duration:t,exerciseCount:s,timestamp:new Date().toISOString()})},exerciseLogged:(e,t,s,i)=>{n("exercise_logged",{exerciseId:e,exerciseName:t,sets:s,weight:i,timestamp:new Date().toISOString()})},templateCreated:(e,t)=>{n("template_created",{templateId:e,exerciseCount:t,timestamp:new Date().toISOString()})},templateDeleted:e=>{n("template_deleted",{templateId:e,timestamp:new Date().toISOString()})},templateEdited:(e,t)=>{n("template_edited",{templateId:e,exerciseCount:t,timestamp:new Date().toISOString()})},templateDuplicated:e=>{n("template_duplicated",{templateId:e,timestamp:new Date().toISOString()})},weightUnitChanged:e=>{n("weight_unit_changed",{unit:e,timestamp:new Date().toISOString()})},error:(e,t)=>{n("error",{error:e.message,stack:e.stack,context:t,timestamp:new Date().toISOString()})},featureUsed:(e,t)=>{n("feature_used",{feature:e,...t,timestamp:new Date().toISOString()})},aiDebriefViewed:(e,t,s)=>{n("ai_debrief.viewed",{sessionId:e,version:t,streakLength:s,timestamp:new Date().toISOString()})},aiDebriefRegenerated:(e,t,s)=>{n("ai_debrief.regenerated",{sessionId:e,version:t,reason:s,timestamp:new Date().toISOString()})},aiDebriefDismissed:(e,t,s)=>{n("ai_debrief.dismissed",{sessionId:e,version:t,pinned:s,timestamp:new Date().toISOString()})}}},64354:(e,t,s)=>{Promise.resolve().then(s.bind(s,87958)),Promise.resolve().then(s.bind(s,33742)),Promise.resolve().then(s.bind(s,99776)),Promise.resolve().then(s.bind(s,47785)),Promise.resolve().then(s.bind(s,25979)),Promise.resolve().then(s.bind(s,59441)),Promise.resolve().then(s.bind(s,80549)),Promise.resolve().then(s.bind(s,1043)),Promise.resolve().then(s.bind(s,11515)),Promise.resolve().then(s.bind(s,53455)),Promise.resolve().then(s.bind(s,45339)),Promise.resolve().then(s.bind(s,5947)),Promise.resolve().then(s.bind(s,86639)),Promise.resolve().then(s.t.bind(s,52619,23)),Promise.resolve().then(s.bind(s,28605)),Promise.resolve().then(s.bind(s,3998)),Promise.resolve().then(s.bind(s,36904))}},e=>{e.O(0,[8229,274,8096,126,842,8441,7358],()=>e(e.s=64354)),_N_E=e.O()}]);