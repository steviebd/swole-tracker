"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[842],{29623:(e,t,a)=>{a.d(t,{WG:()=>i,pI:()=>s});let r={STATIC:{staleTime:12096e5,gcTime:2592e6},WHOOP_HISTORICAL:{staleTime:6048e5,gcTime:12096e5},WHOOP_CURRENT:{staleTime:36e5,gcTime:216e5},MEDIUM:{staleTime:0,gcTime:864e5},DYNAMIC:{staleTime:0,gcTime:72e5}};function s(e){e.setQueryDefaults(["templates"],{staleTime:r.STATIC.staleTime,gcTime:r.STATIC.gcTime,refetchOnWindowFocus:!1,refetchInterval:!1}),e.setQueryDefaults(["preferences"],{staleTime:r.STATIC.staleTime,gcTime:r.STATIC.gcTime,refetchOnWindowFocus:!1,refetchInterval:!1}),e.setQueryDefaults(["workouts","getRecent"],{staleTime:r.MEDIUM.staleTime,gcTime:r.MEDIUM.gcTime,refetchOnWindowFocus:!0,refetchInterval:!1}),e.setQueryDefaults(["workouts","getById"],{staleTime:r.MEDIUM.staleTime,gcTime:r.MEDIUM.gcTime,refetchOnWindowFocus:!1}),e.setQueryDefaults(["workouts","getLastExerciseData"],{staleTime:r.MEDIUM.staleTime,gcTime:r.MEDIUM.gcTime,refetchOnWindowFocus:!0}),e.setQueryDefaults(["progress","getWorkoutDates"],{staleTime:3e5,gcTime:36e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),e.setQueryDefaults(["progress","getVolumeProgression"],{staleTime:6e5,gcTime:72e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),e.setQueryDefaults(["progress","getConsistencyStats"],{staleTime:9e5,gcTime:108e5,refetchOnWindowFocus:!1,refetchOnMount:!1}),e.setQueryDefaults(["jokes"],{staleTime:r.DYNAMIC.staleTime,gcTime:r.DYNAMIC.gcTime,refetchOnWindowFocus:!0}),e.setQueryDefaults(["whoop","getIntegrationStatus"],{staleTime:r.WHOOP_CURRENT.staleTime,gcTime:r.WHOOP_CURRENT.gcTime,refetchOnWindowFocus:!1,refetchInterval:!1,retry:(e,t)=>{if(t&&"object"==typeof t&&"data"in t){let e=t.data;if((null==e?void 0:e.code)==="UNAUTHORIZED"||(null==e?void 0:e.code)==="NOT_FOUND")return!1}return e<2},retryDelay:5e3}),e.setQueryDefaults(["whoop","getWorkouts"],{staleTime:r.WHOOP_HISTORICAL.staleTime,gcTime:r.WHOOP_HISTORICAL.gcTime,refetchOnWindowFocus:!1,refetchInterval:!1,retry:(e,t)=>{if(t&&"object"==typeof t&&"data"in t){let e=t.data;if((null==e?void 0:e.code)==="UNAUTHORIZED"||(null==e?void 0:e.code)==="NOT_FOUND")return!1}return e<2},retryDelay:5e3}),["getLatestRecoveryData"].forEach(t=>{e.setQueryDefaults(["whoop",t],{staleTime:r.WHOOP_CURRENT.staleTime,gcTime:r.WHOOP_CURRENT.gcTime,refetchOnWindowFocus:!1,refetchInterval:!1,retry:(e,t)=>{if(t&&"object"==typeof t&&"data"in t){let e=t.data;if((null==e?void 0:e.code)==="UNAUTHORIZED"||(null==e?void 0:e.code)==="NOT_FOUND")return!1}return e<2},retryDelay:5e3})}),["getRecovery","getCycles","getSleep","getProfile","getBodyMeasurements"].forEach(t=>{e.setQueryDefaults(["whoop",t],{staleTime:r.WHOOP_HISTORICAL.staleTime,gcTime:r.WHOOP_HISTORICAL.gcTime,refetchOnWindowFocus:!1,refetchInterval:!1,retry:(e,t)=>{if(t&&"object"==typeof t&&"data"in t){let e=t.data;if((null==e?void 0:e.code)==="UNAUTHORIZED"||(null==e?void 0:e.code)==="NOT_FOUND")return!1}return e<2},retryDelay:5e3})})}let i={workouts:e=>{e.invalidateQueries({queryKey:["workouts"]})},templates:e=>{e.invalidateQueries({queryKey:["templates"]})},preferences:e=>{e.invalidateQueries({queryKey:["preferences"]})},jokes:e=>{e.invalidateQueries({queryKey:["jokes"]})},whoop:e=>{e.invalidateQueries({queryKey:["whoop"]})},all:e=>{e.invalidateQueries()}}},40374:(e,t,a)=>{a.d(t,{Hi:()=>l,Nv:()=>o,eu:()=>u});let r={QUEUE:"swole-tracker-offline-queue-v2",SESSIONS:"swole-tracker-offline-sessions-v1",SYNC_STATUS:"swole-tracker-sync-status-v1"};class s{static getStorage(){return window.localStorage?window.localStorage:{getItem:()=>Promise.resolve(null),setItem:()=>Promise.resolve(),removeItem:()=>Promise.resolve()}}static async getItem(e){try{let t=this.getStorage();if("getItem"in t&&"function"==typeof t.getItem){let a=t.getItem(e);return Promise.resolve(a)}return null}catch(e){return null}}static async setItem(e,t){try{let a=this.getStorage();"setItem"in a&&"function"==typeof a.setItem&&a.setItem(e,t)}catch(e){}}static async removeItem(e){try{let t=this.getStorage();"removeItem"in t&&"function"==typeof t.removeItem&&t.removeItem(e)}catch(e){}}}class i{static getInstance(){return this.instance||(this.instance=new i),this.instance}async readQueue(){try{let e=await s.getItem(r.QUEUE);if(!e)return[];let t=JSON.parse(e);if(!Array.isArray(t))return[];return t}catch(e){return[]}}async writeQueue(e){await s.setItem(r.QUEUE,JSON.stringify(e))}generateId(){return"q_".concat(Math.random().toString(36).slice(2),"_").concat(Date.now().toString(36))}calculateRetryDelay(e){return Math.min(1e3*Math.pow(2,e),3e4)+1e3*Math.random()}async enqueue(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"medium",r=await this.readQueue(),s={id:this.generateId(),type:e,payload:t,attempts:0,createdAt:Date.now(),updatedAt:Date.now(),priority:a};return"high"===a?r.unshift(s):r.push(s),await this.writeQueue(r),s.id}async dequeue(){let e=await this.readQueue(),t=Date.now(),a=e.findIndex(e=>!e.retryAfter||e.retryAfter<=t);if(-1===a)return;let r=e.splice(a,1)[0];return r&&await this.writeQueue(e),r}async updateItem(e,t){let a=await this.readQueue(),r=a.findIndex(t=>t.id===e);-1!==r&&(a[r]={...a[r],...t,updatedAt:Date.now()},await this.writeQueue(a))}async requeueWithBackoff(e,t){let a=await this.readQueue(),r={...e,attempts:e.attempts+1,lastError:t,retryAfter:Date.now()+this.calculateRetryDelay(e.attempts),updatedAt:Date.now()};if(r.attempts>=5)return void console.warn("Queue item exhausted retries:",r);a.unshift(r),await this.writeQueue(a)}async getQueueStatus(){let e=await this.readQueue(),t=Date.now(),a=e.filter(e=>e.attempts<5&&(!e.retryAfter||e.retryAfter<=t)).length,r=e.filter(e=>e.attempts>=5).length,s=e.filter(e=>e.retryAfter&&e.retryAfter>t).sort((e,t)=>{var a,r;return(null!=(a=e.retryAfter)?a:0)-(null!=(r=t.retryAfter)?r:0)})[0];return{pending:a,failed:r,nextRetry:null==s?void 0:s.retryAfter}}async clearQueue(){await s.removeItem(r.QUEUE)}async pruneExhausted(){let e=(await this.readQueue()).filter(e=>e.attempts<5);await this.writeQueue(e)}}class n{static getInstance(){return this.instance||(this.instance=new n),this.instance}async readSessions(){try{let e=await s.getItem(r.SESSIONS);if(!e)return{};return JSON.parse(e)}catch(e){return{}}}async writeSessions(e){await s.setItem(r.SESSIONS,JSON.stringify(e))}async createSession(e){let t=await this.readSessions(),a="session_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),r={id:a,templateId:e,startTime:Date.now(),lastSaved:Date.now(),exercises:[],isCompleted:!1};return t[a]=r,await this.writeSessions(t),a}async getSession(e){var t;return null!=(t=(await this.readSessions())[e])?t:null}async updateSession(e,t){let a=await this.readSessions();a[e]&&(a[e]={...a[e],...t,lastSaved:Date.now()},await this.writeSessions(a))}async completeSession(e){var t;let a=await this.getSession(e);if(!a)return;await this.updateSession(e,{isCompleted:!0});let r=i.getInstance();await r.enqueue("workout_save",{sessionId:parseInt(null!=(t=e.split("_")[1])?t:"0"),exercises:a.exercises.map(e=>({templateExerciseId:e.templateExerciseId,exerciseName:e.exerciseName,sets:e.sets.filter(e=>e.completed).map(e=>({id:e.id,weight:e.weight,reps:e.reps,sets:e.sets,unit:e.unit})),unit:e.unit}))},"high")}async deleteSession(e){let t=await this.readSessions();delete t[e],await this.writeSessions(t)}async getActiveSessions(){return Object.values(await this.readSessions()).filter(e=>!e.isCompleted)}async getCompletedSessions(){return Object.values(await this.readSessions()).filter(e=>e.isCompleted)}}class c{static getInstance(){return this.instance||(this.instance=new c),this.instance}async getSyncStatus(){try{var e,t;let a=await s.getItem(r.SYNC_STATUS),n=a?JSON.parse(a):{},c=await i.getInstance().getQueueStatus();return{lastSync:null!=(e=n.lastSync)?e:0,isOnline:null==(t=n.isOnline)||t,pendingOperations:c.pending,failedOperations:c.failed,nextRetry:c.nextRetry}}catch(e){return{lastSync:0,isOnline:!0,pendingOperations:0,failedOperations:0}}}async updateSyncStatus(e){let t={...await this.getSyncStatus(),...e};await s.setItem(r.SYNC_STATUS,JSON.stringify(t))}async markSyncCompleted(){await this.updateSyncStatus({lastSync:Date.now()})}}let o=i.getInstance(),l=n.getInstance(),u=c.getInstance()},80842:(e,t,a)=>{let r;a.d(t,{TRPCReactProvider:()=>g,F:()=>m});var s=a(95155),i=a(99776),n=a(58682),c=a(53018),o=a(12115),l=a(65450),u=a(31461),h=a(70594),d=a(29623),y=a(98635);a(95704);let m=(0,c.pY)();function g(e){let t=(null!=r||(r=(()=>{let e=new u.E({defaultOptions:{queries:{staleTime:6e5,gcTime:36e5,refetchOnWindowFocus:!1,refetchOnReconnect:!0,refetchInterval:!1,retry:(e,t)=>{if(t&&"object"==typeof t&&"data"in t){let e=t.data;if((null==e?void 0:e.code)==="UNAUTHORIZED"||(null==e?void 0:e.code)==="FORBIDDEN")return!1}return e<1},retryDelay:e=>Math.min(2e3*2**e,1e4),refetchOnMount:!1,networkMode:"offlineFirst"},mutations:{retry:(e,t)=>(!t||!("status"in t)||"number"!=typeof t.status||!(t.status>=400)||!(t.status<500))&&e<1,retryDelay:e=>Math.min(3e3*2**e,1e4),networkMode:"offlineFirst"},dehydrate:{serializeData:l.Ay.serialize,shouldDehydrateQuery:e=>(0,h.XS)(e)||"pending"===e.state.status},hydrate:{deserializeData:l.Ay.deserialize}}});return(0,d.pI)(e),e})()),r);(0,o.useEffect)(()=>(0,y.wM)(t),[t]);let[a]=(0,o.useState)(()=>m.createClient({links:[(0,n.$H)({enabled:e=>"down"===e.direction&&e.result instanceof Error}),(0,n.N9)({transformer:l.Ay,url:window.location.origin+"/api/trpc",headers:()=>{let e=new Headers;return e.set("x-trpc-source","nextjs-react"),e},fetch:(e,t)=>fetch(e,{...t,signal:AbortSignal.timeout(3e4)}).catch(e=>{if(e&&"object"==typeof e&&"name"in e){let t=e.name;if("AbortError"===t||"TimeoutError"===t)throw Error("NETWORK_ERROR")}throw e})})]}));return(0,s.jsx)(i.QueryClientProvider,{client:t,children:(0,s.jsx)(m.Provider,{client:a,queryClient:t,children:e.children})})}},88843:(e,t,a)=>{a.r(t),a.d(t,{CacheAnalytics:()=>r,destroyCacheAnalytics:()=>c,getCacheAnalytics:()=>n,initializeCacheAnalytics:()=>i});class r{setupQueryClientMonitoring(){let e=this.queryClient.getQueryCache(),t=e=>{if(!e.query)return;let t=JSON.stringify(e.query.queryKey),a=Date.now();switch(e.type){case"added":this.recordEvent({type:"miss",queryKey:t,timestamp:a}),this.metrics.misses++;break;case"updated":let r=e.query.state;r.isFetching&&void 0!==r.data?(this.recordEvent({type:"background_fetch",queryKey:t,timestamp:a,fromCache:!0}),this.metrics.backgroundFetches++):void 0!==r.data&&(this.recordEvent({type:"hit",queryKey:t,timestamp:a,fromCache:!1}),this.metrics.hits++)}this.updateMetrics()};e.subscribe(t)}recordEvent(e){this.events.push(e),this.events.length>this.maxEvents&&(this.events=this.events.slice(-this.maxEvents))}updateMetrics(){try{let e=localStorage.getItem("swole-tracker-cache-v3");this.metrics.cacheSize=e?new Blob([e]).size:0;let t=this.queryClient.getQueryCache().getAll();if(this.metrics.queryCount=t.length,t.length>0){let e=t.map(e=>e.state.dataUpdatedAt).filter(e=>e>0).sort();e.length>0&&(this.metrics.oldestCacheEntry=e[0],this.metrics.newestCacheEntry=e[e.length-1])}}catch(e){console.debug("Failed to update cache metrics:",e)}}getMetrics(){let e=this.metrics.hits+this.metrics.misses,t=e>0?this.metrics.hits/e*100:0,a=this.metrics.queryCount>0?(Date.now()-this.metrics.oldestCacheEntry)/this.metrics.queryCount:0;return{...this.metrics,hitRate:t,totalRequests:e,averageCacheAge:a}}getRecentEvents(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this.events.slice(-e)}recordCacheHealth(e){this.metrics.memoryOnlyMode=e.memoryOnlyMode,this.recordEvent({type:"cache_health",queryKey:"system",timestamp:Date.now(),size:e.cacheSize}),(e.memoryOnlyMode||e.cleanupPerformed)&&this.sendToPostHog("cache_health_critical",e)}recordQuotaExceeded(e){this.recordEvent({type:"quota_exceeded",queryKey:"system",timestamp:Date.now(),size:e.previousSize}),this.sendToPostHog("cache_quota_exceeded",e)}recordCacheCleared(e){this.recordEvent({type:"cache_cleared",queryKey:"system",timestamp:Date.now()}),this.sendToPostHog("cache_cleared",{trigger:e}),this.metrics={hits:0,misses:0,backgroundFetches:0,cacheSize:0,queryCount:0,oldestCacheEntry:Date.now(),newestCacheEntry:Date.now(),memoryOnlyMode:!1}}async sendToPostHog(e,t){try{if(window.posthog){let a=this.getMetrics();window.posthog.capture(e,{...t,cache_hit_rate:a.hitRate,cache_size_mb:(a.cacheSize/1048576).toFixed(2),total_requests:a.totalRequests,query_count:a.queryCount,average_cache_age_hours:(a.averageCacheAge/36e5).toFixed(2),memory_only_mode:a.memoryOnlyMode,timestamp:Date.now()})}}catch(e){console.debug("Failed to send cache analytics to PostHog:",e)}}startPeriodicReporting(){this.reportingInterval=setInterval(()=>{this.getMetrics().totalRequests>0&&this.sendToPostHog("cache_performance_report",{reporting_interval_minutes:5})},3e5)}destroy(){this.reportingInterval&&(clearInterval(this.reportingInterval),this.reportingInterval=void 0)}async measureQueryPerformance(e,t){let a=Date.now();try{let r=await t(),s=Date.now();return this.sendToPostHog("query_performance",{query_key:e,load_time_ms:s-a,success:!0}),r}catch(r){let t=Date.now();throw this.sendToPostHog("query_performance",{query_key:e,load_time_ms:t-a,success:!1,error:String(r)}),r}}getCacheReport(){let e=this.getMetrics(),t=this.getRecentEvents(20),a=[];return e.hitRate<50&&a.push("Low cache hit rate - consider increasing staleTime for frequently accessed data"),e.memoryOnlyMode&&a.push("Running in memory-only mode - consider clearing old data or reducing cache size"),e.cacheSize>4194304&&a.push("Cache size is large - consider implementing more aggressive cleanup policies"),e.queryCount>500&&a.push("High number of cached queries - some queries might not be getting evicted properly"),{summary:"Cache Hit Rate: ".concat(e.hitRate.toFixed(1),"%, Size: ").concat((e.cacheSize/1048576).toFixed(2),"MB, Queries: ").concat(e.queryCount),metrics:e,recentEvents:t,recommendations:a}}constructor(e){this.queryClient=e,this.metrics={hits:0,misses:0,backgroundFetches:0,cacheSize:0,queryCount:0,oldestCacheEntry:Date.now(),newestCacheEntry:Date.now(),memoryOnlyMode:!1},this.events=[],this.maxEvents=1e3,this.setupQueryClientMonitoring(),this.startPeriodicReporting()}}let s=null;function i(e){return s&&s.destroy(),s=new r(e)}function n(){return s}function c(){s&&(s.destroy(),s=null)}},98635:(e,t,a)=>{let r;a.d(t,{Ik:()=>m,clearAllOfflineData:()=>p,vp:()=>g,wM:()=>y});var s=a(35603),i=a(7946),n=a(40374),c=a(88843);let o="swole-tracker-cache-v3",l={WARNING_THRESHOLD:4194304,AGGRESSIVE_CLEANUP:4718592,FALLBACK_THRESHOLD:4980736,MAX_CACHE_SIZE:5242880};class u{getCacheSize(){let e=localStorage.getItem(o);return e?new Blob([e]).size:0}getAvailableSpace(){return l.MAX_CACHE_SIZE-this.getCacheSize()}performCacheCleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var t;let a=localStorage.getItem(o);if(!a)return;let r=JSON.parse(a),s=null==r||null==(t=r.clientState)?void 0:t.queries;if(!s)return;let i=Object.entries(s).map(e=>{var t;let[a,r]=e;return{key:a,query:r,lastAccessed:(null==r||null==(t=r.state)?void 0:t.dataUpdatedAt)||0,size:JSON.stringify(r).length}}).sort((e,t)=>e.lastAccessed-t.lastAccessed),n=e?.3:.2,l=Math.floor(i.length*n);for(let e=0;e<l;e++)delete s[i[e].key];localStorage.setItem(o,JSON.stringify(r)),this.trackCacheEvent("cache_cleanup",{aggressive:e,queriesRemoved:l,newSize:this.getCacheSize()});let u=(0,c.getCacheAnalytics)();u&&u.recordCacheHealth({cacheSize:this.getCacheSize(),availableSpace:this.getAvailableSpace(),memoryOnlyMode:this.isMemoryOnlyMode,cleanupPerformed:!0,queriesEvicted:l})}catch(e){console.warn("Cache cleanup failed:",e),this.trackCacheEvent("cache_cleanup_failed",{error:String(e)})}}handleQuotaExceeded(){this.isMemoryOnlyMode=!0;try{localStorage.removeItem(o),this.trackCacheEvent("quota_exceeded_fallback",{previousSize:this.getCacheSize()});let e=(0,c.getCacheAnalytics)();e&&e.recordQuotaExceeded({previousSize:this.getCacheSize()})}catch(e){console.warn("Failed to clear cache after quota exceeded:",e)}}performCacheHealthCheck(){try{let e=this.getCacheSize(),t=localStorage.getItem(o);if(t&&JSON.parse(t),e>=l.FALLBACK_THRESHOLD)return console.warn("Cache size critical, falling back to memory-only mode"),this.handleQuotaExceeded(),!1;e>=l.AGGRESSIVE_CLEANUP?(console.log("Performing aggressive cache cleanup"),this.performCacheCleanup(!0)):e>=l.WARNING_THRESHOLD&&(console.log("Performing standard cache cleanup"),this.performCacheCleanup(!1)),this.trackCacheEvent("cache_health_check",{cacheSize:e,availableSpace:this.getAvailableSpace(),memoryOnlyMode:this.isMemoryOnlyMode});let a=(0,c.getCacheAnalytics)();return a&&a.recordCacheHealth({cacheSize:e,availableSpace:this.getAvailableSpace(),memoryOnlyMode:this.isMemoryOnlyMode}),!0}catch(e){console.error("Cache health check failed:",e);try{localStorage.removeItem(o)}catch(e){console.error("Failed to clear corrupted cache:",e)}return this.trackCacheEvent("cache_corrupted",{error:String(e)}),!1}}async trackCacheEvent(e,t){try{window.posthog&&window.posthog.capture("cache_".concat(e),{...t,timestamp:Date.now(),cacheVersion:o})}catch(e){console.debug("Failed to track cache event:",e)}}isMemoryOnly(){return this.isMemoryOnlyMode}getStats(){return{size:this.getCacheSize(),availableSpace:this.getAvailableSpace(),memoryOnly:this.isMemoryOnlyMode}}constructor(){this.isMemoryOnlyMode=!1}}let h=new u;(0,i.s)({storage:window.localStorage,key:"swole-tracker-cache",serialize:JSON.stringify,deserialize:JSON.parse});class d{start(){!this.syncInterval&&(this.syncInterval=setInterval(()=>{this.processPendingOperations()},3e4),"undefined"!=typeof navigator&&navigator.onLine&&this.processPendingOperations())}stop(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=void 0)}onSyncStatusChange(e){return this.callbacks.add(e),()=>this.callbacks.delete(e)}notifyCallbacks(e){this.callbacks.forEach(t=>t(e))}async processPendingOperations(){if(!this.isProcessing&&("undefined"==typeof navigator||navigator.onLine)){this.isProcessing=!0;try{let e,t=0;for(;(e=await n.Nv.dequeue())&&t<5;)try{await this.processQueueItem(e),t++}catch(a){let t=a instanceof Error?a.message:"Unknown error";console.warn("Failed to process queue item:",e.type,t),await n.Nv.requeueWithBackoff(e,t)}t>0&&(await n.eu.markSyncCompleted(),await this.invalidateQueriesAfterSync());let a=await n.eu.getSyncStatus();this.notifyCallbacks(a)}finally{this.isProcessing=!1}}}async processQueueItem(e){let{type:t,payload:a}=e;switch(t){case"workout_save":await this.syncWorkout(a);break;case"template_create":case"template_update":await this.syncTemplate(a);break;case"template_delete":await this.deleteTemplate(a);break;default:throw Error("Unknown operation type: ".concat(t))}}async syncWorkout(e){console.log("Syncing workout:",e),await new Promise(e=>setTimeout(e,1e3))}async syncTemplate(e){console.log("Syncing template:",e),await new Promise(e=>setTimeout(e,500))}async deleteTemplate(e){console.log("Deleting template:",e),await new Promise(e=>setTimeout(e,500))}async invalidateQueriesAfterSync(){await Promise.all([this.queryClient.invalidateQueries({queryKey:["workouts"]}),this.queryClient.invalidateQueries({queryKey:["templates"]}),this.queryClient.invalidateQueries({queryKey:["workouts","getRecent"]})])}constructor(e){this.queryClient=e,this.isProcessing=!1,this.callbacks=new Set}}function y(e){let t=(()=>{let e=window.localStorage;return(0,i.s)({storage:h.isMemoryOnly()?void 0:e,key:o,serialize:e=>{try{if(!h.performCacheHealthCheck())return JSON.stringify({clientState:{queries:{}}});let t=JSON.stringify(e);return t.length>l.WARNING_THRESHOLD&&(console.log("Large cache detected during serialization, performing cleanup"),h.performCacheHealthCheck()),t}catch(e){return e instanceof DOMException&&"QuotaExceededError"===e.name&&(console.warn("Storage quota exceeded, falling back to memory-only caching"),h.handleQuotaExceeded()),console.warn("Cache serialization failed:",e),JSON.stringify({clientState:{queries:{}}})}},deserialize:e=>{try{return JSON.parse(e)}catch(e){console.warn("Cache deserialization failed, clearing corrupted data:",e);try{localStorage.removeItem(o)}catch(e){console.error("Failed to clear corrupted cache:",e)}return{clientState:{queries:{}}}}}})})();(0,s.eh)({queryClient:e,persister:t,maxAge:6048e5,buster:o,hydrateOptions:{defaultOptions:{queries:{gcTime:1/0}}},dehydrateOptions:{shouldDehydrateQuery:e=>"success"===e.state.status||"pending"===e.state.status,shouldDehydrateMutation:()=>!1}}),(r=new d(e)).start(),(0,c.initializeCacheAnalytics)(e);let u=()=>{n.eu.updateSyncStatus({isOnline:!0}),null==r||r.processPendingOperations()},y=()=>{n.eu.updateSyncStatus({isOnline:!1})};return window.addEventListener("online",u),window.addEventListener("offline",y),()=>{null==r||r.stop(),window.removeEventListener("online",u),window.removeEventListener("offline",y),Promise.resolve().then(a.bind(a,88843)).then(e=>{let{destroyCacheAnalytics:t}=e;t()})}}async function m(){r&&await r.processPendingOperations()}function g(e){return r?r.onSyncStatusChange(e):()=>{}}async function p(){try{localStorage.removeItem("swole-tracker-cache"),localStorage.removeItem(o),await n.Nv.clearQueue(),await n.eu.updateSyncStatus({lastSync:0,pendingOperations:0,failedOperations:0}),h.trackCacheEvent("cache_cleared",{trigger:"logout_or_reset"});let e=(0,c.getCacheAnalytics)();e&&e.recordCacheCleared("logout"),console.log("All offline data cleared successfully")}catch(e){console.error("Failed to clear offline data:",e),h.trackCacheEvent("cache_clear_failed",{error:String(e)})}}}}]);